function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return e={exports:{}},t(e,e.exports),e.exports}import xgplayer from"xgplayer";var dist=createCommonjsModule(function(t,e){!function(e,i){t.exports=function(t){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(e){return t[e]}.bind(null,s));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=11)}([function(t,e,i){t.exports={Context:i(13).default,EVENTS:i(6).default,WORKER_COMMANDS:i(15).default,sniffer:i(16).default,isLe:i(17).default,UTF8:i(18).default,MediaInfo:i(5).default,MediaSample:i(19).default,MediaSegment:i(20).default,MediaSegmentList:i(21).default,AudioTrackMeta:i(7).AudioTrackMeta,VideoTrackMeta:i(7).VideoTrackMeta,AudioTrackSample:i(8).AudioTrackSample,VideoTrackSample:i(8).VideoTrackSample,Mse:i(22).default,Stream:i(23).default,Buffer:i(24).default,Crypto:i(27).default}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(){this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0}distroy(){this.reset(),this.id=-1}}e.default=n,e.AudioTrack=class extends n{constructor(){super(),this.TAG="AudioTrack",this.type="audio"}},e.VideoTrack=class extends n{constructor(){super(),this.TAG="VideoTrack",this.type="video",this.dropped=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}},e.Tracks=class{constructor(){this.audioTrack=null,this.videoTrack=null}destroy(){this.audioTrack=null,this.videoTrack=null}}},function(t,e,i){t.exports={Nalunit:i(37).default,SpsParser:i(9).default,Compatibility:i(39).default}},function(t,e,i){t.exports={Track:i(1).default,Tracks:i(1).Tracks,AudioTrack:i(1).AudioTrack,VideoTrack:i(1).VideoTrack,XgBuffer:i(10).XgBuffer,RemuxBuffer:i(10).RemuxBuffer,PreSource:i(41).default}},function(e,i){e.exports=t},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=t=>{for(let e in t)if(t.hasOwnProperty(e)&&null===t[e])return!1;return!0};class s{constructor(){this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}isComplete(){return s.isBaseInfoReady(this)&&s.isVideoReady(this)&&s.isAudioReady(this)}static isBaseInfoReady(t){return n(t)}static isVideoReady(t){return!t.hasVideo||n(t.video)}static isAudioReady(t){return!t.hasAudio||n(t.video)}}e.default=s},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},s={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},r={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT"},a={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},o={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},u=Object.assign({},n,s,r,a,o),d=[],f=[];for(let t in u)u.hasOwnProperty(t)&&d.push(u[t]);for(let t in u)u.hasOwnProperty(t)&&f.push(u[t]);e.default={ALLEVENTS:u,HLS_EVENTS:o,REMUX_EVENTS:r,DEMUX_EVENTS:s,MSE_EVENTS:a,LOADER_EVENTS:n,FlvAllowedEvents:d,HlsAllowedEvents:f,CRYTO_EVENTS:{START_DECRYPT:"START_DECRYPT",DECRYPTED:"DECRYPTED"}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.AudioTrackMeta=class{constructor(t){const e={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},e,t):e}destroy(){this.init=null}},e.VideoTrackMeta=class{constructor(t){const e={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},e,t):e}destroy(){this.init=null,this.sps=null,this.pps=null}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){let e=n.getDefault();return t?Object.assign({},e,t):e}static getDefault(){return{dts:null,pts:null,data:new Uint8Array}}}e.AudioTrackSample=n;class s{constructor(t){let e=s.getDefault();return t?Object.assign({},e,t):e}static getDefault(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}e.VideoTrackSample=s},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=(n=i(38))&&n.__esModule?n:{default:n};class r{static _ebsp2rbsp(t){let e=t,i=e.byteLength,n=new Uint8Array(i),s=0;for(let t=0;t<i;t++)t>=2&&3===e[t]&&0===e[t-1]&&0===e[t-2]||(n[s]=e[t],s++);return new Uint8Array(n.buffer,0,s)}static parseSPS(t){let e=r._ebsp2rbsp(t),i=new s.default(e);i.readByte();let n=i.readByte();i.readByte();let a=i.readByte();i.readUEG();let o=r.getProfileString(n),u=r.getLevelString(a),d=1,f=420,h=[0,420,422,444],c=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(d=i.readUEG())&&i.readBits(1),d<=3&&(f=h[d]),c=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool())){let t=3!==d?8:12;for(let e=0;e<t;e++)i.readBool()&&(e<6?r._skipScalingList(i,16):r._skipScalingList(i,64))}i.readUEG();let l=i.readUEG();if(0===l)i.readUEG();else if(1===l){i.readBits(1),i.readSEG(),i.readSEG();let t=i.readUEG();for(let e=0;e<t;e++)i.readSEG()}i.readUEG(),i.readBits(1);let p=i.readUEG(),m=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);let _=0,y=0,E=0,v=0;i.readBool()&&(_=i.readUEG(),y=i.readUEG(),E=i.readUEG(),v=i.readUEG());let A=1,S=1,b=0,T=!0,w=0,x=0;if(i.readBool()){if(i.readBool()){let t=i.readByte(),e=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],n=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];t>0&&t<16?(A=e[t-1],S=n[t-1]):255===t&&(A=i.readByte()<<8|i.readByte(),S=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){let t=i.readBits(32),e=i.readBits(32);T=i.readBool(),b=(w=e)/(x=2*t)}}let D=1;1===A&&1===S||(D=A/S);let R=0,O=0;0===d?(R=1,O=2-g):(R=3===d?1:2,O=(1===d?2:1)*(2-g));let L=16*(p+1),M=16*(m+1)*(2-g);L-=(_+y)*R,M-=(E+v)*O;let U=Math.ceil(L*D);return i.destroy(),i=null,{profile_string:o,level_string:u,bit_depth:c,chroma_format:f,chroma_format_string:r.getChromaFormatString(f),frame_rate:{fixed:T,fps:b,fps_den:x,fps_num:w},par_ratio:{width:A,height:S},codec_size:{width:L,height:M},present_size:{width:U,height:M}}}static _skipScalingList(t,e){let i=8,n=8;for(let s=0;s<e;s++)0!==n&&(n=(i+t.readSEG()+256)%256),i=0===n?i:n}static getProfileString(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}static getLevelString(t){return(t/10).toFixed(1)}static getChromaFormatString(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}static toVideoMeta(t){let e={};t&&t.codec_size&&(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.parRatio={width:t.par_ratio.width,height:t.par_ratio.height},e.frameRate=t.frame_rate;let i=e.frameRate.fps_den,n=e.frameRate.fps_num;e.refSampleDuration=Math.floor(e.timescale*(i/n))}}e.default=r},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.XgBuffer=class{constructor(t){this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}push(t){this.array.push(t),this.length+=t.byteLength,this.historyLen+=t.byteLength}shift(t){if(this.array.length<1)return new Uint8Array(0);if(void 0===t)return this._shiftBuffer();if(this.offset+t===this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset=0,this.array.shift(),this.length-=t,e}if(this.offset+t<this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset+=t,this.length-=t,e}let e=new Uint8Array(t),i=0;for(;this.array.length>0&&t>0;){if(this.offset+t<this.array[0].length){let n=this.array[0].slice(this.offset,this.offset+t);e.set(n,i),this.offset+=t,this.length-=t,t=0;break}{let n=this.array[0].length-this.offset;e.set(this.array[0].slice(this.offset,this.array[0].length),i),this.array.shift(),this.offset=0,i+=n,this.length-=n,t-=n}}return e}clear(){this.array=[],this.length=0,this.offset=0}destroy(){this.clear(),this.historyLen=0}_shiftBuffer(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}toInt(t,e){let i=0,n=this.offset+t;for(;n<this.offset+e+t;)n<this.array[0].length?i=256*i+this.array[0][n]:this.array[1]&&(i=256*i+this.array[1][n-this.array[0].length]),n++;return i}},e.RemuxBuffer=class{constructor(){this.video=[],this.audio=[]}destroy(){this.video=[],this.audio=[]}}},function(t,e,i){t.exports=i(12)},function(t,e,i){function n(t){return t&&t.__esModule?t:{default:t}}var s=n(i(4)),r=i(0),a=n(i(28));const o=r.EVENTS.FlvAllowedEvents;t.exports=class extends s.default{constructor(t){super(t),this.context=new r.Context(o),this.initEvents(),this.loaderCompleteTimer=null}start(){this.initFlv(),this.context.init(),super.start(this.flv.mse.url)}initFlvEvents(t){const e=this;t.once(r.EVENTS.REMUX_EVENTS.INIT_SEGMENT,()=>{if(s.default.util.addClass(e.root,"xgplayer-is-live"),!s.default.util.findDom(this.root,"xg-live")){const t=s.default.util.createDom("xg-live","正在直播",{},"xgplayer-live");e.controls.appendChild(t)}}),t.once(r.EVENTS.LOADER_EVENTS.LOADER_COMPLETE,()=>{e.paused||(this.loaderCompleteTimer=setInterval(()=>{const t=e.getBufferedRange()[1];Math.abs(e.currentTime-t)<.5&&(e.emit("ended"),window.clearInterval(this.loaderCompleteTimer))},200))})}initEvents(){this.on("timeupdate",()=>{this.loadData()}),this.on("seeking",()=>{const t=this.currentTime,e=this.getBufferedRange();(t>e[1]||t<e[0])&&this.flv.seek(this.currentTime)})}initFlv(){const t=this.context.registry("FLV_CONTROLLER",a.default)(this);this.initFlvEvents(t),this.flv=t}play(){if(this._hasStart){this._destroy(),this.context=new r.Context(o);const t=this.context.registry("FLV_CONTROLLER",a.default)(this);this.initFlvEvents(t),this.flv=t,this.context.init(),super.start(t.mse.url),super.play()}else super.play()}pause(){super.pause(),this.flv&&this.flv.pause()}loadData(t=this.currentTime){this.flv&&this.flv.seek(t)}destroy(){this._destroy().then(()=>{super.destroy()})}_destroy(){return this.flv.mse.destroy().then(()=>{this.context.destroy(),this.flv=null,this.context=null,this.loaderCompleteTimer&&window.clearInterval(this.loaderCompleteTimer)})}get src(){return this.currentSrc}set src(t){this.player.config.url=t,this.paused?this.start(t):(this.pause(),this.once("pause",()=>{this.start(t)}),this.once("canplay",()=>{this.play()})),this.once("canplay",()=>{this.currentTime=0})}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=(n=i(5))&&n.__esModule?n:{default:n},r=i(14);const a="__TO__";e.default=class{constructor(t=[]){this._emitter=new r.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new s.default,this.allowedEvents=t,this._hooks={}}getInstance(t){return this._instanceMap[t]||null}initInstance(t,...e){if(this._clsMap[t]){const i=new this._clsMap[t](...e);return this._instanceMap[t]=i,i.init&&i.init(),i}throw new Error(`${t}未在context中注册`)}init(t){if(!this._inited){for(let e in this._clsMap)this._clsMap.hasOwnProperty(e)&&!this._instanceMap[e]&&this.initInstance(e,t);this._inited=!0}}registry(t,e){const i=this._emitter,n=this._isMessageNameValid.bind(this),s=this;return this._clsMap[t]=class extends e{constructor(...e){super(...e),this.listeners={},this.onceListeners={},this.TAG=t,this._context=s}on(e,s){return n(e),this.listeners[e]?this.listeners[e].push(s):this.listeners[e]=[s],i.on(`${e}${a}${t}`,s),i.on(e,s)}before(t,e){n(t),s._hooks[t]?s._hooks[t].push(e):s._hooks[t]=[e]}once(e,s){return n(e),this.onceListeners[e]?this.onceListeners[e].push(s):this.onceListeners[e]=[s],i.once(`${e}${a}${t}`,s),i.once(e,s)}emit(t,...e){n(t);const r=s._hooks?s._hooks[t]:null;if(r)for(let t=0,e=r.length;t<e;t++)(0,r[t])();return i.emit(t,...e)}emitTo(t,e,...s){return n(e),i.emit(`${e}${a}${t}`,...s)}off(t,e){return n(t),i.off(t,e)}removeListeners(){const e=Object.prototype.hasOwnProperty.bind(this.listeners);for(let n in this.listeners)if(e(n)){const e=this.listeners[n]||[];for(let s=0;s<e.length;s++){const r=e[s];i.off(n,r),i.off(`${n}${a}${t}`,r)}}for(let n in this.onceListeners)if(e(n)){const e=this.onceListeners[n]||[];for(let s=0;s<e.length;s++){const r=e[s];i.off(n,r),i.off(`${n}${a}${t}`,r)}}}destroy(){if(this.removeListeners(),this.listeners={},delete s._instanceMap[t],super.destroy)return super.destroy()}},(...e)=>this.initInstance(t,...e)}destroyInstances(){Object.keys(this._instanceMap).forEach(t=>{this._instanceMap[t].destroy&&this._instanceMap[t].destroy()})}destroy(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}_isMessageNameValid(t){if(!this.allowedEvents.indexOf(t)<0)throw new Error(`unregistered message name: ${t}`)}}},function(t,e,i){function n(){n.init.call(this)}function s(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function r(t,e,i,n){var r,a,o,u;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]),void 0===o)o=a[e]=i,++t._eventsCount;else if("function"==typeof o?o=a[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(r=s(t))>0&&o.length>r&&!o.warned){o.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=t,d.type=e,d.count=o.length,u=d,console&&console.warn&&console.warn(u)}return t}function a(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=function(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,c(this.listener,this.target,t))}.bind(n);return s.listener=i,n.wrapFn=s,s}function o(t,e,i){var n=t._events;if(void 0===n)return[];var s=n[e];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(s):d(s,s.length)}function u(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function d(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}var f,h="object"==typeof Reflect?Reflect:null,c=h&&"function"==typeof h.apply?h.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};f=h&&"function"==typeof h.ownKeys?h.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var l=Number.isNaN||function(t){return t!=t};t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var p=10;Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return p},set:function(t){if("number"!=typeof t||t<0||l(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");p=t}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||l(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return s(this)},n.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var a=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var o=s[t];if(void 0===o)return!1;if("function"==typeof o)c(o,this,e);else{var u=o.length,f=d(o,u);for(i=0;i<u;++i)c(f[i],this,e)}return!0},n.prototype.addListener=function(t,e){return r(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return r(this,t,e,!0)},n.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,a(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,a(this,t,e)),this},n.prototype.removeListener=function(t,e){var i,n,s,r,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,r=i.length-1;r>=0;r--)if(i[r]===e||i[r].listener===e){a=i[r].listener,s=r;break}if(s<0)return this;0===s?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,s),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,a||e)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var s,r=Object.keys(i);for(n=0;n<r.length;++n)"removeListener"!==(s=r[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},n.prototype.listeners=function(t){return o(this,t,!0)},n.prototype.rawListeners=function(t){return o(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):u.call(t,e)},n.prototype.listenerCount=u,n.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}(),s={get device(){let t=s.os;return t.isPc?"pc":t.isTablet?"tablet":"mobile"},get browser(){let t=navigator.userAgent.toLowerCase(),e={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(e).filter(i=>e[i].test(t)))[0]},get os(){let t=navigator.userAgent,e=/(?:Windows Phone)/.test(t),i=/(?:SymbianOS)/.test(t)||e,n=/(?:Android)/.test(t),s=/(?:Firefox)/.test(t),r=/(?:iPad|PlayBook)/.test(t)||n&&!/(?:Mobile)/.test(t)||s&&/(?:Tablet)/.test(t),a=/(?:iPhone)/.test(t)&&!r;return{isTablet:r,isPhone:a,isAndroid:n,isPc:!a&&!n&&!i,isSymbian:i,isWindowsPhone:e,isFireFox:s}},get isLe(){return n}};e.default=s},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}();e.default=n},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{static decode(t){const e=[],i=t;let s=0;const r=t.length;for(;s<r;)if(i[s]<128)e.push(String.fromCharCode(i[s])),++s;else{if(i[s]<192);else if(i[s]<224){if(n._checkContinuation(i,s,1)){const t=(31&i[s])<<6|63&i[s+1];if(t>=128){e.push(String.fromCharCode(65535&t)),s+=2;continue}}}else if(i[s]<240){if(n._checkContinuation(i,s,2)){const t=(15&i[s])<<12|(63&i[s+1])<<6|63&i[s+2];if(t>=2048&&55296!=(63488&t)){e.push(String.fromCharCode(65535&t)),s+=3;continue}}}else if(i[s]<248&&n._checkContinuation(i,s,3)){let t=(7&i[s])<<18|(63&i[s+1])<<12|(63&i[s+2])<<6|63&i[s+3];if(t>65536&&t<1114112){t-=65536,e.push(String.fromCharCode(t>>>10|55296)),e.push(String.fromCharCode(1023&t|56320)),s+=4;continue}}e.push(String.fromCharCode(65533)),++s}return e.join("")}static _checkContinuation(t,e,i){let n=t;if(e+i<n.length){for(;i--;)if(128!=(192&n[++e]))return!1;return!0}return!1}}e.default=n},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){let e=n.getDefaultInf();if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;let i=Object.assign({},e,t);Object.entries(i).forEach(([t,e])=>{this[t]=e})}static getDefaultInf(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}e.default=n},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}addRAP(t){t.isRAP=!0,this.randomAccessPoints.push(t)}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this._type=t,this._list=[],this._lastAppendLocation=-1}get type(){return this._type}get length(){return this._list.length}isEmpty(){return 0===this._list.length}clear(){this._list=[],this._lastAppendLocation=-1}_searchNearestSegmentBefore(t){let e=this._list;if(0===e.length)return-2;let i=e.length-1,n=0,s=0,r=i,a=0;if(t<e[0].originDts)return a=-1;for(;s<=r;){if((n=s+Math.floor((r-s)/2))===i||t>e[n].lastSample.originDts&&t<e[n+1].originDts){a=n;break}e[n].originDts<t?s=n+1:r=n-1}return a}_searchNearestSegmentAfter(t){return this._searchNearestSegmentBefore(t)+1}append(t){let e=this._list,i=this._lastAppendLocation,n=0;-1!==i&&i<e.length&&t.originStartDts>=e[i].lastSample.originDts&&(i===e.length-1||i<e.length-1&&t.originStartDts<e[i+1].originStartDts)?n=i+1:e.length>0&&(n=this._searchNearestSegmentBefore(t.originStartDts)+1),this._lastAppendLocation=n,this._list.splice(n,0,t)}getLastSegmentBefore(t){let e=this._searchNearestSegmentBefore(t);return e>=0?this._list[e]:null}getLastSampleBefore(t){let e=this.getLastSegmentBefore(t);return null!==e?e.lastSample:null}getLastRAPBefore(t){let e=this._searchNearestSegmentBefore(t),i=this._list[e].randomAccessPoints;for(;0===i.length&&e>0;)e--,i=this._list[e].randomAccessPoints;return i.length>0?i[i.length-1]:null}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){this.configs=Object.assign({},t),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this)}init(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}onTimeUpdate(){this.emit("TIME_UPDATE",this.container)}onWaiting(){this.emit("WAITING",this.container)}onSourceOpen(){this.addSourceBuffers()}onUpdateEnd(){this.emit("SOURCE_UPDATE_END"),this.doAppend()}addSourceBuffers(){if("open"===this.mediaSource.readyState){let t,e=this._context.getInstance("PRE_SOURCE_BUFFER"),i=this._context.getInstance("TRACKS");e=e.sources;let n=!1;for(let s=0,r=Object.keys(e).length;s<r;s++){let r=Object.keys(e)[s];if("audio"===r?t=i.audioTrack:"video"===r&&(t=i.videoTrack),t){let i="audio"===r?21:40;t.meta&&t.meta.refSampleDuration&&(i=t.meta.refSampleDuration),e[r].data.length>=this.preloadTime/i&&(n=!0)}}if(n){if(Object.keys(this.sourceBuffers).length>0)return;for(let t=0,i=Object.keys(e).length;t<i;t++){let i=Object.keys(e)[t],n=e[i],s="video"===i?"video/mp4;codecs="+n.mimetype:"audio/mp4;codecs="+n.mimetype,r=this.mediaSource.addSourceBuffer(s);this.sourceBuffers[i]=r,r.addEventListener("updateend",this.onUpdateEnd),this.doAppend()}}}}doAppend(){let t=this._context.getInstance("PRE_SOURCE_BUFFER");if(t)for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let i=Object.keys(this.sourceBuffers)[e],n=this.sourceBuffers[i];if(!n.updating){let e=t.sources[i];if(e&&!e.inited)n.appendBuffer(e.init.buffer.buffer),e.inited=!0;else if(e){let t=e.data.shift();t&&n.appendBuffer(t.buffer.buffer)}}}}endOfStream(){const{readyState:e,activeSourceBuffers:t}=this.mediaSource;if("open"===e&&0===t.length)try{this.mediaSource.endOfStream()}catch(e){}}remove(t,e=0){for(let i=0;i<Object.keys(this.sourceBuffers).length;i++){let n=this.sourceBuffers[Object.keys(this.sourceBuffers)[i]];n.updating||n.remove(e,t)}}removeBuffers(){const t=[];for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let i,s=this.sourceBuffers[Object.keys(this.sourceBuffers)[e]];s.removeEventListener("updateend",this.onUpdateEnd),s.updating?i=new Promise(t=>{const e=function(){let i=3;const r=()=>{s.updating?i>0?(setTimeout(r,200),i--):t():(n.clearBuffer(s),t())};setTimeout(r,200),s.removeEventListener("updateend",e)};s.addEventListener("updateend",e)}):(n.clearBuffer(s),i=Promise.resolve()),t.push(i)}return Promise.all(t)}destroy(){return this.removeBuffers().then(()=>{for(let t=0;t<Object.keys(this.sourceBuffers).length;t++){let e=this.sourceBuffers[Object.keys(this.sourceBuffers)[t]];this.mediaSource.removeSourceBuffer(e),delete this.sourceBuffers[Object.keys(this.sourceBuffers)[t]]}this.container.removeEventListener("timeupdate",this.onTimeUpdate),this.container.removeEventListener("waiting",this.onWaiting),this.mediaSource.removeEventListener("sourceopen",this.onSourceOpen),this.endOfStream(),window.URL.revokeObjectURL(this.url),this.url=null,this.configs={},this.container=null,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=1})}static clearBuffer(t){const e=t.buffered;let i=.1;for(let t=0,n=e.length;t<n;t++)i=e.end(t);try{t.remove(0,i)}catch(t){}}}e.default=n},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){if(!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}get length(){return this.buffer.byteLength}set position(t){this.dataview.position=t}get position(){return this.dataview.position}back(t){this.position-=t}skip(t){let e=Math.floor(t/4),i=t%4;for(let t=0;t<e;t++)n.readByte(this.dataview,4);i>0&&n.readByte(this.dataview,i)}static readByte(t,e,i){let n;switch(e){case 1:n=i?t.getInt8(t.position):t.getUint8(t.position);break;case 2:n=i?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(i)throw new Error("not supported for readByte 3");n=t.getUint8(t.position)<<16,n|=t.getUint8(t.position+1)<<8,n|=t.getUint8(t.position+2);break;case 4:n=i?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(i)throw new Error("not supported for readBody 8");n=t.getUint32(t.position)<<32,n|=t.getUint32(t.position+4);break;default:n=""}return t.position+=e,n}readUint8(){return n.readByte(this.dataview,1)}readUint16(){return n.readByte(this.dataview,2)}readUint24(){return n.readByte(this.dataview,3)}readUint32(){return n.readByte(this.dataview,4)}readUint64(){return n.readByte(this.dataview,8)}readInt8(){return n.readByte(this.dataview,1,!0)}readInt16(){return n.readByte(this.dataview,2,!0)}readInt32(){return n.readByte(this.dataview,4,!0)}writeUint32(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}}e.default=n},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=(n=i(25))&&n.__esModule?n:{default:n};e.default=class{constructor(t){this.buffer=t||new Uint8Array(0)}write(...t){t.forEach(t=>{this.buffer=(0,s.default)(Uint8Array,this.buffer,t)})}static writeUint32(t){return new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t])}static readAsInt(t){let e="";return t.forEach(t=>{e+=function(t){return t.toString(16).padStart(2,"0")}(t)}),parseInt(e,16)}}},function(t,e,i){var n,s=(n=i(26))&&n.__esModule?n:{default:n};t.exports=s.default},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e=0,i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var r=!0,a=!1,o=void 0;try{for(var u,d=n[Symbol.iterator]();!(r=(u=d.next()).done);r=!0)e+=u.value.length}catch(t){a=!0,o=t}finally{try{!r&&d.return&&d.return()}finally{if(a)throw o}}var f=new t(e),h=0,c=!0,l=!1,p=void 0;try{for(var m,g=n[Symbol.iterator]();!(c=(m=g.next()).done);c=!0){var _=m.value;f.set(_,h),h+=_.length}}catch(t){l=!0,p=t}finally{try{!c&&g.return&&g.return()}finally{if(l)throw p}}return f}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n;const s=((n=i(6))&&n.__esModule?n:{default:n}).default.CRYTO_EVENTS;e.default=class{constructor(t){this.inputBuffer=t.inputbuffer,this.outputBuffer=t.outputbuffer,this.key=t.key,this.iv=t.iv,this.method=t.method,this.crypto=window.crypto||window.msCrypto}init(){this.on(s.START_DECRYPT,this.decript.bind(this))}decript(){this.aeskey?this.decriptData():this.crypto.subtle.importKey("raw",this.key.buffer,{name:"AES-CBC"},!1,["encrypt","decrypt"]).then(t=>{this.aeskey=t,this.decriptData()})}decriptData(){let t=this._context.getInstance(this.inputBuffer),e=this._context.getInstance(this.outputBuffer),i=t.shift();i&&this.crypto.subtle.decrypt({name:"AES-CBC",iv:this.iv.buffer},this.aeskey,i).then(t=>{e.push(new Uint8Array(t)),this.emit(s.DECRYPTED),this.decriptData(i)})}}},function(t,e,i){function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(29)),r=i(32),a=i(34),o=i(3),u=i(0),d=i(2),f=n(i(4));const h=u.EVENTS.REMUX_EVENTS,c=u.EVENTS.DEMUX_EVENTS,l=u.EVENTS.LOADER_EVENTS,p=u.EVENTS.MSE_EVENTS;class m{warn(){}}e.default=class{constructor(t){this.TAG="FLVController",this._player=t,this.state={initSegmentArrived:!1}}init(){this._context.registry("FETCH_LOADER",r.FetchLoader),this._context.registry("LOADER_BUFFER",o.XgBuffer),this._context.registry("FLV_DEMUXER",a.FlvDemuxer),this._context.registry("TRACKS",o.Tracks),this._context.registry("MP4_REMUXER",s.default.Mp4Remuxer),this._context.registry("PRE_SOURCE_BUFFER",o.PreSource),!1!==this._player.config.compatibility&&this._context.registry("COMPATIBILITY",d.Compatibility),this._context.registry("LOGGER",m),this.mse=this._context.registry("MSE",u.Mse)({container:this._player.video}),this._handleTimeUpdate=this._handleTimeUpdate.bind(this),this.initListeners()}initListeners(){this.on(l.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(l.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(c.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(c.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(c.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(c.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(h.INIT_SEGMENT,this._handleAppendInitSegment.bind(this)),this.on(h.MEDIA_SEGMENT,this._handleMediaSegment.bind(this)),this.on(p.SOURCE_UPDATE_END,this._handleSourceUpdateEnd.bind(this)),this._player.on("timeupdate",this._handleTimeUpdate)}_handleMediaInfo(){this._context.mediaInfo||this.emit(c.DEMUX_ERROR,new Error("failed to get mediainfo"))}_handleLoaderDataLoaded(){this.emitTo("FLV_DEMUXER",c.DEMUX_START)}_handleMetadataParsed(t){this.emit(h.REMUX_METADATA,t)}_handleDemuxComplete(){this.emit(h.REMUX_MEDIA)}_handleAppendInitSegment(){this.state.initSegmentArrived=!0,this.mse.addSourceBuffers()}_handleMediaSegment(){this.mse.addSourceBuffers(),this.mse.doAppend()}_handleSourceUpdateEnd(){const t=this._player.currentTime,e=this._player.video,i=this._player.config.preloadTime||5,{length:s}=e.buffered;if(0!==s){const n=e.buffered.end(s-1);n-t>2*i&&(this._player.currentTime=n-i)}}_handleTimeUpdate(){const t=this._player.currentTime;t>2&&this.mse.remove(t-2)}_handleNetworkError(){this._player.emit("error",new f.default.Errors("network",this._player.config.url))}_handleDemuxError(){this._player.emit("error",new f.default.Errors("parse",this._player.config.url))}seek(){this.state.initSegmentArrived||this.loadData()}loadData(){this.emit(l.LADER_START,this._player.config.url)}pause(){const t=this._context.getInstance("FETCH_LOADER");t&&t.cancel()}destroy(){this._player.off("timeupdate",this._handleTimeUpdate),this._player=null,this.mse=null}}},function(t,e,i){t.exports={Mp4Remuxer:i(30).default}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(0),r=(n=i(31))&&n.__esModule?n:{default:n};const a=s.EVENTS.REMUX_EVENTS;class o{constructor(){this._dtsBase=0,this._isDtsBaseInited=!1,this._audioNextDts=null,this._videoNextDts=null,this._videoSegmentList=new s.MediaSegmentList("video"),this._audioSegmentList=new s.MediaSegmentList("audio");const{browser:e}=s.sniffer;this._fillSilenceFrame="ie"===e,this.videoAllDuration=0,this.audioAllDuration=0}init(){this.on(a.REMUX_MEDIA,this.remux.bind(this)),this.on(a.REMUX_METADATA,this.onMetaDataReady.bind(this))}destroy(){this._dtsBase=-1,this._dtsBaseInited=!1,this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear(),this._videoSegmentList=null,this._audioSegmentList=null}remux(){const{audioTrack:e,videoTrack:t}=this._context.getInstance("TRACKS");!this._isDtsBaseInited&&this.calcDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}seek(){this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear()}onMetaDataReady(t){let e,i,n=new s.Buffer,o=r.default.ftyp();if("audio"===t){const{audioTrack:e}=this._context.getInstance("TRACKS");i=e}else{const{videoTrack:e}=this._context.getInstance("TRACKS");i=e}e=r.default.moov({type:t,meta:i.meta}),n.write(o,e);let u=this._context.getInstance("PRE_SOURCE_BUFFER"),d=u.getSource(t);d||(d=u.createSource(t)),d.mimetype=i.meta.codec,d.init=n,this.emit(a.INIT_SEGMENT,t)}calcDtsBase(t,e){if(t.samples.length||e.samples.length){let i=1/0,n=1/0;t.samples&&t.samples.length&&(i=t.samples[0].dts),e.samples&&e.samples.length&&(n=e.samples[0].dts),this._dtsBase=Math.min(i,n),this._isDtsBaseInited=!0}}_remuxVideo(t){const e=t;if(t.samples&&t.samples.length){let{samples:i}=e,t=-1;const i=[],n={samples:[]};for(;i.length;){const e=i.shift(),{isKeyframe:t}=e;let s,r,a=e.dts-this._dtsBase;-1===t&&(t=a),e.pts&&(s=(r=e.pts-this._dtsBase)-a),e.cts&&(r=e.cts+a,s=e.cts);let o={buffer:[],size:0};n.samples.push(o),o.buffer.push(e.data),o.size+=e.data.byteLength;let u=0;u=i.length>=1?i[0].dts-this._dtsBase-a:i.length>=1?i[i.length-1].duration:this.videoMeta.refSampleDuration,this.videoAllDuration+=u,i.push({dts:a,cts:s,pts:r,data:e.data,size:e.data.byteLength,isKeyframe:t,duration:u,flags:{isLeading:0,dependsOn:t?2:1,isDependedOn:t?1:0,hasRedundancy:0,isNonSync:t?0:1},originDts:a,type:"video"})}let o=new s.Buffer;const u=r.default.moof({id:e.meta.id,time:t,samples:i}),d=r.default.mdat(n);o.write(u,d),e.samples=[],e.length=0;let f=this._context.getInstance("PRE_SOURCE_BUFFER"),h=f.getSource("video");h||(h=f.createSource("video")),h.data.push(o),this.emit(a.MEDIA_SEGMENT,"video")}}_remuxAudio(t){const{samples:t}=t;let e=-1,i=[];const n={samples:[]};if(t&&t.length){let o=!1;for(;t.length;){let t=t.shift();const{data:r}=t;let s=t.dts-this._dtsBase;const r=s;o||(e=s,o=!0);let a=0;a=this.audioMeta.refSampleDurationFixed?this.audioMeta.refSampleDurationFixed:t.length>=1?t[0].dts-this._dtsBase-s:i.length>=1?i[i.length-1].duration:this.audioMeta.refSampleDuration,this.audioAllDuration+=a;const u={dts:s,pts:s,cts:0,size:r.byteLength,duration:t.duration?t.duration:a,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:r,type:"audio"};let d={buffer:[],size:0};d.buffer.push(r),d.size+=r.byteLength,n.samples.push(d),i.push(u)}const u=new s.Buffer,d=r.default.moof({id:t.meta.id,time:e,samples:i}),f=r.default.mdat(n);u.write(d,f),t.samples=[],t.length=0;let h=this._context.getInstance("PRE_SOURCE_BUFFER"),c=h.getSource("audio");c||(c=h.createSource("audio")),c.data.push(u),this.emit(a.MEDIA_SEGMENT,"audio",u)}}initSilentAudio(t,e){const i=o.getSilentFrame(this._audioMeta.channelCount);return{dts:t,pts:t,cts:0,duration:e,unit:i,size:i.byteLength,originDts:t,type:"video"}}get videoMeta(){return this._context.getInstance("TRACKS").videoTrack.meta}get audioMeta(){return this._context.getInstance("TRACKS").audioTrack.meta}static getSilentFrame(t){return 1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}e.default=o},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(0);class s{static size(t){return n.Buffer.writeUint32(t)}static initBox(t,e,...i){const r=new n.Buffer;return r.write(s.size(t),s.type(e),...i),r.buffer}static extension(t,e){return new Uint8Array([t,e>>16&255,e>>8&255,255&e])}static ftyp(){return s.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}static moov({type:e,meta:t}){let i,n=8,r=s.mvhd(t.duration,t.timescale);i="video"===e?s.videoTrak(t):s.audioTrak(t);let a=s.mvex(t.duration,t.timescale||1e3,t.id);return[r,i,a].forEach(t=>{n+=t.byteLength}),s.initBox(n,"moov",r,i,a)}static mvhd(t,e=1e3){let i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.initBox(8+i.length,"mvhd",new Uint8Array(i))}static videoTrak(t){let e=8,i=s.tkhd({id:1,duration:t.duration,timescale:t.timescale||1e3,width:t.presentWidth,height:t.presentHeight,type:"video"}),n=s.mdia({type:"video",timescale:t.timescale||1e3,duration:t.duration,avcc:t.avcc,parRatio:t.parRatio,width:t.presentWidth,height:t.presentHeight});return[i,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"trak",i,n)}static audioTrak(t){let e=8,i=s.tkhd({id:2,duration:t.duration,timescale:t.timescale||1e3,width:0,height:0,type:"audio"}),n=s.mdia({type:"audio",timescale:t.timescale||1e3,duration:t.duration,channelCount:t.channelCount,samplerate:t.sampleRate,config:t.config});return[i,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"trak",i,n)}static tkhd(t){let e=t.id,i=t.duration,n=t.width,r=t.height,a=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,r>>>8&255,255&r,0,0]);return s.initBox(8+a.byteLength,"tkhd",a)}static edts(t){let e=new n.Buffer,i=t.duration,r=t.mediaTime;return e.write(s.size(36),s.type("edts")),e.write(s.size(28),s.type("elst")),e.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,1])),e.buffer}static mdia(t){let e=8,i=s.mdhd(t.timescale,t.duration),n=s.hdlr(t.type),r=s.minf(t);return[i,n,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"mdia",i,n,r)}static mdhd(t=1e3,e){let i=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,85,196,0,0]);return s.initBox(12+i.byteLength,"mdhd",s.extension(0,0),i)}static hdlr(t){let e=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(e.splice(8,4,115,111,117,110),e.splice(24,13,83,111,117,110,100,72,97,110,100,108,101,114,0)),s.initBox(8+e.length,"hdlr",new Uint8Array(e))}static minf(t){let e=8,i="video"===t.type?s.vmhd():s.smhd(),n=s.dinf(),r=s.stbl(t);return[i,n,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"minf",i,n,r)}static vmhd(){return s.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}static smhd(){return s.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}static dinf(){let t=new n.Buffer;return t.write(s.size(36),s.type("dinf"),s.size(28),s.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}static stbl(t){let e=8,i=s.stsd(t),n=s.stts(),r=s.stsc(),a=s.stsz(),o=s.stco();return[i,n,r,a,o].forEach(t=>{e+=t.byteLength}),s.initBox(e,"stbl",i,n,r,a,o)}static stsd(t){let e;return e="audio"===t.type?s.mp4a(t):s.avc1(t),s.initBox(16+e.byteLength,"stsd",s.extension(0,0),new Uint8Array([0,0,0,1]),e)}static mp4a(t){let e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=s.esds(t.config);return s.initBox(8+e.byteLength+i.byteLength,"mp4a",e,i)}static esds(t=[43,146,8,0]){const e=t.length;let i=new n.Buffer,r=new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t).concat([6,1,2]));return i.write(s.size(8+r.byteLength),s.type("esds"),r),i.buffer}static avc1(t){let e=new n.Buffer,i=t.width,r=t.height,a=t.parRatio.height,o=t.parRatio.width,u=t.avcc,d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,r>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),h=new Uint8Array([a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o]);return e.write(s.size(40+d.byteLength+u.byteLength+f.byteLength),s.type("avc1"),d,s.size(8+u.byteLength),s.type("avcC"),u,s.size(20),s.type("btrt"),f,s.size(16),s.type("pasp"),h),e.buffer}static stts(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stts",t)}static stsc(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stsc",t)}static stco(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stco",t)}static stsz(){let t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return s.initBox(20,"stsz",t)}static mvex(t,e=1e3,i){let r=new n.Buffer,a=n.Buffer.writeUint32(t);return r.write(s.size(56),s.type("mvex"),s.size(16),s.type("mehd"),s.extension(0,0),a,s.trex(i)),r.buffer}static trex(t){let e=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return s.initBox(8+e.byteLength,"trex",e)}static moof(t){let e=8,i=s.mfhd(),n=s.traf(t);return[i,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"moof",i,n)}static mfhd(){let t=n.Buffer.writeUint32(s.sequence);return s.sequence+=1,s.initBox(16,"mfhd",s.extension(0,0),t)}static traf(t){let e=8,i=s.tfhd(t.id),n=s.tfdt(t.time),r=s.sdtp(t),a=s.trun(t,r.byteLength);return[i,n,a,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"traf",i,n,a,r)}static tfhd(t){let e=n.Buffer.writeUint32(t);return s.initBox(16,"tfhd",s.extension(0,0),e)}static tfdt(t){return s.initBox(16,"tfdt",s.extension(0,0),n.Buffer.writeUint32(t))}static trun(t,e){let i=new n.Buffer,r=n.Buffer.writeUint32(t.samples.length),a=n.Buffer.writeUint32(92+16*t.samples.length+e);return i.write(s.size(20+16*t.samples.length),s.type("trun"),new Uint8Array([0,0,15,1]),r,a),t.samples.forEach(t=>{const e=t.flags;i.write(new Uint8Array([t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,t.size>>>24&255,t.size>>>16&255,t.size>>>8&255,255&t.size,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.isNonSync,0,0,t.cts>>>24&255,t.cts>>>16&255,t.cts>>>8&255,255&t.cts]))}),i.buffer}static sdtp(t){let e=new n.Buffer;return e.write(s.size(12+t.samples.length),s.type("sdtp"),s.extension(0,0)),t.samples.forEach(t=>{const i=t.flags,n=i.isLeading<<6|i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;e.write(new Uint8Array([n]))}),e.buffer}static mdat(t){let e=new n.Buffer,i=8;t.samples.forEach(t=>{i+=t.size}),e.write(s.size(i),s.type("mdat"));let r=new Uint8Array(i),a=0;return r.set(e.buffer,a),a+=8,t.samples.forEach(t=>{t.buffer.forEach(t=>{r.set(t,a),a+=t.byteLength})}),r}}s.type=(t=>new Uint8Array([t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)])),s.sequence=1,e.default=s},function(t,e,i){t.exports={FetchLoader:i(33).default}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i(0).EVENTS.LOADER_EVENTS;e.default=class{constructor(t){this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}init(){this.on(n.LADER_START,this.load.bind(this))}static get type(){return"loader"}load(t,e){let i=this;this.url=t,this._canceled=!1;let s=this.getParams(e);return i.loading=!0,fetch(this.url,s).then(function(t){if(t.ok)return i.status=t.status,i._onFetchResponse(t);i.loading=!1,i.emit(n.LOADER_ERROR,i,t)}).catch(function(t){throw i.loading=!1,i.emit(n.LOADER_ERROR,i,t),new Error(t.message)})}_onFetchResponse(t){let e=this,i=this._context.getInstance(this.buffer),s=++this._loaderTaskNo;if(!0===t.ok)switch(this.readtype){case 2:t.json().then(t=>{e.loading=!1,e._canceled||(i?(i.push(t),e.emit(n.LOADER_COMPLETE,i)):e.emit(n.LOADER_COMPLETE,t))});break;case 1:t.text().then(t=>{e.loading=!1,e._canceled||(i?(i.push(t),e.emit(n.LOADER_COMPLETE,i)):e.emit(n.LOADER_COMPLETE,t))});break;case 3:t.arrayBuffer().then(t=>{e.loading=!1,e._canceled||(i?(i.push(new Uint8Array(t)),e.emit(n.LOADER_COMPLETE,i)):e.emit(n.LOADER_COMPLETE,t))});break;case 0:default:return this._onReader(t.body.getReader(),s)}}_onReader(t,e){let i=this._context.getInstance(this.buffer);if(i||this._reader.cancel(),this._reader=t,!1!==this.loading){let s=this;this._reader&&this._reader.read().then(function(r){return r.done?(s.loading=!1,s.status=0,void s.emit(n.LOADER_COMPLETE,i)):s._canceled?void s._reader.cancel():(i.push(r.value),s.emit(n.LOADER_DATALOADED,i),s._onReader(t,e))}).catch(t=>{s.loading=!1,s.emit(n.LOADER_ERROR,s,t)})}}getParams(t){let e=Object.assign({},t),i=new Headers,n={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==typeof this.configs.headers){let t=this.configs.headers;for(let e in t)t.hasOwnProperty(e)&&i.append(e,t[e])}if("object"==typeof e.headers){let t=e.headers;for(let e in t)t.hasOwnProperty(e)&&i.append(e,t[e])}return!1===e.cors&&(n.mode="same-origin"),e.withCredentials&&(n.credentials="include"),n}cancel(){if(this._reader){try{this._reader.cancel()}catch(t){}this._reader=null,this.loading=!1,this._canceled=!0}}destroy(){this.cancel()}}},function(t,e,i){t.exports={M3U8Parser:i(35).default,TsDemuxer:i(36).default,Playlist:i(42).default,FlvDemuxer:i(43).default}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{static parse(t,e=""){let i={duration:0};if(t&&t.split){let s=t.split(/\r|\n/),r=(s=s.filter(t=>t)).shift();if(!r.match("#EXTM3U"))return null;for(r=s.shift();r;){let t=r.match(/#(.[A-Z|-]*):(.*)/);if(t&&t.length>2)switch(t[1]){case"EXT-X-VERSION":i.version=parseInt(t[2]);break;case"EXT-X-MEDIA-SEQUENCE":i.sequence=parseInt(t[2]);break;case"EXT-X-TARGETDURATION":i.targetduration=parseFloat(t[2]);break;case"EXTINF":n.parseFrag(t,s,i,e);break;case"EXT-X-KEY":n.parseDecrypt(t[2],i)}r=s.shift()}return i}}static parseFrag(t,e,i,n){i.frags||(i.frags=[]);let s={start:i.duration,duration:1e3*parseFloat(t[2])};i.duration+=s.duration;let r=e.shift();r.match(/#(.*):(.*)/)&&(r=e.shift()),r.length>0&&"/"===r.charAt(0)&&n.match(/.*\/\/.*\.\w+/g)&&(n=n.match(/.*\/\/.*\.\w+/g)[0]),r.match(/.*:\/\/.*/)?s.url=r:s.url=n+r,i.frags.push(s)}static parseURL(t){let e="",i=t.match(/(.*\/).*\.m3u8/);if(i&&i.length>0)for(let t=0;t<i.length;t++)i[t].match(/.*\/$/g)&&i[t].length>e.length&&(e=i[t]);return e}static parseDecrypt(t,e){e.encrypt={};let i=t.split(",");for(let t in i){let n=i[t];if(n.match(/METHOD=(.*)/)&&(e.encrypt.method=n.match(/METHOD=(.*)/)[1]),n.match(/URI="(.*)"/)&&(e.encrypt.uri=n.match(/URI="(.*)"/)[1]),n.match(/IV=0x(.*)/)){let t=n.match(/IV=0x(.*)/)[1],i=Math.ceil(t.length/2);e.encrypt.ivb=new Uint8Array(i);for(let n=i-1;n>=0;n--){let i=parseInt(t.substr(2*n,2),16);e.encrypt.ivb[n]=i}e.encrypt.iv=t}}}}e.default=n},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(2),s=i(3),r=i(0);const a=r.EVENTS.DEMUX_EVENTS,o={1:["video","MPEG-1"],2:["video","MPEG-2"],27:["video","AVC.H264"],234:["video","VC-1"],3:["audio","MPEG-1"],4:["audio","MPEG-2"],15:["audio","MPEG-2.AAC"],17:["audio","MPEG-4.AAC"],128:["audio","LPCM"],129:["audio","AC3"],6:["audio","AC3"],130:["audio","DTS"],131:["audio","Dolby TrueHD"],132:["audio","AC3-Plus"],133:["audio","DTS-HD"],134:["audio","DTS-MA"],161:["audio","AC3-Plus-SEC"],162:["audio","DTS-HD-SEC"]};class u{constructor(t){this.configs=Object.assign({},t),this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}init(){this.on(a.DEMUX_START,this.demux.bind(this))}demux(){if(!this.demuxing){let t=this.inputBuffer,e={pat:[],pmt:[]},i={};for(;t.length>=188;){for(;t.length>=1&&71!==t.array[0][t.offset];)t.shift(1);let n=t.shift(188),s=new r.Stream(n.buffer),a={};u.read(s,a,e),a.pes?(i[a.header.pid]||(i[a.header.pid]=[]),i[a.header.pid].push(a.pes),a.pes.ES.buffer=[a.pes.ES.buffer]):i[a.header.pid]&&i[a.header.pid][i[a.header.pid].length-1].ES.buffer.push(a.payload.stream)}for(let t=0;t<Object.keys(i).length;t++){let e=i[Object.keys(i)[t]];for(let n=0;n<e.length;n++)e[n].id=Object.keys(i)[t],e[n].ES.buffer=u.Merge(e[n].ES.buffer),"audio"===e[n].type?this.pushAudioSample(e[n]):"video"===e[n].type&&this.pushVideoSample(e[n])}this._hasAudioMeta&&this.emit(a.DEMUX_COMPLETE,"audio"),this._hasVideoMeta&&this.emit(a.DEMUX_COMPLETE,"video")}}pushAudioSample(t){let e;this._tracks.audioTrack?e=this._tracks.audioTrack:(this._tracks.audioTrack=new s.AudioTrack,(e=this._tracks.audioTrack).meta=new r.AudioTrackMeta({audioSampleRate:t.ES.frequence,sampleRate:t.ES.frequence,channelCount:t.ES.channel,codec:"mp4a.40."+t.ES.audioObjectType,config:t.ES.audioConfig,id:2,sampleRateIndex:t.ES.frequencyIndex}),e.meta.refSampleDuration=Math.floor(1024/e.meta.audioSampleRate*e.meta.timescale),this._hasAudioMeta||(this._hasAudioMeta=!0,this.emit(a.METADATA_PARSED,"audio")));let i=new Uint8Array(t.ES.buffer.buffer.slice(t.ES.buffer.position,t.ES.buffer.length)),n=parseInt(t.pts/90),o=parseInt(t.pts/90),u=new r.AudioTrackSample({dts:n,pts:o,data:i});e.samples.push(u)}pushVideoSample(t){let e,i=n.Nalunit.getNalunits(t.ES.buffer);this._tracks.videoTrack?e=this._tracks.videoTrack:(this._tracks.videoTrack=new s.VideoTrack,(e=this._tracks.videoTrack).meta=new r.VideoTrackMeta);let o=0,d=!1,f=!1;for(let t=0;t<i.length;t++){let n=i[t];if(n.sps){if(e.sps&&u.compaireUint8(n.body,e.sps))continue;d=n,e.sps=n.body,e.meta.chromaFormat=d.sps.chroma_format,e.meta.codec="avc1.";for(var h=1;h<4;h++){var c=d.body[h].toString(16);c.length<2&&(c="0"+c),e.meta.codec+=c}e.meta.codecHeight=d.sps.codec_size.height,e.meta.codecWidth=d.sps.codec_size.width,e.meta.frameRate=d.sps.frame_rate,e.meta.id=1,e.meta.level=d.sps.level_string,e.meta.presentHeight=d.sps.present_size.height,e.meta.presentWidth=d.sps.present_size.width,e.meta.profile=d.sps.profile_string,e.meta.refSampleDuration=Math.floor(e.meta.timescale*(d.sps.frame_rate.fps_den/d.sps.frame_rate.fps_num)),e.meta.sarRatio=d.sps.sar_ratio?d.sps.sar_ratio:d.sps.par_ratio}else n.pps?(e.pps=n.body,f=n):o+=4+n.body.byteLength}d&&f&&(e.meta.avcc=n.Nalunit.getAvcc(d.body,f.body),this._hasVideoMeta||(this._hasVideoMeta=!0,this.emit(a.METADATA_PARSED,"video")));let l=new Uint8Array(o),p=0,m=!1;for(let t=0;t<i.length;t++){let e=i[t],n=e.body.byteLength;e.idr&&(m=!0),e.pps||e.sps||(l.set(new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,255&n]),p),p+=4,l.set(e.body,p),p+=n)}let g=new r.VideoTrackSample({dts:parseInt(t.dts/90),pts:parseInt(t.pts/90),cts:(t.pts-t.dts)/90,originDts:t.dts,isKeyframe:m,data:l});e.samples.push(g)}destory(){this.off(a.DEMUX_START,this.demux),this.configs={},this.demuxing=!1,this.pat=[],this.pmt=[],this._hasVideoMeta=!1,this._hasAudioMeta=!1}static compaireUint8(t,e){if(t.byteLength!==e.byteLength)return!1;let i=!0;for(let n=0;n<t.byteLength;n++)t[n]!==e[n]&&(i=!1);return i}static Merge(t){let e,i=0,n=0;for(let e=0;e<t.length;e++)i+=t[e].length-t[e].position;e=new Uint8Array(i);for(let i=0;i<t.length;i++){let s=t[i];e.set(new Uint8Array(s.buffer,s.position),n),n+=s.length-s.position}return new r.Stream(e.buffer)}static read(t,e,i){u.readHeader(t,e),u.readPayload(t,e,i),"MEDIA"!==e.header.packet||1!==e.header.payload||e.unknownPIDs||(e.pes=u.PES(e))}static readPayload(t,e,i){let n=e.header.pid;switch(n){case 0:u.PAT(t,e,i);break;case 1:u.CAT(t,e,i);break;case 2:u.TSDT(t,e,i);break;case 8191:break;default:if(i.pat.some(t=>t.pid===n))u.PMT(t,e,i);else{let s=i.pmt?i.pmt.filter(t=>t.pid===n):[];s.length>0?u.Media(t,e,o[s[0].streamType][0]):e.unknownPIDs=!0}}}static readHeader(t,e){let i={};i.sync=t.readUint8();let n=t.readUint16();i.error=n>>>15,i.payload=n>>>14&1,i.priority=n>>>13&1,i.pid=8191&n,n=t.readUint8(),i.scrambling=n>>6&3,i.adaptation=n>>4&3,i.continuity=15&n,i.packet=0===i.pid?"PAT":"MEDIA",e.header=i}static PAT(t,e,i){let n={},s=t.readUint8();t.skip(s),s=t.readUint8(),n.tabelID=s,s=t.readUint16(),n.error=s>>>7,n.zero=s>>>6&1,n.sectionLength=4095&s,n.streamID=t.readUint16(),n.current=1&t.readUint8(),n.sectionNumber=t.readUint8(),n.lastSectionNumber=t.readUint8();let r=(n.sectionLength-9)/4,a=[];for(let e=0;e<r;e++){let e=t.readUint16(),i=8191&t.readUint16();a.push({program:e,pid:i,type:0===e?"network":"mapPID"})}a.length>0&&(i.pat=i.pat.concat(a)),n.list=a,n.program=t.readUint16(),n.pid=8191&t.readUint16(),e.payload=n}static PMT(t,e,i){let n={};e.header.packet="PMT";let s=t.readUint8();t.skip(s),s=t.readUint8(),n.tableID=s,s=t.readUint16(),n.sectionLength=4095&s,n.program=t.readUint16(),n.current=1&t.readUint8(),n.order=t.readUint8(),n.lastOrder=t.readUint8(),n.PCR_PID=8191&t.readUint16(),n.programLength=4095&t.readUint16();let r=(n.sectionLength-13)/5,a=[];for(let e=0;e<r;e++)a.push({streamType:t.readUint8(),pid:8191&t.readUint16(),es:4095&t.readUint16()});n.list=a,this.pmt||(this.pmt=[]),i.pmt=this.pmt.concat(a.map(t=>({pid:t.pid,es:t.es,streamType:t.streamType,program:n.program}))),e.payload=n}static Media(t,e,i){let n=e.header,s={};if(n.type=i,3===n.adaptation&&(s.adaptationLength=t.readUint8(),s.adaptationLength>0)){let e=t.readUint8();s.discontinue=e>>>7,s.access=e>>>6&1,s.priority=e>>>5&1,s.PCR=e>>>4&1,s.OPCR=e>>>3&1,s.splicePoint=e>>>2&1,s.transportPrivate=e>>>1&1,s.adaptationField=1&e;let i=t.position;if(1===s.PCR&&(s.programClockBase=t.readUint32()<<1,e=t.readUint16(),s.programClockBase|=e>>>15,s.programClockExtension=511&e),1===s.OPCR&&(s.originProgramClockBase=t.readUint32()<<1,e=t.readUint16(),s.originProgramClockBase+=e>>>15,s.originProgramClockExtension=511&e),1===s.splicePoint&&(s.spliceCountdown=t.readUint8()),1===s.transportPrivate){let e=t.readUint8(),i=[];for(let n=0;n<e;n++)i.push(t.readUint8())}if(1===s.adaptationField){let e=t.readUint8(),i=t.readUint8(),n=t.position,r=i>>>6&1,a=i>>>5&1;1==i>>>7&&(i=t.readUint16(),s.ltwValid=i>>>15,s.ltwOffset=61439&i),1===r&&(i=t.readUint24(),s.piecewiseRate=4194303&i),1===a&&(i=t.readInt8(),s.spliceType=i>>>4,s.dtsNextAU1=i>>>1&7,s.marker1=1&i,i=t.readUint16(),s.dtsNextAU2=i>>>1,s.marker2=1&i,i=t.readUint16(),s.dtsNextAU3=i),t.skip(e-1-(t.position-n))}let n=s.adaptationLength-1-(t.position-i);t.skip(n)}s.stream=new r.Stream(t.buffer.slice(t.position)),e.payload=s}static PES(t){let e={},i=t.payload.stream;if(1!==i.readUint24())e.ES={},e.ES.buffer=i;else{let t=i.readUint8();t>=224&&t<=239&&(e.type="video"),t>=192&&t<=223&&(e.type="audio");let n=i.readUint16();if(e.packetLength=n,"video"!==e.type&&"audio"!==e.type)throw new Error("format is not supported");{let t=i.readUint8();if(2!=t>>>6)throw new Error("error when parse pes header");t=i.readUint8(),e.ptsDTSFlag=t>>>6,e.escrFlag=t>>>5&1,e.esRateFlag=t>>>4&1,e.dsmFlag=t>>>3&1,e.additionalFlag=t>>>2&1,e.crcFlag=t>>>1&1,e.extensionFlag=1&t,e.pesHeaderLength=i.readUint8();let n=e.pesHeaderLength;if(2===e.ptsDTSFlag){let s=[];t=i.readUint8(),s.push(t>>>1&7),t=i.readUint16(),s.push(t>>>1),t=i.readUint16(),s.push(t>>>1),e.pts=s[0]<<30|s[1]<<15|s[2],n-=5,"video"===e.type&&(e.dts=e.pts)}if(3===e.ptsDTSFlag){let s=[];t=i.readUint8(),s.push(t>>>1&7),t=i.readUint16(),s.push(t>>>1),t=i.readUint16(),s.push(t>>>1),e.pts=s[0]<<30|s[1]<<15|s[2];let r=[];t=i.readUint8(),r.push(t>>>1&7),t=i.readUint16(),r.push(t>>>1),t=i.readUint16(),r.push(t>>>1),e.dts=r[0]<<30|r[1]<<15|r[2],n-=10}if(1===e.escrFlag){let s=[],r=[];t=i.readUint8(),s.push(t>>>3&7),s.push(3&t),t=i.readUint16(),s.push(t>>>13),s.push(3&t),t=i.readUint16(),s.push(t>>>13),r.push(3&t),t=i.readUint8(),r.push(t>>>1),e.escr=300*(s[0]<<30|s[1]<<28|s[2]<<15|s[3]<<13|s[4])+(r[0]<<7|r[1]),n-=6}if(1===e.esRateFlag&&(t=i.readUint24(),e.esRate=t>>>1&4194303,n-=3),1===e.dsmFlag)throw new Error("not support DSM_trick_mode");if(1===e.additionalFlag&&(t=i.readUint8(),e.additionalCopyInfo=127&t,n-=1),1===e.crcFlag&&(e.pesCRC=i.readUint16(),n-=2),1===e.extensionFlag)throw new Error("not support extension");n>0&&i.skip(n),e.ES=u.ES(i,e.type)}}return e}static ES(t,e){let i,n={};if("video"===e){if(1!==(i=t.readUint32())&&(t.back(4),1!==(i=t.readUint24())))throw new Error("h264 nal header parse failed");t.skip(2),n.buffer=t}else{if("audio"!==e)throw new Error(`ES ${e} is not supported`);{if((i=t.readUint16())>>>4!=4095)throw new Error("aac ES parse Error");const e=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n.id=0==(i>>>3&1)?"MPEG-4":"MPEG-2",n.layer=i>>>1&3,n.absent=1&i,i=t.readUint16(),n.audioObjectType=1+(i>>>14&3),n.profile=n.audioObjectType-1,n.frequencyIndex=i>>>10&15,n.frequence=e[n.frequencyIndex],n.channel=i>>>6&7,n.frameLength=(3&i)<<11|t.readUint16()>>>5,n.audioConfig=u.getAudioConfig(n.audioObjectType,n.channel,n.frequencyIndex),t.skip(1),n.buffer=t}}return n}static TSDT(t,e,i){e.payload={}}static CAT(t,e,i){let n={};n.tableID=t.readUint8();let s=t.readUint16();n.sectionIndicator=s>>>7,n.sectionLength=4095&s,t.skip(2),s=t.readUint8(),n.version=s>>>3,n.currentNextIndicator=1&s,n.sectionNumber=t.readUint8(),n.lastSectionNumber=t.readUint8();this.sectionLength;n.crc32=t.readUint32(),e.payload=n}static getAudioConfig(t,e,i){let n,s,r=navigator.userAgent.toLowerCase();return/firefox/i.test(r)?i>=6?(t=5,n=new Array(4),s=i-3):(t=2,n=new Array(2),s=i):-1!==r.indexOf("android")?(t=2,n=new Array(2),s=i):(t=5,n=new Array(4),i>=6?s=i-3:(1===e&&(t=2,n=new Array(2)),s=i)),n[0]=t<<3,n[0]|=(14&i)>>1,n[1]=(1&i)<<7,n[1]|=e<<3,5===t&&(n[1]|=(14&s)>>1,n[2]=(1&s)<<7,n[2]|=8,n[3]=0),n}get inputBuffer(){return this._context.getInstance(this.configs.inputbuffer)}get _tracks(){return this._context.getInstance("TRACKS")}}e.default=u},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=(n=i(9))&&n.__esModule?n:{default:n};class r{static getNalunits(t){if(t.length-t.position<4)return[];let e=t.dataview,i=t.position;return 1===e.getInt32(i)||0===e.getInt16(i)&&1===e.getInt8(i+2)?r.getAnnexbNals(t):r.getAvccNals(t)}static getAnnexbNals(t){let e=[],i=r.getHeaderPositionAnnexB(t),n=i.pos,s=n;for(;n<t.length-4;){let a=t.buffer.slice(n,n+i.headerLength);i.pos===t.position&&t.skip(i.headerLength),s=(i=r.getHeaderPositionAnnexB(t)).pos;let o={header:a,body:new Uint8Array(t.buffer.slice(n+a.byteLength,s))};r.analyseNal(o),e.push(o),t.skip(s-t.position),n=s}return e}static getAvccNals(t){let e=[];for(;t.position<t.length-4;){let i=t.dataview.getInt32();if(!(t.length-t.position>=i))break;{let n=t.buffer.slice(t.position,t.position+4);t.skip(4);let s=t.buffer.slice(t.position,t.position+i);t.skip(i);let a={header:n,body:s};r.analyseNal(a),e.push(a)}}return e}static analyseNal(t){switch(31&t.body[0]){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:break;case 7:t.sps=s.default.parseSPS(t.body);break;case 8:t.pps=!0}}static getHeaderPositionAnnexB(t){let e=t.position,i=0;for(;3!==i&&4!==i&&e<t.length-4;)0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)?i=4:1===t.dataview.getInt8(e+2)?i=3:e++:e++;return e===t.length-4&&(0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)&&(i=4):(e++,0===t.dataview.getInt16(e)&&1===t.dataview.getInt8(e)?i=3:e=t.length)),{pos:e,headerLength:i}}static getAvcc(t,e){let i=new Uint8Array(t.byteLength+e.byteLength+11);i[0]=1,i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=255,i[5]=225;let n=6;return i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),n),n+=2,i.set(t,n),i[n+=t.byteLength]=1,n++,i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),n),n+=2,i.set(e,n),i}}e.default=r},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}destroy(){this._buffer=null}_fillCurrentWord(){let t=this._totalBytes-this._bufferIndex,e=Math.min(4,t),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+e)),this._currentWord=new DataView(i.buffer).getUint32(0,!1),this._bufferIndex+=e,this._currentWordBitsLeft=8*e}readBits(t){if(t<=this._currentWordBitsLeft){let e=this._currentWord>>>32-t;return this._currentWord<<=t,this._currentWordBitsLeft-=t,e}let e=this._currentWordBitsLeft?this._currentWord:0;this._currentWordBitsLeft;let i=t-this._currentWordBitsLeft;this._fillCurrentWord();let n=Math.min(i,this._currentWordBitsLeft),s=this._currentWord>>>32-n;return this._currentWord<<=n,this._currentWordBitsLeft-=n,e=e<<n|s}readBool(){return 1===this.readBits(1)}readByte(){return this.readBits(8)}_skipLeadingZero(){let t;for(t=0;t<this._currentWordBitsLeft;t++)if(0!=(this._currentWord&2147483648>>>t))return this._currentWord<<=t,this._currentWordBitsLeft-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}readUEG(){let t=this._skipLeadingZero();return this.readBits(t+1)-1}readSEG(){let t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(0),r=(n=i(40))&&n.__esModule?n:{default:n};const{REMUX_EVENTS:o}=s.EVENTS;class a{constructor(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this.videoFixedTimes=0,this.audioFixedTimes=0,this.videoGapAvg=0,this.audioGapAvg=0}init(){this.before(o.REMUX_MEDIA,this.doFix.bind(this))}reset(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[]}doFix(){const{isFirstAudioSamples:e,isFirstVideoSamples:t}=this.getFirstSample();this.removeInvalidSamples(),this.recordSamplesCount(),this._firstVideoSample&&this.fixRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples),this._firstAudioSample&&this.fixRefSampleDuration(this.audioTrack.meta,this.audioTrack.samples),this.doFixVideo(t),this.doFixAudio(e)}doFixVideo(t){let{samples:t,meta:i}=this.videoTrack;if((!i.frameRate||!1!==i.frameRate.fixed)&&t&&t.length&&this._firstVideoSample){const e=t[0],i=e.dts,n=t.length;if(t&&this._firstAudioSample){const t=this._firstVideoSample.dts,i=t-this._firstAudioSample.dts;if(i>2*i.refSampleDuration){const n=Math.floor(i/i.refSampleDuration);for(let i=0;i<n;i++){const n=Object.assign({},e);n.dts=t-(i+1)*i.refSampleDuration,n.pts=n.dts+n.cts,t.unshift(n),this.filledVideoSamples.push({dts:n.dts,size:n.data.byteLength})}}}let s;if(this.nextVideoDts){s=i-this.nextVideoDts;const t=Math.abs(s);if(s>=2*i.refSampleDuration){const t=Math.floor(s/i.refSampleDuration);for(let e=0;e<t;e++){const t=Object.assign({},t[0]),n=i-(e+1)*i.refSampleDuration;t.dts=n>this.nextVideoDts?n:this.nextVideoDts,t.pts=t.dts+t.cts,this.videoTrack.samples.unshift(t),this.filledVideoSamples.push({dts:t.dts,size:t.data.byteLength})}}else t<=i.refSampleDuration&&t>0&&(this.recordGapFixTime("video",s),console.log("重定位视频帧dts",t[0].dts,this.nextVideoDts,`pts: ${this.nextVideoDts+t[0].cts}`),t[0].dts=this.nextVideoDts,t[0].originDts=t[0].dts,t[0].cts=t[0].cts||t[0].pts-t[0].dts,t[0].pts=t[0].dts+t[0].cts)}const r=t[t.length-1].dts,a=t.length>=2?r-t[t.length-2].dts:i.refSampleDurationFixed||i.refSampleDuration;this.lastVideoSamplesLen=n,this.nextVideoDts=r+a,this.lastVideoDts=r;for(let t=0,e=t.length;t<e;t++){const e=t[t],i=t[t+1];if(!i)break;const n=i.dts-e.dts;if(n>2*i.refSampleDuration){let s=Math.floor(n/i.refSampleDuration),r=0;for(;r<s;){const n=Object.assign({},i);n.dts=e.dts+(r+1)*i.refSampleDuration,n.pts=n.dts+n.cts,n<i.dts&&(t.splice(t,0,n),this.filledVideoSamples.push({dts:n.dts,size:n.data.byteLength})),r++,t++}}}this.videoTrack.samples.forEach(t=>{console.log(t.dts)}),this.videoTrack.samples=t}}doFixAudio(t){let{samples:t,meta:i}=this.audioTrack;if(t&&t.length){const e=t.length,i=r.default.getSilentFrame(i.codec,i.channelCount),n=this._firstAudioSample;if(this._firstVideoSample&&t){const t=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(n.dts-t>i.refSampleDuration){const e=Math.floor((n.dts-t)/i.refSampleDuration);for(let t=0;t<e;t++){const e={data:i,datasize:i.byteLength,dts:n.dts-(t+1)*i.refSampleDuration,filtered:0};t.unshift(e),this.filledAudioSamples.push({dts:e.dts,size:e.data.byteLength})}}}let s;const o=t[0].dts;if(this.nextAudioDts){s=o-this.nextAudioDts;const t=Math.abs(s);if(s>2*i.refSampleDuration){const t=Math.floor(s/i.refSampleDuration);for(let e=0;e<t;e++){const t=o-(e+1)*i.refSampleDuration,i=Object.assign({},t[0],{dts:t>this.nextAudioDts?t:this.nextAudioDts});this.filledAudioSamples.push({dts:i.dts,size:i.data.byteLength}),this.audioTrack.samples.unshift(i)}}else t<=i.refSampleDuration&&t>0&&(this.recordGapFixTime("video",s),t[0].dts=this.nextAudioDts,t[0].pts=this.nextAudioDts)}const u=t[t.length-1].dts,d=t.length>=2?u-t[t.length-2].dts:i.refSampleDuration;this.lastAudioSamplesLen=e,this.nextAudioDts=i.refSampleDurationFixed?u+i.refSampleDurationFixed:u+d,this.lastAudioDts=u;for(let t=0,e=t.length;t<e;t++){const e=t[t],i=t[t+1];if(!i)break;const n=i.dts-e.dts;t[t].duration=n}this.audioTrack.samples=a.sortAudioSamples(t)}}getFirstSample(){let{samples:e}=this.videoTrack,{samples:t}=this.audioTrack,t=!1,e=!1;return!this._firstVideoSample&&e.length&&(this._firstVideoSample=a.findFirstVideoSample(e),t=!0),!this._firstAudioSample&&t.length&&(this._firstAudioSample=a.findFirstAudioSample(t),e=!0),{isFirstVideoSamples:t,isFirstAudioSamples:e}}fixRefSampleDuration(t,e){const i="video"===t.type,n=i?this.allVideoSamplesCount:this.allAudioSamplesCount,s=i?this._firstVideoSample.dts:this._firstAudioSample.dts,r=i?this.filledVideoSamples.length:this.filledAudioSamples.length,a=i?this.videoFixedTimes:this.filledAudioSamples.length,o=i?this.videoGapAvg:this.audioGapAvg;if(!t.refSampleDuration||t.refSampleDuration<=0||Number.isNaN(t.refSampleDuration)){if(e.length>=1){const i=e[e.length-1].dts;t.refSampleDuration=Math.floor((i-s)/(n+r-1))}}else if(t.refSampleDuration&&e.length>=3){const i=(e[e.length-1].dts-e[0].dts)/(e.length-1);t.refSampleDuration=Math.abs(t.refSampleDuration-i)<=t.refSampleDuration?t.refSampleDuration:i}a>=10&&o>10&&!t.refSampleDurationFixed&&(t.refSampleDurationFixed=t.refSampleDuration-o)}recordGapFixTime(t,e){"video"===t?(this.videoGapAvg=0===this.videoFixedTimes?e:Math.floor(this.videoGapAvg*this.videoFixedTimes/this.videoFixedTimes+1)+Math.floor(e/this.videoFixedTimes+1),this.videoFixedTimes+=1):(this.audioGapAvg=0===this.audioFixedTimes?e:Math.floor(this.audioGapAvg*this.audioFixedTimes/this.audioFixedTimes+1)+Math.floor(e/this.audioFixedTimes+1),this.audioFixedTimes+=1)}recordSamplesCount(){const{audioTrack:e,videoTrack:t}=this;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}removeInvalidSamples(){const{_firstVideoSample:e,_firstAudioSample:t}=this;this.audioTrack.samples=this.audioTrack.samples.filter(t=>t.dts>=t.dts&&(void 0===this.lastAudioDts||t.dts>this.lastAudioDts)),this.videoTrack.samples=this.videoTrack.samples.filter(t=>t.dts>=e.dts&&(void 0===this.lastVideoDts||t.dts>this.lastVideoDts))}static sortAudioSamples(t){return 1===t.length?t:t.sort((t,e)=>t.dts-e.dts)}static findFirstAudioSample(t){return t&&0!==t.length?a.sortAudioSamples(t)[0]:null}static findFirstVideoSample(t){if(!t.length)return null;const e=t.sort((t,e)=>t.dts-e.dts);for(let t=0,i=e.length;t<i;t++)if(e[t].isKeyframe)return e[t]}get tracks(){return this._context.getInstance("TRACKS")}get audioTrack(){return this.tracks?this.tracks.audioTrack:null}get videoTrack(){return this.tracks?this.tracks.videoTrack:null}}e.default=a},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{static getSilentFrame(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(){this.mimetype="",this.init=null,this.data=[]}}e.default=class{constructor(){this.sources={}}getSource(t){return this.sources[t]}createSource(t){return this.sources[t]=new n,this.sources[t]}clear(){this.sources={}}destroy(){this.sources={}}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=t.autoclear||!1}get list(){return this._list}set baseURL(t){this.baseURL!==t&&(this.clear(),this._baseURL=t)}get baseURL(){return this._baseURL}push(t,e){this._ts[t]||(this._ts[t]={duration:e,downloaded:!1,downloading:!1,start:this.duration},this._list[this.duration]=t,this.duration+=e,this.fragLength+=1)}deleteFrag(t){this._ts[t]&&(this._ts[t].start>this._lastget.time&&(this._lastget={duration:this._ts[t].duration,time:this._ts[t].start,downloaded:!1,downloading:!1,url:t}),delete this._list[this._ts[t].start],delete this._ts[t],this.fragLength-=1)}pushM3U8(t,e){if(t&&(this.version=t.version,this.targetduration=t.targetduration,t.encrypt&&!this.encrypt&&(this.encrypt=t.encrypt),t.sequence>this.sequence)){this.sequence=t.sequence;let i=[];for(let e=0;e<t.frags.length;e++){let n=t.frags[e];this._ts[n.url]||(i.push(n.url),this.push(n.url,n.duration))}if(e){let t=this.getTsList();for(let e=0;e<t.length;e++)i.indexOf(t[e])<0&&this.deleteFrag(t[e])}}}getTsList(){return Object.keys(this._ts)}downloaded(t,e){let i=this._ts[t];i&&(i.downloaded=e)}downloading(t,e){let i=this._ts[t];i&&(i.downloading=e)}getTsByName(t){return this._ts[t]}getTs(t){let e,i=Object.keys(this._list);if(void 0===t&&(t=this._lastget?this._lastget.time+this._lastget.duration:0),!(i.length<1||t>=this.duration)){i.sort((t,e)=>parseFloat(t)-parseFloat(e));for(let n=0;n<i.length&&t>=parseInt(i[n]);n++){let t=this._list[i[n]];e={url:t,downloaded:this._ts[t].downloaded,downloading:this._ts[t].downloading,time:parseInt(i[n]),duration:parseInt(this._ts[t].duration)},this.autoclear&&(delete this._ts[this._lastget.url],delete this._list[this._lastget.time]),this._lastget=e}return e}}clear(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0}clearDownloaded(){for(let t=0,e=Object.keys(this._ts).length;t<e;t++){let e=this._ts[Object.keys(this._ts)[t]];e.downloaded=!1,e.downloading=!1}}destroy(){this._baseURL="",this._list={},this._ts={},this.version=0,this.sequence=-1,this.targetduration=0,this.duration=0,this.fragLength=0,this._lastget=void 0,this._audoclear=!1}}},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=i(0),r=i(2),a=i(3),o=(n=i(44))&&n.__esModule?n:{default:n};const u=s.EVENTS.DEMUX_EVENTS;class d{constructor(){this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}init(){this.on(u.DEMUX_START,this.doParseFlv.bind(this))}static isFlvFile(t){return!(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])}static getPlayType(t){const e={hasVideo:!1,hasAudio:!1};return!0&t&&(e.hasVideo=!0),!0&t&&(e.hasAudio=!0),e}doParseFlv(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;let t,e=1e5;do{t=this._parseFlvTag()}while(t&&e-- >0);this.emit(u.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;const t=this.loaderBuffer.shift(13);this.parseFlvHeader(t),this.doParseFlv()}}parseFlvHeader(t){if(d.isFlvFile(t)){this._firstFragmentLoaded=!0;const e=d.getPlayType(t[4]);e.hasVideo&&this.initVideoTrack(),e.hasAudio&&this.initAudioTrack()}else this.emit(u.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv();this.doParseFlv()}initVideoTrack(){this._trackNum++;let t=new a.VideoTrack;t.meta=new s.VideoTrackMeta,t.id=t.meta.id=this._trackNum,this.tracks.videoTrack=t}initAudioTrack(){this._trackNum++;let t=new a.AudioTrack;t.meta=new s.AudioTrackMeta,t.id=t.meta.id=this._trackNum,this.tracks.audioTrack=t}_parseFlvTag(){if(this.loaderBuffer.length<11)return null;let t=this._parseFlvTagHeader();return t&&this._processChunk(t),t}_parseFlvTagHeader(){let t=0,e={},i=this.loaderBuffer.toInt(t,1);if(t+=1,e.filtered=(32&i)>>>5,e.tagType=31&i,e.datasize=this.loaderBuffer.toInt(t,3),t+=3,8!==e.tagType&&9!==e.tagType&&11!==e.tagType&&18!==e.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.logger.warn(this.TAG,"tagType "+e.tagType),null;if(this.loaderBuffer.length<e.datasize+15)return null;this.loaderBuffer.shift(4);let n=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);let s=this.loaderBuffer.shift(1)[0];return s>0&&(n+=16777216*s),e.dts=n,this.loaderBuffer.shift(3),e}_processChunk(t){switch(t.tagType){case 18:this._parseScriptData(t);break;case 8:this._parseAACData(t);break;case 9:this._parseHevcData(t);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}_parseScriptData(t){let e=this.tracks.audioTrack,i=this.tracks.videoTrack,n=this.loaderBuffer.shift(t.datasize);const s=(new o.default).resolve(n,n.length),r=this._context.onMetaData=s?s.onMetaData:void 0;if(this._context.mediaInfo.duration=r.duration,this._context.mediaInfo.hasVideo=r.hasVideo,this._context.mediaInfo.hsaAudio=r.hasAudio,this._datasizeValidator(t.datasize)&&(this.emit(u.MEDIA_INFO),this._hasScript=!0),e&&!e.hasSpecificConfig){let t=e.meta;switch(r.audiosamplerate&&(t.sampleRate=r.audiosamplerate),r.audiochannels&&(t.channelCount=r.audiochannels),r.audiosamplerate){case 44100:t.sampleRateIndex=4;break;case 22050:t.sampleRateIndex=7;break;case 11025:t.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){let t=i.meta;if("number"==typeof r.framerate){let e=Math.floor(1e3*r.framerate);if(e>0){let i=e/1e3;t.frameRate||(t.frameRate={}),t.frameRate.fixed=!0,t.frameRate.fps=i,t.frameRate.fps_num=e,t.frameRate.fps_den=1e3}}}}_aacSequenceHeaderParser(t){let e={hasSpecificConfig:!0};e.objectType=t[1]>>>3,e.sampleRateIndex=(7&t[1])<<1|t[2]>>>7,e.audiosamplerate=this._switchAudioSampleRate(e.sampleRateIndex),e.channelCount=(120&t[2])>>>3,e.frameLength=(4&t[2])>>>2,e.dependsOnCoreCoder=(2&t[2])>>>1,e.extensionFlagIndex=1&t[2],e.codec=`mp4a.40.${e.objectType}`;let i,n,s=window.navigator.userAgent.toLowerCase(),r=e.sampleRateIndex;return-1!==s.indexOf("firefox")?e.sampleRateIndex>=6?(e.objectType=5,n=new Array(4),i=r-3):(e.objectType=2,n=new Array(2),i=r):-1!==s.indexOf("android")?(e.objectType=2,n=new Array(2),i=r):(e.objectType=5,i=e.sampleRateIndex,n=new Array(4),e.sampleRateIndex>=6?i=e.sampleRateIndex-3:1===e.channelCount&&(e.objectType=2,n=new Array(2),i=e.sampleRateIndex)),n[0]=e.objectType<<3,n[0]|=(15&e.sampleRateIndex)>>>1,n[1]=(15&e.sampleRateIndex)<<7,n[1]|=(15&e.channelCount)<<3,5===e.objectType&&(n[1]|=(15&i)>>>1,n[2]=(1&i)<<7,n[2]|=8,n[3]=0),e.config=n,e}_parseAACData(t){let e=this.tracks.audioTrack;if(e){let i=e.meta;i||(i=new s.AudioTrackMeta);let n=this.loaderBuffer.shift(1)[0];t.data=this.loaderBuffer.shift(t.datasize-1);let r=(240&n)>>>4;e.format=r,10!==r&&this.emit(u.DEMUX_ERROR,new Error(`invalid audio format: ${r}`)),10!==r||this._hasAudioSequence||(i.sampleRate=this._switchAudioSamplingFrequency(n),i.sampleRateIndex=(12&n)>>>2,i.frameLenth=(2&n)>>>1,i.channelCount=1&n,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));let a=i.audioSampleRate,o=i.sampleRateIndex,d=i.refSampleDuration;delete t.tagType;let f=this._datasizeValidator(t.datasize);if(0===t.data[0]){let e=this._aacSequenceHeaderParser(t.data);a=e.audiosamplerate||i.audioSampleRate,o=e.sampleRateIndex||i.sampleRateIndex,d=Math.floor(1024/a*i.timescale),i.channelCount=e.channelCount,i.sampleRate=a,i.sampleRateIndex=o,i.refSampleDuration=d,i.duration=this._context.mediaInfo.duration*i.timescale,i.config=e.config;const n=this._context.mediaInfo.audio;n.codec=e.codec,n.channelCount=e.channelCount,n.sampleRate=a,n.sampleRateIndex=e.audioSampleRateIndex,this._hasScript&&!this._hasAudioSequence?this.emit(u.METADATA_PARSED,"audio"):this._hasScript&&this._hasAudioSequence&&this.emit(u.AUDIO_METADATA_CHANGE),this._hasAudioSequence=!0}else t.data=t.data.slice(1,t.data.length),e.samples.push(t);if(!f){const e=new Error("TAG length error at "+t.datasize);this.emit(u.DEMUX_ERROR,e.message),this.logger.warn(this.TAG,e.message)}}}_parseHevcData(t){let e=this.loaderBuffer.shift(1)[0];t.frameType=(240&e)>>>4,t.isKeyframe=1===t.frameType;let i=15&e;if(this.tracks.videoTrack.codecID=i,t.avcPacketType=this.loaderBuffer.shift(1)[0],t.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===i){const e=this.loaderBuffer.shift(t.datasize-5);if(t.data=e,0!==Number.parseInt(t.avcPacketType)){this._datasizeValidator(t.datasize)||this.logger.warn(this.TAG,`invalid video tag datasize: ${t.datasize}`);let e={},i=0;for(e.cts=t.cts,e.dts=t.dts;t.data.length>i;){let n=t.data.slice(Number.parseInt(i),4+i);e.size=n[3],e.size+=256*n[2],e.size+=256*n[1]*256,e.size+=256*n[0]*256*256,i+=4,e.data=t.data.slice(Number.parseInt(i),e.size+i),i+=e.size,this.tracks.videoTrack.samples.push(e),this.emit(u.METADATA_PARSED,"video")}}else 0===Number.parseInt(t.avcPacketType)&&(this._datasizeValidator(t.datasize)?this.emit(u.METADATA_PARSED,"video"):this.logger.warn(this.TAG,`invalid video tag datasize: ${t.datasize}`))}else if(7===i){let e=this.loaderBuffer.shift(t.datasize-5);if(0===e[4]&&0===e[5]&&0===e[6]&&1===e[7]){let t=0;for(let i=0;i<4;i++)t=256*t+e[i];t-=4,(e=e.slice(4,e.length))[3]=t%256,t=(t-e[3])/256,e[2]=t%256,t=(t-e[2])/256,e[1]=t%256,e[0]=(t-e[1])/256}if(t.data=e,0===t.avcPacketType)this._avcSequenceHeaderParser(t.data),this._datasizeValidator(t.datasize)&&(this._hasScript&&!this._hasVideoSequence?this.emit(u.METADATA_PARSED,"video"):this._hasScript&&this._hasVideoSequence&&this.emit(u.VIDEO_METADATA_CHANGE),this._hasVideoSequence=!0);else{if(!this._datasizeValidator(t.datasize))return void this.logger.warn(this.TAG,`invalid video tag datasize: ${t.datasize}`);this.tracks.videoTrack.samples.push(t)}}else this.logger.warn(this.TAG,`video codeid is ${i}`),t.data=this.loaderBuffer.shift(t.datasize-1),this._datasizeValidator(t.datasize)||this.logger.warn(this.TAG,`invalid video tag datasize: ${t.datasize}`),this.tracks.videoTrack.samples.push(t),this.emit(u.DEMUX_COMPLETE);delete t.tagType}_avcSequenceHeaderParser(t){let e=this.tracks.videoTrack;if(e){let i=0;e.meta||(e.meta=new s.VideoTrackMeta);let n=e.meta;n.configurationVersion=t[0],n.avcProfileIndication=t[1],n.profileCompatibility=t[2],n.avcLevelIndication=t[3]/10,n.nalUnitLength=1+(3&t[4]);let a=31&t[5];i=6;let o={};for(let e=0;e<a;e++){let e=255*t[i]+t[i+1];i+=2;let s=new Uint8Array(e);for(let n=0;n<e;n++)s[n]=t[i+n];let a="avc1.";for(let t=1;t<4;t++){let e=s[t].toString(16);e.length<2&&(e="0"+e),a+=e}n.codec=a,i+=e,this.tracks.videoTrack.meta.sps=s,o=r.SpsParser.parseSPS(s)}let u=t[i];i++;for(let e=0;e<u;e++){let e=255*t[i]+t[i+1];i+=2;let n=new Uint8Array(e);for(let s=0;s<e;s++)n[s]=t[i+s];i+=e,this.tracks.videoTrack.meta.pps=n}Object.assign(n,r.SpsParser.toVideoMeta(o));const d=this._context.mediaInfo.video;d.codec=n.codec,d.profile=n.profile,d.level=n.level,d.chromaFormat=n.chromaFormat,d.frameRate=n.frameRate,d.parRatio=n.parRatio,d.width=d.width===n.presentWidth?d.width:n.presentWidth,d.height=d.height===n.presentHeight?d.width:n.presentHeight,n.duration=this._context.mediaInfo.duration*n.timescale,n.avcc=new Uint8Array(t.length),n.avcc.set(t),e.meta=n}}_switchAudioSampleRate(t){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][t]}_switchAudioSamplingFrequency(t){return[5500,11025,22050,44100,48e3][(12&t)>>>2]}_switchAudioChannel(t){return[1,2][1&t]}_datasizeValidator(t){let e=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),e===t+11}get loaderBuffer(){const t=this._context.getInstance("LOADER_BUFFER");if(t)return t;this.emit(u.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}get tracks(){return this._context.getInstance("TRACKS")}get logger(){return this._context.getInstance("LOGGER")}}e.default=d},function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i(0);const s={NUMBER:0,BOOLEAN:1,STRING:2,OBJECT:3,MIX_ARRAY:8,OBJECT_END:9,STRICT_ARRAY:10,DATE:11,LONE_STRING:12};e.default=class{constructor(){this.offset=0,this.readOffset=this.offset}resolve(t,e){if(e<3)throw new Error("not enough data for metainfo");const i={},n=this.parseValue(t),s=this.parseValue(t,e-n.bodySize);return i[n.data]=s.data,this.resetStatus(),i}resetStatus(){this.offset=0,this.readOffset=this.offset}parseString(t){const e=new DataView(t,this.readOffset).getUint16(0,!n.isLe);let i="";i=e>0?n.UTF8.decode(new Uint8Array(t,this.readOffset+2,e)):"";let s=e+2;return this.readOffset+=s,{data:i,bodySize:e+2}}parseDate(t,e){const i=new DataView(t,this.readOffset,e);let s=i.getFloat64(0,!n.isLe);return s+=60*i.getInt16(8,!n.isLe)*1e3,this.readOffset+=10,{data:new Date(s),bodySize:10}}parseObject(t,e){const i=this.parseString(t,e),n=this.parseValue(t,e-i.bodySize);return{data:{name:i.data,value:n.data},bodySize:i.bodySize+n.bodySize,isObjEnd:n.isObjEnd}}parseLongString(t){const e=new DataView(t,this.readOffset).getUint32(0,!n.isLe);let i="";return i=e>0?n.UTF8.decode(new Uint8Array(t,this.readOffset+2,e)):"",this.readOffset+=e+4,{data:i,bodySize:e+4}}parseValue(t,e){let i=new ArrayBuffer;i=t instanceof ArrayBuffer?t:t.buffer;const{NUMBER:a,BOOLEAN:n,STRING:o,OBJECT:d,MIX_ARRAY:l,OBJECT_END:h,STRICT_ARRAY:u,DATE:c,LONE_STRING:f}=s,r=new DataView(i,this.readOffset,e);let a=!1;const o=r.getUint8(0);let u=1;this.readOffset+=1;let d=null;switch(o){case a:d=r.getFloat64(1,!n.isLe),this.readOffset+=8,u+=8;break;case n:d=!!r.getUint8(1),this.readOffset+=1,u+=1;break;case o:{const t=this.parseString(i);d=t.data,u+=t.bodySize;break}case d:{d={};let t=0;for(16777215&r.getUint32(e-4,!n.isLe)&&(t=3);u<e-4;){const n=this.parseObject(i,e-u-t);if(n.isObjectEnd)break;d[n.data.name]=n.data.value,u+=n.bodySize}u<=e-3&&9==(16777215&r.getUint32(u-1,!n.isLe))&&(this.readOffset+=3,u+=3);break}case l:{d={},u+=4,this.readOffset+=4;let t=0;for(9==(16777215&r.getUint32(e-4,!n.isLe))&&(t=3);u<e-8;){const n=this.parseObject(i,e-u-t);if(n.isObjectEnd)break;d[n.data.name]=n.data.value,u+=n.bodySize}u<=e-3&&9==(16777215&r.getUint32(u-1,!n.isLe))&&(u+=3,this.readOffset+=3);break}case h:d=null,a=!0;break;case u:{d=[];const t=r.getUint32(1,!n.isLe);u+=4,this.readOffset+=4;for(let n=0;n<t;n++){const t=this.parseValue(i,e-u);d.push(t.data),u+=t.bodySize}break}case c:{const t=this.parseDate(i,e-1);d=t.data,u+=t.bodySize;break}case f:{const t=this.parseLongString(i,e-1);d=t.data,u+=t.bodySize;break}default:u=e}return{data:d,bodySize:u,isObjEnd:a}}}}])}(xgplayer)}(window)}),FlvLivePlayer=unwrapExports(dist),dist$1=createCommonjsModule(function(t,e){!function(e,i){t.exports=function(t){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};return e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(e){return t[e]}.bind(null,s));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}({"../../node_modules/events/events.js":function(t,e,i){function n(){n.init.call(this)}function s(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function r(t,e,i,n){var r,a,o,u;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),a=t._events),o=a[e]),void 0===o)o=a[e]=i,++t._eventsCount;else if("function"==typeof o?o=a[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(r=s(t))>0&&o.length>r&&!o.warned){o.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=t,d.type=e,d.count=o.length,u=d,console&&console.warn&&console.warn(u)}return t}function a(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,l(this.listener,this.target,t))}function o(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=a.bind(n);return s.listener=i,n.wrapFn=s,s}function u(t,e,i){var n=t._events;if(void 0===n)return[];var s=n[e];return void 0===s?[]:"function"==typeof s?i?[s.listener||s]:[s]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(s):f(s,s.length)}function d(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}var h,c="object"==typeof Reflect?Reflect:null,l=c&&"function"==typeof c.apply?c.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};h=c&&"function"==typeof c.ownKeys?c.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var p=Number.isNaN||function(t){return t!=t};t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var m=10;Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return m},set:function(t){if("number"!=typeof t||t<0||p(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");m=t}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||p(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return s(this)},n.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var n="error"===t,s=this._events;if(void 0!==s)n=n&&void 0===s.error;else if(!n)return!1;if(n){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var a=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw a.context=r,a}var o=s[t];if(void 0===o)return!1;if("function"==typeof o)l(o,this,e);else{var u=o.length,d=f(o,u);for(i=0;i<u;++i)l(d[i],this,e)}return!0},n.prototype.addListener=function(t,e){return r(this,t,e,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(t,e){return r(this,t,e,!0)},n.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,o(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,o(this,t,e)),this},n.prototype.removeListener=function(t,e){var i,n,s,r,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!=typeof i){for(s=-1,r=i.length-1;r>=0;r--)if(i[r]===e||i[r].listener===e){a=i[r].listener,s=r;break}if(s<0)return this;0===s?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,s),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,a||e)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var s,r=Object.keys(i);for(n=0;n<r.length;++n)"removeListener"!==(s=r[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},n.prototype.listeners=function(t){return u(this,t,!0)},n.prototype.rawListeners=function(t){return u(this,t,!1)},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},n.prototype.listenerCount=d,n.prototype.eventNames=function(){return this._eventsCount>0?h(this._events):[]}},"../xgplayer-buffer/index.js":function(t,e,i){t.exports={Track:i("../xgplayer-buffer/src/track.js").default,Tracks:i("../xgplayer-buffer/src/track.js").Tracks,AudioTrack:i("../xgplayer-buffer/src/track.js").AudioTrack,VideoTrack:i("../xgplayer-buffer/src/track.js").VideoTrack,XgBuffer:i("../xgplayer-buffer/src/buffer.js").XgBuffer,RemuxBuffer:i("../xgplayer-buffer/src/buffer.js").RemuxBuffer,PreSource:i("../xgplayer-buffer/src/presouce.js").default}},"../xgplayer-buffer/src/buffer.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.XgBuffer=class{constructor(t){this.length=t||0,this.historyLen=t||0,this.array=[],this.offset=0}push(t){this.array.push(t),this.length+=t.byteLength,this.historyLen+=t.byteLength}shift(t){if(this.array.length<1)return new Uint8Array(0);if(void 0===t)return this._shiftBuffer();if(this.offset+t===this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset=0,this.array.shift(),this.length-=t,e}if(this.offset+t<this.array[0].length){let e=this.array[0].slice(this.offset,this.offset+t);return this.offset+=t,this.length-=t,e}let e=new Uint8Array(t),i=0;for(;this.array.length>0&&t>0;){if(this.offset+t<this.array[0].length){let n=this.array[0].slice(this.offset,this.offset+t);e.set(n,i),this.offset+=t,this.length-=t,t=0;break}{let n=this.array[0].length-this.offset;e.set(this.array[0].slice(this.offset,this.array[0].length),i),this.array.shift(),this.offset=0,i+=n,this.length-=n,t-=n}}return e}clear(){this.array=[],this.length=0,this.offset=0}destroy(){this.clear(),this.historyLen=0}_shiftBuffer(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}toInt(t,e){let i=0,n=this.offset+t;for(;n<this.offset+e+t;)n<this.array[0].length?i=256*i+this.array[0][n]:this.array[1]&&(i=256*i+this.array[1][n-this.array[0].length]),n++;return i}},e.RemuxBuffer=class{constructor(){this.video=[],this.audio=[]}destroy(){this.video=[],this.audio=[]}}},"../xgplayer-buffer/src/presouce.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(){this.mimetype="",this.init=null,this.data=[]}}e.default=class{constructor(){this.sources={}}getSource(t){return this.sources[t]}createSource(t){return this.sources[t]=new n,this.sources[t]}clear(){this.sources={}}destroy(){this.sources={}}}},"../xgplayer-buffer/src/track.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(){this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0}distroy(){this.reset(),this.id=-1}}e.default=n,e.AudioTrack=class extends n{constructor(){super(),this.TAG="AudioTrack",this.type="audio"}},e.VideoTrack=class extends n{constructor(){super(),this.TAG="VideoTrack",this.type="video",this.dropped=0}reset(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}},e.Tracks=class{constructor(){this.audioTrack=null,this.videoTrack=null}destroy(){this.audioTrack=null,this.videoTrack=null}}},"../xgplayer-codec/index.js":function(t,e,i){t.exports={Nalunit:i("../xgplayer-codec/src/h264/nalunit/index.js").default,SpsParser:i("../xgplayer-codec/src/h264/nalunit/sps.js").default,Compatibility:i("../xgplayer-codec/src/compatibility.js").default}},"../xgplayer-codec/src/aac/aac-helper.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{static getSilentFrame(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}},"../xgplayer-codec/src/compatibility.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=i("../xgplayer-utils/index.js"),r=(n=i("../xgplayer-codec/src/aac/aac-helper.js"))&&n.__esModule?n:{default:n};const{REMUX_EVENTS:o}=s.EVENTS;class a{constructor(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[]}init(){this.before(o.REMUX_MEDIA,this.doFix.bind(this))}reset(){this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[]}doFix(){const{isFirstAudioSamples:e,isFirstVideoSamples:t}=this.getFirstSample();this.removeInvalidSamples(),this.recordSamplesCount(),this._firstVideoSample&&this.fixRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples),this._firstAudioSample&&this.fixRefSampleDuration(this.audioTrack.meta,this.audioTrack.samples),this.doFixVideo(t),this.doFixAudio(e)}doFixVideo(t){let{samples:t,meta:s}=this.videoTrack;if((!s.frameRate||!1!==s.frameRate.fixed)&&t&&t.length&&this._firstVideoSample){const e=t[0],i=e.dts,n=t.length;if(t&&this._firstAudioSample){const t=this._firstVideoSample.dts,i=t-this._firstAudioSample.dts;if(i>2*s.refSampleDuration){const n=Math.floor(i/s.refSampleDuration);for(let i=0;i<n;i++){const n=Object.assign({},e);n.dts=t-(i+1)*s.refSampleDuration,n.pts=n.dts+n.cts,t.unshift(n),this.filledVideoSamples.push({dts:n.dts,size:n.data.byteLength})}}}let s;if(this.nextVideoDts){s=i-this.nextVideoDts;const t=Math.abs(s);if(s>2*s.refSampleDuration){const t=Math.floor(s/s.refSampleDuration);for(let e=0;e<t;e++){const t=Object.assign({},t[0]),n=i-(e+1)*s.refSampleDuration;t.dts=n>this.nextVideoDts?n:this.nextVideoDts,t.pts=t.dts+t.cts,this.videoTrack.samples.unshift(t),this.filledVideoSamples.push({dts:t.dts,size:t.data.byteLength})}}else t<=10&&t>0&&(t[0].dts=this.nextVideoDts,t[0].originDts=t[0].dts,t[0].cts=t[0].cts||t[0].pts-t[0].dts,t[0].pts=t[0].dts+t[0].cts)}const r=t[t.length-1].dts,a=t.length>=2?r-t[t.length-2].dts:s.refSampleDuration;this.lastVideoSamplesLen=n,this.nextVideoDts=r+a,this.lastVideoDts=r;for(let t=0,e=t.length;t<e;t++){const e=t[t],i=t[t+1];if(!i)break;const n=i.dts-e.dts;if(n>2*s.refSampleDuration){let s=Math.floor(n/s.refSampleDuration),r=0;for(;r<s;){const n=Object.assign({},i);n.dts=e.dts+(r+1)*s.refSampleDuration,n.pts=n.dts+n.cts,n<i.dts&&(t.splice(t,0,n),this.filledVideoSamples.push({dts:n.dts,size:n.data.byteLength})),r++,t++}}}this.videoTrack.samples=t}}doFixAudio(t){let{samples:t,meta:s}=this.audioTrack;if(t&&t.length){const e=t.length,i=r.default.getSilentFrame(s.codec,s.channelCount),n=this._firstAudioSample;if(this._firstVideoSample&&t){const t=this._firstVideoSample.pts?this._firstVideoSample.pts:this._firstVideoSample.dts+this._firstVideoSample.cts;if(n.dts-t>s.refSampleDuration){const e=Math.floor((n.dts-t)/s.refSampleDuration);for(let t=0;t<e;t++){const e={data:i,datasize:i.byteLength,dts:n.dts-(t+1)*s.refSampleDuration,filtered:0};t.unshift(e),this.filledAudioSamples.push({dts:e.dts,size:e.data.byteLength})}}}let s;const o=t[0].dts;if(this.nextAudioDts){s=o-this.nextAudioDts;const t=Math.abs(s);if(t>s.refSampleDuration&&1===e&&1===this.lastAudioSamplesLen&&(s.refSampleDurationFixed=void 0),s>2*s.refSampleDuration)if(1===e&&1===this.lastAudioSamplesLen)s.refSampleDurationFixed=void 0!==s.refSampleDurationFixed?s.refSampleDurationFixed+s:s.refSampleDuration+s;else{const t=Math.floor(s/s.refSampleDuration);for(let e=0;e<t;e++){const t=o-(e+1)*s.refSampleDuration,i=Object.assign({},t[0],{dts:t>this.nextAudioDts?t:this.nextAudioDts});this.filledAudioSamples.push({dts:i.dts,size:i.data.byteLength}),this.audioTrack.samples.unshift(i)}}else t<=10&&t>0&&(t[0].dts=this.nextAudioDts,t[0].pts=this.nextAudioDts)}const u=t[t.length-1].dts,d=t.length>=2?u-t[t.length-2].dts:s.refSampleDuration;this.lastAudioSamplesLen=e,this.nextAudioDts=s.refSampleDurationFixed?u+s.refSampleDurationFixed:u+d,this.lastAudioDts=u;for(let t=0,e=t.length;t<e;t++){const e=t[t],i=t[t+1];if(!i)break;const n=i.dts-e.dts;t[t].duration=n}this.audioTrack.samples=a.sortAudioSamples(t)}}getFirstSample(){let{samples:e}=this.videoTrack,{samples:t}=this.audioTrack,t=!1,e=!1;return!this._firstVideoSample&&e.length&&(this._firstVideoSample=a.findFirstVideoSample(e),t=!0),!this._firstAudioSample&&t.length&&(this._firstAudioSample=a.findFirstAudioSample(t),e=!0),{isFirstVideoSamples:t,isFirstAudioSamples:e}}fixRefSampleDuration(t,e){const i="video"===t.type,n=i?this.allVideoSamplesCount:this.allAudioSamplesCount,s=i?this._firstVideoSample.dts:this._firstAudioSample.dts,r=i?this.filledVideoSamples.length:this.filledAudioSamples.length;if(!t.refSampleDuration||t.refSampleDuration<=0||Number.isNaN(t.refSampleDuration)){if(e.length>=1){const i=e[e.length-1].dts;t.refSampleDuration=Math.floor((i-s)/(n+r-1))}}else if(t.refSampleDuration&&e.length>=3){const i=(e[e.length-1].dts-e[0].dts)/(e.length-1);t.refSampleDuration=Math.abs(t.refSampleDuration-i)<=t.refSampleDuration?t.refSampleDuration:i}}recordSamplesCount(){const{audioTrack:e,videoTrack:t}=this;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}removeInvalidSamples(){const{_firstVideoSample:e,_firstAudioSample:t}=this;this.audioTrack.samples=this.audioTrack.samples.filter(t=>t.dts>=t.dts&&(void 0===this.lastAudioDts||t.dts>this.lastAudioDts)),this.videoTrack.samples=this.videoTrack.samples.filter(t=>t.dts>=e.dts&&(void 0===this.lastVideoDts||t.dts>this.lastVideoDts))}static sortAudioSamples(t){return 1===t.length?t:t.sort((t,e)=>t.dts-e.dts)}static findFirstAudioSample(t){return t&&0!==t.length?a.sortAudioSamples(t)[0]:null}static findFirstVideoSample(t){if(!t.length)return null;const e=t.sort((t,e)=>t.dts-e.dts);for(let t=0,i=e.length;t<i;t++)if(e[t].isKeyframe)return e[t]}get tracks(){return this._context.getInstance("TRACKS")}get audioTrack(){return this.tracks?this.tracks.audioTrack:null}get videoTrack(){return this.tracks?this.tracks.videoTrack:null}}e.default=a},"../xgplayer-codec/src/h264/nalunit/golomb.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}destroy(){this._buffer=null}_fillCurrentWord(){let t=this._totalBytes-this._bufferIndex,e=Math.min(4,t),i=new Uint8Array(4);i.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+e)),this._currentWord=new DataView(i.buffer).getUint32(0,!1),this._bufferIndex+=e,this._currentWordBitsLeft=8*e}readBits(t){if(t<=this._currentWordBitsLeft){let e=this._currentWord>>>32-t;return this._currentWord<<=t,this._currentWordBitsLeft-=t,e}let e=this._currentWordBitsLeft?this._currentWord:0;this._currentWordBitsLeft;let i=t-this._currentWordBitsLeft;this._fillCurrentWord();let n=Math.min(i,this._currentWordBitsLeft),s=this._currentWord>>>32-n;return this._currentWord<<=n,this._currentWordBitsLeft-=n,e=e<<n|s}readBool(){return 1===this.readBits(1)}readByte(){return this.readBits(8)}_skipLeadingZero(){let t;for(t=0;t<this._currentWordBitsLeft;t++)if(0!=(this._currentWord&2147483648>>>t))return this._currentWord<<=t,this._currentWordBitsLeft-=t,t;return this._fillCurrentWord(),t+this._skipLeadingZero()}readUEG(){let t=this._skipLeadingZero();return this.readBits(t+1)-1}readSEG(){let t=this.readUEG();return 1&t?t+1>>>1:-1*(t>>>1)}}},"../xgplayer-codec/src/h264/nalunit/index.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=(n=i("../xgplayer-codec/src/h264/nalunit/sps.js"))&&n.__esModule?n:{default:n};class r{static getNalunits(t){if(t.length-t.position<4)return[];let e=t.dataview,i=t.position;return 1===e.getInt32(i)||0===e.getInt16(i)&&1===e.getInt8(i+2)?r.getAnnexbNals(t):r.getAvccNals(t)}static getAnnexbNals(t){let e=[],i=r.getHeaderPositionAnnexB(t),n=i.pos,s=n;for(;n<t.length-4;){let a=t.buffer.slice(n,n+i.headerLength);i.pos===t.position&&t.skip(i.headerLength),s=(i=r.getHeaderPositionAnnexB(t)).pos;let o={header:a,body:new Uint8Array(t.buffer.slice(n+a.byteLength,s))};r.analyseNal(o),e.push(o),t.skip(s-t.position),n=s}return e}static getAvccNals(t){let e=[];for(;t.position<t.length-4;){let i=t.dataview.getInt32();if(!(t.length-t.position>=i))break;{let n=t.buffer.slice(t.position,t.position+4);t.skip(4);let s=t.buffer.slice(t.position,t.position+i);t.skip(i);let a={header:n,body:s};r.analyseNal(a),e.push(a)}}return e}static analyseNal(t){switch(31&t.body[0]){case 1:t.ndr=!0;break;case 5:t.idr=!0;break;case 6:break;case 7:t.sps=s.default.parseSPS(t.body);break;case 8:t.pps=!0}}static getHeaderPositionAnnexB(t){let e=t.position,i=0;for(;3!==i&&4!==i&&e<t.length-4;)0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)?i=4:1===t.dataview.getInt8(e+2)?i=3:e++:e++;return e===t.length-4&&(0===t.dataview.getInt16(e)?1===t.dataview.getInt16(e+2)&&(i=4):(e++,0===t.dataview.getInt16(e)&&1===t.dataview.getInt8(e)?i=3:e=t.length)),{pos:e,headerLength:i}}static getAvcc(t,e){let i=new Uint8Array(t.byteLength+e.byteLength+11);i[0]=1,i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=255,i[5]=225;let n=6;return i.set(new Uint8Array([t.byteLength>>>8&255,255&t.byteLength]),n),n+=2,i.set(t,n),i[n+=t.byteLength]=1,n++,i.set(new Uint8Array([e.byteLength>>>8&255,255&e.byteLength]),n),n+=2,i.set(e,n),i}}e.default=r},"../xgplayer-codec/src/h264/nalunit/sps.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=(n=i("../xgplayer-codec/src/h264/nalunit/golomb.js"))&&n.__esModule?n:{default:n};class r{static _ebsp2rbsp(t){let e=t,i=e.byteLength,n=new Uint8Array(i),s=0;for(let t=0;t<i;t++)t>=2&&3===e[t]&&0===e[t-1]&&0===e[t-2]||(n[s]=e[t],s++);return new Uint8Array(n.buffer,0,s)}static parseSPS(t){let e=r._ebsp2rbsp(t),i=new s.default(e);i.readByte();let n=i.readByte();i.readByte();let a=i.readByte();i.readUEG();let o=r.getProfileString(n),u=r.getLevelString(a),d=1,f=420,h=[0,420,422,444],c=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(d=i.readUEG())&&i.readBits(1),d<=3&&(f=h[d]),c=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool())){let t=3!==d?8:12;for(let e=0;e<t;e++)i.readBool()&&(e<6?r._skipScalingList(i,16):r._skipScalingList(i,64))}i.readUEG();let l=i.readUEG();if(0===l)i.readUEG();else if(1===l){i.readBits(1),i.readSEG(),i.readSEG();let t=i.readUEG();for(let e=0;e<t;e++)i.readSEG()}i.readUEG(),i.readBits(1);let p=i.readUEG(),m=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);let _=0,y=0,E=0,v=0;i.readBool()&&(_=i.readUEG(),y=i.readUEG(),E=i.readUEG(),v=i.readUEG());let A=1,S=1,b=0,T=!0,w=0,x=0;if(i.readBool()){if(i.readBool()){let t=i.readByte(),e=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],n=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];t>0&&t<16?(A=e[t-1],S=n[t-1]):255===t&&(A=i.readByte()<<8|i.readByte(),S=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){let t=i.readBits(32),e=i.readBits(32);T=i.readBool(),b=(w=e)/(x=2*t)}}let D=1;1===A&&1===S||(D=A/S);let R=0,O=0;0===d?(R=1,O=2-g):(R=3===d?1:2,O=(1===d?2:1)*(2-g));let L=16*(p+1),M=16*(m+1)*(2-g);L-=(_+y)*R,M-=(E+v)*O;let U=Math.ceil(L*D);return i.destroy(),i=null,{profile_string:o,level_string:u,bit_depth:c,chroma_format:f,chroma_format_string:r.getChromaFormatString(f),frame_rate:{fixed:T,fps:b,fps_den:x,fps_num:w},par_ratio:{width:A,height:S},codec_size:{width:L,height:M},present_size:{width:U,height:M}}}static _skipScalingList(t,e){let i=8,n=8;for(let s=0;s<e;s++)0!==n&&(n=(i+t.readSEG()+256)%256),i=0===n?i:n}static getProfileString(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}static getLevelString(t){return(t/10).toFixed(1)}static getChromaFormatString(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}static toVideoMeta(t){let e={};t&&t.codec_size&&(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e.parRatio={width:t.par_ratio.width,height:t.par_ratio.height},e.frameRate=t.frame_rate;let i=e.frameRate.fps_den,n=e.frameRate.fps_num;e.refSampleDuration=Math.floor(e.timescale*(i/n))}}e.default=r},"../xgplayer-demux/src/flv/amf-parser.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i("../xgplayer-utils/index.js");const s={NUMBER:0,BOOLEAN:1,STRING:2,OBJECT:3,MIX_ARRAY:8,OBJECT_END:9,STRICT_ARRAY:10,DATE:11,LONE_STRING:12};e.default=class{constructor(){this.offset=0,this.readOffset=this.offset}resolve(t,e){if(e<3)throw new Error("not enough data for metainfo");const i={},n=this.parseValue(t),s=this.parseValue(t,e-n.bodySize);return i[n.data]=s.data,this.resetStatus(),i}resetStatus(){this.offset=0,this.readOffset=this.offset}parseString(t){const e=new DataView(t,this.readOffset).getUint16(0,!n.isLe);let i="";i=e>0?n.UTF8.decode(new Uint8Array(t,this.readOffset+2,e)):"";let s=e+2;return this.readOffset+=s,{data:i,bodySize:e+2}}parseDate(t,e){const i=new DataView(t,this.readOffset,e);let s=i.getFloat64(0,!n.isLe);return s+=60*i.getInt16(8,!n.isLe)*1e3,this.readOffset+=10,{data:new Date(s),bodySize:10}}parseObject(t,e){const i=this.parseString(t,e),n=this.parseValue(t,e-i.bodySize);return{data:{name:i.data,value:n.data},bodySize:i.bodySize+n.bodySize,isObjEnd:n.isObjEnd}}parseLongString(t){const e=new DataView(t,this.readOffset).getUint32(0,!n.isLe);let i="";return i=e>0?n.UTF8.decode(new Uint8Array(t,this.readOffset+2,e)):"",this.readOffset+=e+4,{data:i,bodySize:e+4}}parseValue(t,e){let i=new ArrayBuffer;i=t instanceof ArrayBuffer?t:t.buffer;const{NUMBER:a,BOOLEAN:n,STRING:o,OBJECT:l,MIX_ARRAY:d,OBJECT_END:u,STRICT_ARRAY:h,DATE:c,LONE_STRING:f}=s,r=new DataView(i,this.readOffset,e);let a=!1;const o=r.getUint8(0);let u=1;this.readOffset+=1;let d=null;switch(o){case a:d=r.getFloat64(1,!n.isLe),this.readOffset+=8,u+=8;break;case n:d=!!r.getUint8(1),this.readOffset+=1,u+=1;break;case o:{const t=this.parseString(i);d=t.data,u+=t.bodySize;break}case l:{d={};let t=0;for(16777215&r.getUint32(e-4,!n.isLe)&&(t=3);u<e-4;){const n=this.parseObject(i,e-u-t);if(n.isObjectEnd)break;d[n.data.name]=n.data.value,u+=n.bodySize}u<=e-3&&9==(16777215&r.getUint32(u-1,!n.isLe))&&(this.readOffset+=3,u+=3);break}case d:{d={},u+=4,this.readOffset+=4;let t=0;for(9==(16777215&r.getUint32(e-4,!n.isLe))&&(t=3);u<e-8;){const n=this.parseObject(i,e-u-t);if(n.isObjectEnd)break;d[n.data.name]=n.data.value,u+=n.bodySize}u<=e-3&&9==(16777215&r.getUint32(u-1,!n.isLe))&&(u+=3,this.readOffset+=3);break}case u:d=null,a=!0;break;case h:{d=[];const t=r.getUint32(1,!n.isLe);u+=4,this.readOffset+=4;for(let n=0;n<t;n++){const t=this.parseValue(i,e-u);d.push(t.data),u+=t.bodySize}break}case c:{const t=this.parseDate(i,e-1);d=t.data,u+=t.bodySize;break}case f:{const t=this.parseLongString(i,e-1);d=t.data,u+=t.bodySize;break}default:u=e}return{data:d,bodySize:u,isObjEnd:a}}}},"../xgplayer-demux/src/flv/index.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=i("../xgplayer-utils/index.js"),r=i("../xgplayer-codec/index.js"),a=i("../xgplayer-buffer/index.js"),o=(n=i("../xgplayer-demux/src/flv/amf-parser.js"))&&n.__esModule?n:{default:n};const u=s.EVENTS.DEMUX_EVENTS;class d{constructor(){this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1}init(){this.on(u.DEMUX_START,this.doParseFlv.bind(this))}static isFlvFile(t){return!(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])}static getPlayType(t){const e={hasVideo:!1,hasAudio:!1};return!0&t&&(e.hasVideo=!0),!0&t&&(e.hasAudio=!0),e}doParseFlv(){if(this._firstFragmentLoaded){if(this.loaderBuffer.length<11)return;let t,e=1e5;do{t=this._parseFlvTag()}while(t&&e-- >0);this.emit(u.DEMUX_COMPLETE)}else{if(this.loaderBuffer.length<13)return;const t=this.loaderBuffer.shift(13);this.parseFlvHeader(t),this.doParseFlv()}}parseFlvHeader(t){if(d.isFlvFile(t)){this._firstFragmentLoaded=!0;const e=d.getPlayType(t[4]);e.hasVideo&&this.initVideoTrack(),e.hasAudio&&this.initAudioTrack()}else this.emit(u.DEMUX_ERROR,new Error("invalid flv file")),this.doParseFlv();this.doParseFlv()}initVideoTrack(){this._trackNum++;let t=new a.VideoTrack;t.meta=new s.VideoTrackMeta,t.id=t.meta.id=this._trackNum,this.tracks.videoTrack=t}initAudioTrack(){this._trackNum++;let t=new a.AudioTrack;t.meta=new s.AudioTrackMeta,t.id=t.meta.id=this._trackNum,this.tracks.audioTrack=t}_parseFlvTag(){if(this.loaderBuffer.length<11)return null;let t=this._parseFlvTagHeader();return t&&this._processChunk(t),t}_parseFlvTagHeader(){let t=0,e={},i=this.loaderBuffer.toInt(t,1);if(t+=1,e.filtered=(32&i)>>>5,e.tagType=31&i,e.datasize=this.loaderBuffer.toInt(t,3),t+=3,8!==e.tagType&&9!==e.tagType&&11!==e.tagType&&18!==e.tagType||0!==this.loaderBuffer.toInt(8,3))return this.loaderBuffer&&this.loaderBuffer.length>0&&this.loaderBuffer.shift(1),this.logger.warn(this.TAG,"tagType "+e.tagType),null;if(this.loaderBuffer.length<e.datasize+15)return null;this.loaderBuffer.shift(4);let n=this.loaderBuffer.toInt(0,3);this.loaderBuffer.shift(3);let s=this.loaderBuffer.shift(1)[0];return s>0&&(n+=16777216*s),e.dts=n,this.loaderBuffer.shift(3),e}_processChunk(t){switch(t.tagType){case 18:this._parseScriptData(t);break;case 8:this._parseAACData(t);break;case 9:this._parseHevcData(t);break;case 11:this.loaderBuffer.shift(3);break;default:this.loaderBuffer.shift(1)}}_parseScriptData(t){let e=this.tracks.audioTrack,i=this.tracks.videoTrack,n=this.loaderBuffer.shift(t.datasize);const s=(new o.default).resolve(n,n.length),r=this._context.onMetaData=s?s.onMetaData:void 0;if(this._context.mediaInfo.duration=r.duration,this._context.mediaInfo.hasVideo=r.hasVideo,this._context.mediaInfo.hsaAudio=r.hasAudio,this._datasizeValidator(t.datasize)&&(this.emit(u.MEDIA_INFO),this._hasScript=!0),e&&!e.hasSpecificConfig){let t=e.meta;switch(r.audiosamplerate&&(t.sampleRate=r.audiosamplerate),r.audiochannels&&(t.channelCount=r.audiochannels),r.audiosamplerate){case 44100:t.sampleRateIndex=4;break;case 22050:t.sampleRateIndex=7;break;case 11025:t.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){let t=i.meta;if("number"==typeof r.framerate){let e=Math.floor(1e3*r.framerate);if(e>0){let i=e/1e3;t.frameRate||(t.frameRate={}),t.frameRate.fixed=!0,t.frameRate.fps=i,t.frameRate.fps_num=e,t.frameRate.fps_den=1e3}}}}_aacSequenceHeaderParser(t){let e={hasSpecificConfig:!0};e.objectType=t[1]>>>3,e.sampleRateIndex=(7&t[1])<<1|t[2]>>>7,e.audiosamplerate=this._switchAudioSampleRate(e.sampleRateIndex),e.channelCount=(120&t[2])>>>3,e.frameLength=(4&t[2])>>>2,e.dependsOnCoreCoder=(2&t[2])>>>1,e.extensionFlagIndex=1&t[2],e.codec=`mp4a.40.${e.objectType}`;let i,n,s=window.navigator.userAgent.toLowerCase(),r=e.sampleRateIndex;return-1!==s.indexOf("firefox")?e.sampleRateIndex>=6?(e.objectType=5,n=new Array(4),i=r-3):(e.objectType=2,n=new Array(2),i=r):-1!==s.indexOf("android")?(e.objectType=2,n=new Array(2),i=r):(e.objectType=5,i=e.sampleRateIndex,n=new Array(4),e.sampleRateIndex>=6?i=e.sampleRateIndex-3:1===e.channelCount&&(e.objectType=2,n=new Array(2),i=e.sampleRateIndex)),n[0]=e.objectType<<3,n[0]|=(15&e.sampleRateIndex)>>>1,n[1]=(15&e.sampleRateIndex)<<7,n[1]|=(15&e.channelCount)<<3,5===e.objectType&&(n[1]|=(15&i)>>>1,n[2]=(1&i)<<7,n[2]|=8,n[3]=0),e.config=n,e}_parseAACData(t){let e=this.tracks.audioTrack;if(e){let i=e.meta;i||(i=new s.AudioTrackMeta);let n=this.loaderBuffer.shift(1)[0];t.data=this.loaderBuffer.shift(t.datasize-1);let r=(240&n)>>>4;e.format=r,10!==r&&this.emit(u.DEMUX_ERROR,new Error(`invalid audio format: ${r}`)),10!==r||this._hasAudioSequence||(i.sampleRate=this._switchAudioSamplingFrequency(n),i.sampleRateIndex=(12&n)>>>2,i.frameLenth=(2&n)>>>1,i.channelCount=1&n,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));let a=i.audioSampleRate,o=i.sampleRateIndex,d=i.refSampleDuration;delete t.tagType;let f=this._datasizeValidator(t.datasize);if(0===t.data[0]){let e=this._aacSequenceHeaderParser(t.data);a=e.audiosamplerate||i.audioSampleRate,o=e.sampleRateIndex||i.sampleRateIndex,d=Math.floor(1024/a*i.timescale),i.channelCount=e.channelCount,i.sampleRate=a,i.sampleRateIndex=o,i.refSampleDuration=d,i.duration=this._context.mediaInfo.duration*i.timescale,i.config=e.config;const n=this._context.mediaInfo.audio;n.codec=e.codec,n.channelCount=e.channelCount,n.sampleRate=a,n.sampleRateIndex=e.audioSampleRateIndex,this._hasScript&&!this._hasAudioSequence?this.emit(u.METADATA_PARSED,"audio"):this._hasScript&&this._hasAudioSequence&&this.emit(u.AUDIO_METADATA_CHANGE),this._hasAudioSequence=!0}else t.data=t.data.slice(1,t.data.length),e.samples.push(t);if(!f){const e=new Error("TAG length error at "+t.datasize);this.emit(u.DEMUX_ERROR,e.message),this.logger.warn(this.TAG,e.message)}}}_parseHevcData(t){let e=this.loaderBuffer.shift(1)[0];t.frameType=(240&e)>>>4,t.isKeyframe=1===t.frameType;let i=15&e;if(this.tracks.videoTrack.codecID=i,t.avcPacketType=this.loaderBuffer.shift(1)[0],t.cts=this.loaderBuffer.toInt(0,3),this.loaderBuffer.shift(3),12===i){const e=this.loaderBuffer.shift(t.datasize-5);if(t.data=e,0!==Number.parseInt(t.avcPacketType)){this._datasizeValidator(t.datasize)||this.logger.warn(this.TAG,`invalid video tag datasize: ${t.datasize}`);let e={},i=0;for(e.cts=t.cts,e.dts=t.dts;t.data.length>i;){let n=t.data.slice(Number.parseInt(i),4+i);e.size=n[3],e.size+=256*n[2],e.size+=256*n[1]*256,e.size+=256*n[0]*256*256,i+=4,e.data=t.data.slice(Number.parseInt(i),e.size+i),i+=e.size,this.tracks.videoTrack.samples.push(e),this.emit(u.METADATA_PARSED,"video")}}else 0===Number.parseInt(t.avcPacketType)&&(this._datasizeValidator(t.datasize)?this.emit(u.METADATA_PARSED,"video"):this.logger.warn(this.TAG,`invalid video tag datasize: ${t.datasize}`))}else if(7===i){let e=this.loaderBuffer.shift(t.datasize-5);if(0===e[4]&&0===e[5]&&0===e[6]&&1===e[7]){let t=0;for(let i=0;i<4;i++)t=256*t+e[i];t-=4,(e=e.slice(4,e.length))[3]=t%256,t=(t-e[3])/256,e[2]=t%256,t=(t-e[2])/256,e[1]=t%256,e[0]=(t-e[1])/256}if(t.data=e,0===t.avcPacketType)this._avcSequenceHeaderParser(t.data),this._datasizeValidator(t.datasize)&&(this._hasScript&&!this._hasVideoSequence?this.emit(u.METADATA_PARSED,"video"):this._hasScript&&this._hasVideoSequence&&this.emit(u.VIDEO_METADATA_CHANGE),this._hasVideoSequence=!0);else{if(!this._datasizeValidator(t.datasize))return void this.logger.warn(this.TAG,`invalid video tag datasize: ${t.datasize}`);this.tracks.videoTrack.samples.push(t)}}else this.logger.warn(this.TAG,`video codeid is ${i}`),t.data=this.loaderBuffer.shift(t.datasize-1),this._datasizeValidator(t.datasize)||this.logger.warn(this.TAG,`invalid video tag datasize: ${t.datasize}`),this.tracks.videoTrack.samples.push(t),this.emit(u.DEMUX_COMPLETE);delete t.tagType}_avcSequenceHeaderParser(t){let e=this.tracks.videoTrack;if(e){let i=0;e.meta||(e.meta=new s.VideoTrackMeta);let n=e.meta;n.configurationVersion=t[0],n.avcProfileIndication=t[1],n.profileCompatibility=t[2],n.avcLevelIndication=t[3]/10,n.nalUnitLength=1+(3&t[4]);let a=31&t[5];i=6;let o={};for(let e=0;e<a;e++){let e=255*t[i]+t[i+1];i+=2;let s=new Uint8Array(e);for(let n=0;n<e;n++)s[n]=t[i+n];let a="avc1.";for(let t=1;t<4;t++){let e=s[t].toString(16);e.length<2&&(e="0"+e),a+=e}n.codec=a,i+=e,this.tracks.videoTrack.meta.sps=s,o=r.SpsParser.parseSPS(s)}let u=t[i];i++;for(let e=0;e<u;e++){let e=255*t[i]+t[i+1];i+=2;let n=new Uint8Array(e);for(let s=0;s<e;s++)n[s]=t[i+s];i+=e,this.tracks.videoTrack.meta.pps=n}Object.assign(n,r.SpsParser.toVideoMeta(o));const d=this._context.mediaInfo.video;d.codec=n.codec,d.profile=n.profile,d.level=n.level,d.chromaFormat=n.chromaFormat,d.frameRate=n.frameRate,d.parRatio=n.parRatio,d.width=d.width===n.presentWidth?d.width:n.presentWidth,d.height=d.height===n.presentHeight?d.width:n.presentHeight,n.duration=this._context.mediaInfo.duration*n.timescale,n.avcc=new Uint8Array(t.length),n.avcc.set(t),e.meta=n}}_switchAudioSampleRate(t){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][t]}_switchAudioSamplingFrequency(t){return[5500,11025,22050,44100,48e3][(12&t)>>>2]}_switchAudioChannel(t){return[1,2][1&t]}_datasizeValidator(t){let e=this.loaderBuffer.toInt(0,4);return this.loaderBuffer.shift(4),e===t+11}get loaderBuffer(){const t=this._context.getInstance("LOADER_BUFFER");if(t)return t;this.emit(u.DEMUX_ERROR,new Error("找不到 loaderBuffer 实例"))}get tracks(){return this._context.getInstance("TRACKS")}get logger(){return this._context.getInstance("LOGGER")}}e.default=d},"../xgplayer-loader/index.js":function(t,e,i){t.exports={FetchLoader:i("../xgplayer-loader/src/fetch-loader.js").default}},"../xgplayer-loader/src/fetch-loader.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=i("../xgplayer-utils/index.js").EVENTS.LOADER_EVENTS;e.default=class{constructor(t){this.configs=Object.assign({},t),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0}init(){this.on(n.LADER_START,this.load.bind(this))}static get type(){return"loader"}load(t,e){let i=this;this.url=t,this._canceled=!1;let s=this.getParams(e);return i.loading=!0,fetch(this.url,s).then(function(t){if(t.ok)return i.status=t.status,i._onFetchResponse(t);i.emit(n.LOADER_ERROR,i,t),i.loading=!1}).catch(function(t){throw i.emit(n.LOADER_ERROR,i,t),i.loading=!1,new Error(t.message)})}_onFetchResponse(t){let e=this,i=this._context.getInstance(this.buffer),s=++this._loaderTaskNo;if(!0===t.ok)switch(this.readtype){case 2:t.json().then(t=>{e.loading=!1,e._canceled||(i?(i.push(t),e.emit(n.LOADER_COMPLETE,i)):e.emit(n.LOADER_COMPLETE,t))});break;case 1:t.text().then(t=>{e.loading=!1,e._canceled||(i?(i.push(t),e.emit(n.LOADER_COMPLETE,i)):e.emit(n.LOADER_COMPLETE,t))});break;case 3:t.arrayBuffer().then(t=>{e.loading=!1,e._canceled||(i?(i.push(new Uint8Array(t)),e.emit(n.LOADER_COMPLETE,i)):e.emit(n.LOADER_COMPLETE,t))});break;case 0:default:return this._onReader(t.body.getReader(),s)}}_onReader(t,e){let i=this._context.getInstance(this.buffer);if(i||this._reader.cancel(),this._reader=t,!1!==this.loading){let s=this;this._reader&&this._reader.read().then(function(r){return r.done?(s.loading=!1,s.status=0,void s.emit(n.LOADER_COMPLETE,i)):s._canceled?void s._reader.cancel():(i.push(r.value),s.emit(n.LOADER_DATALOADED,i),s._onReader(t,e))}).catch(t=>{s.emit(n.LOADER_ERROR,s,t),s.loading=!1})}}getParams(t){let e=Object.assign({},t),i=new Headers,n={method:"GET",headers:i,mode:"cors",cache:"default"};if("object"==typeof this.configs.headers){let t=this.configs.headers;for(let e in t)t.hasOwnProperty(e)&&i.append(e,t[e])}if("object"==typeof e.headers){let t=e.headers;for(let e in t)t.hasOwnProperty(e)&&i.append(e,t[e])}return!1===e.cors&&(n.mode="same-origin"),e.withCredentials&&(n.credentials="include"),n}cancel(){if(this._reader){try{this._reader.cancel()}catch(t){}this._reader=null,this.loading=!1,this._canceled=!0}}destroy(){this.cancel()}}},"../xgplayer-remux/index.js":function(t,e,i){t.exports={Mp4Remuxer:i("../xgplayer-remux/src/mp4/index.js").default}},"../xgplayer-remux/src/mp4/fmp4.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n=i("../xgplayer-utils/index.js");class s{static size(t){return n.Buffer.writeUint32(t)}static initBox(t,e,...i){const r=new n.Buffer;return r.write(s.size(t),s.type(e),...i),r.buffer}static extension(t,e){return new Uint8Array([t,e>>16&255,e>>8&255,255&e])}static ftyp(){return s.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}static moov({type:e,meta:t}){let i,n=8,r=s.mvhd(t.duration,t.timescale);i="video"===e?s.videoTrak(t):s.audioTrak(t);let a=s.mvex(t.duration,t.timescale||1e3,t.id);return[r,i,a].forEach(t=>{n+=t.byteLength}),s.initBox(n,"moov",r,i,a)}static mvhd(t,e=1e3){let i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return s.initBox(8+i.length,"mvhd",new Uint8Array(i))}static videoTrak(t){let e=8,i=s.tkhd({id:1,duration:t.duration,timescale:t.timescale||1e3,width:t.presentWidth,height:t.presentHeight,type:"video"}),n=s.mdia({type:"video",timescale:t.timescale||1e3,duration:t.duration,avcc:t.avcc,parRatio:t.parRatio,width:t.presentWidth,height:t.presentHeight});return[i,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"trak",i,n)}static audioTrak(t){let e=8,i=s.tkhd({id:2,duration:t.duration,timescale:t.timescale||1e3,width:0,height:0,type:"audio"}),n=s.mdia({type:"audio",timescale:t.timescale||1e3,duration:t.duration,channelCount:t.channelCount,samplerate:t.sampleRate,config:t.config});return[i,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"trak",i,n)}static tkhd(t){let e=t.id,i=t.duration,n=t.width,r=t.height,a=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>>8&255,255&n,0,0,r>>>8&255,255&r,0,0]);return s.initBox(8+a.byteLength,"tkhd",a)}static edts(t){let e=new n.Buffer,i=t.duration,r=t.mediaTime;return e.write(s.size(36),s.type("edts")),e.write(s.size(28),s.type("elst")),e.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,1])),e.buffer}static mdia(t){let e=8,i=s.mdhd(t.timescale,t.duration),n=s.hdlr(t.type),r=s.minf(t);return[i,n,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"mdia",i,n,r)}static mdhd(t=1e3,e){let i=new Uint8Array([0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,85,196,0,0]);return s.initBox(12+i.byteLength,"mdhd",s.extension(0,0),i)}static hdlr(t){let e=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(e.splice(8,4,115,111,117,110),e.splice(24,13,83,111,117,110,100,72,97,110,100,108,101,114,0)),s.initBox(8+e.length,"hdlr",new Uint8Array(e))}static minf(t){let e=8,i="video"===t.type?s.vmhd():s.smhd(),n=s.dinf(),r=s.stbl(t);return[i,n,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"minf",i,n,r)}static vmhd(){return s.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}static smhd(){return s.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}static dinf(){let t=new n.Buffer;return t.write(s.size(36),s.type("dinf"),s.size(28),s.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}static stbl(t){let e=8,i=s.stsd(t),n=s.stts(),r=s.stsc(),a=s.stsz(),o=s.stco();return[i,n,r,a,o].forEach(t=>{e+=t.byteLength}),s.initBox(e,"stbl",i,n,r,a,o)}static stsd(t){let e;return e="audio"===t.type?s.mp4a(t):s.avc1(t),s.initBox(16+e.byteLength,"stsd",s.extension(0,0),new Uint8Array([0,0,0,1]),e)}static mp4a(t){let e=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.samplerate>>8&255,255&t.samplerate,0,0]),i=s.esds(t.config);return s.initBox(8+e.byteLength+i.byteLength,"mp4a",e,i)}static esds(t=[43,146,8,0]){const e=t.length;let i=new n.Buffer,r=new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t).concat([6,1,2]));return i.write(s.size(8+r.byteLength),s.type("esds"),r),i.buffer}static avc1(t){let e=new n.Buffer,i=t.width,r=t.height,a=t.parRatio.height,o=t.parRatio.width,u=t.avcc,d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,r>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),h=new Uint8Array([a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o]);return e.write(s.size(40+d.byteLength+u.byteLength+f.byteLength),s.type("avc1"),d,s.size(8+u.byteLength),s.type("avcC"),u,s.size(20),s.type("btrt"),f,s.size(16),s.type("pasp"),h),e.buffer}static stts(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stts",t)}static stsc(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stsc",t)}static stco(){let t=new Uint8Array([0,0,0,0,0,0,0,0]);return s.initBox(16,"stco",t)}static stsz(){let t=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return s.initBox(20,"stsz",t)}static mvex(t,e=1e3,i){let r=new n.Buffer,a=n.Buffer.writeUint32(t);return r.write(s.size(56),s.type("mvex"),s.size(16),s.type("mehd"),s.extension(0,0),a,s.trex(i)),r.buffer}static trex(t){let e=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return s.initBox(8+e.byteLength,"trex",e)}static moof(t){let e=8,i=s.mfhd(),n=s.traf(t);return[i,n].forEach(t=>{e+=t.byteLength}),s.initBox(e,"moof",i,n)}static mfhd(){let t=n.Buffer.writeUint32(s.sequence);return s.sequence+=1,s.initBox(16,"mfhd",s.extension(0,0),t)}static traf(t){let e=8,i=s.tfhd(t.id),n=s.tfdt(t.time),r=s.sdtp(t),a=s.trun(t,r.byteLength);return[i,n,a,r].forEach(t=>{e+=t.byteLength}),s.initBox(e,"traf",i,n,a,r)}static tfhd(t){let e=n.Buffer.writeUint32(t);return s.initBox(16,"tfhd",s.extension(0,0),e)}static tfdt(t){return s.initBox(16,"tfdt",s.extension(0,0),n.Buffer.writeUint32(t))}static trun(t,e){let i=new n.Buffer,r=n.Buffer.writeUint32(t.samples.length),a=n.Buffer.writeUint32(92+16*t.samples.length+e);return i.write(s.size(20+16*t.samples.length),s.type("trun"),new Uint8Array([0,0,15,1]),r,a),t.samples.forEach(t=>{const e=t.flags;i.write(new Uint8Array([t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,t.size>>>24&255,t.size>>>16&255,t.size>>>8&255,255&t.size,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.isNonSync,0,0,t.cts>>>24&255,t.cts>>>16&255,t.cts>>>8&255,255&t.cts]))}),i.buffer}static sdtp(t){let e=new n.Buffer;return e.write(s.size(12+t.samples.length),s.type("sdtp"),s.extension(0,0)),t.samples.forEach(t=>{const i=t.flags,n=i.isLeading<<6|i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;e.write(new Uint8Array([n]))}),e.buffer}static mdat(t){let e=new n.Buffer,i=8;t.samples.forEach(t=>{i+=t.size}),e.write(s.size(i),s.type("mdat"));let r=new Uint8Array(i),a=0;return r.set(e.buffer,a),a+=8,t.samples.forEach(t=>{t.buffer.forEach(t=>{r.set(t,a),a+=t.byteLength})}),r}}s.type=(t=>new Uint8Array([t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)])),s.sequence=1,e.default=s},"../xgplayer-remux/src/mp4/index.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=i("../xgplayer-utils/index.js"),r=(n=i("../xgplayer-remux/src/mp4/fmp4.js"))&&n.__esModule?n:{default:n};const a=s.EVENTS.REMUX_EVENTS;class o{constructor(){this._dtsBase=0,this._isDtsBaseInited=!1,this._audioNextDts=null,this._videoNextDts=null,this._videoSegmentList=new s.MediaSegmentList("video"),this._audioSegmentList=new s.MediaSegmentList("audio");const{browser:e}=s.sniffer;this._fillSilenceFrame="ie"===e,this.videoAllDuration=0,this.audioAllDuration=0}init(){this.on(a.REMUX_MEDIA,this.remux.bind(this)),this.on(a.REMUX_METADATA,this.onMetaDataReady.bind(this))}destroy(){this._dtsBase=-1,this._dtsBaseInited=!1,this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear(),this._videoSegmentList=null,this._audioSegmentList=null}remux(){const{audioTrack:e,videoTrack:t}=this._context.getInstance("TRACKS");!this._isDtsBaseInited&&this.calcDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}seek(){this._videoNextDts=null,this._audioNextDts=null,this._videoSegmentList.clear(),this._audioSegmentList.clear()}onMetaDataReady(t){let e,i,n=new s.Buffer,o=r.default.ftyp();if("audio"===t){const{audioTrack:e}=this._context.getInstance("TRACKS");i=e}else{const{videoTrack:e}=this._context.getInstance("TRACKS");i=e}e=r.default.moov({type:t,meta:i.meta}),n.write(o,e);let u=this._context.getInstance("PRE_SOURCE_BUFFER"),d=u.getSource(t);d||(d=u.createSource(t)),d.mimetype=i.meta.codec,d.init=n,this.emit(a.INIT_SEGMENT,t)}calcDtsBase(t,e){if(t.samples.length||e.samples.length){let i=1/0,n=1/0;t.samples&&t.samples.length&&(i=t.samples[0].dts),e.samples&&e.samples.length&&(n=e.samples[0].dts),this._dtsBase=Math.min(i,n),this._isDtsBaseInited=!0}}_remuxVideo(t){const e=t;if(t.samples&&t.samples.length){let{samples:s}=e,t=-1;const i=[],n={samples:[]};for(;s.length;){const e=s.shift(),{isKeyframe:t}=e;let s,r,a=e.dts-this._dtsBase;-1===t&&(t=a),e.pts&&(s=(r=e.pts-this._dtsBase)-a),e.cts&&(r=e.cts+a,s=e.cts);let o={buffer:[],size:0};n.samples.push(o),o.buffer.push(e.data),o.size+=e.data.byteLength;let u=0;u=s.length>=1?s[0].dts-this._dtsBase-a:i.length>=1?i[i.length-1].duration:this.videoMeta.refSampleDuration,this.videoAllDuration+=u,i.push({dts:a,cts:s,pts:r,data:e.data,size:e.data.byteLength,isKeyframe:t,duration:u,flags:{isLeading:0,dependsOn:t?2:1,isDependedOn:t?1:0,hasRedundancy:0,isNonSync:t?0:1},originDts:a,type:"video"})}let o=new s.Buffer;const u=r.default.moof({id:e.meta.id,time:t,samples:i}),d=r.default.mdat(n);o.write(u,d),e.samples=[],e.length=0;let f=this._context.getInstance("PRE_SOURCE_BUFFER"),h=f.getSource("video");h||(h=f.createSource("video")),h.data.push(o),this.emit(a.MEDIA_SEGMENT,"video")}}_remuxAudio(t){const{samples:t}=t;let e=-1,i=[];const n={samples:[]};if(t&&t.length){let o=!1;for(;t.length;){let t=t.shift();const{data:r}=t;let s=t.dts-this._dtsBase;const r=s;o||(e=s,o=!0);let a=0;a=this.audioMeta.refSampleDurationFixed?this.audioMeta.refSampleDurationFixed:t.length>=1?t[0].dts-this._dtsBase-s:i.length>=1?i[i.length-1].duration:this.audioMeta.refSampleDuration,this.audioAllDuration+=a;const u={dts:s,pts:s,cts:0,size:r.byteLength,duration:t.duration?t.duration:a,flags:{isLeading:0,dependsOn:2,isDependedOn:1,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:r,type:"audio"};let d={buffer:[],size:0};d.buffer.push(r),d.size+=r.byteLength,n.samples.push(d),i.push(u)}const u=new s.Buffer,d=r.default.moof({id:t.meta.id,time:e,samples:i}),f=r.default.mdat(n);u.write(d,f),t.samples=[],t.length=0;let h=this._context.getInstance("PRE_SOURCE_BUFFER"),c=h.getSource("audio");c||(c=h.createSource("audio")),c.data.push(u),this.emit(a.MEDIA_SEGMENT,"audio",u)}}initSilentAudio(t,e){const i=o.getSilentFrame(this.audioMeta.channelCount);return{dts:t,pts:t,cts:0,duration:e,unit:i,size:i.byteLength,originDts:t,type:"video"}}get videoMeta(){return this._context.getInstance("TRACKS").videoTrack.meta}get audioMeta(){return this._context.getInstance("TRACKS").audioTrack.meta}static getSilentFrame(t){return 1===t?new Uint8Array([0,200,0,128,35,128]):2===t?new Uint8Array([33,0,73,144,2,25,0,35,128]):3===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]):4===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]):5===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]):6===t?new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]):null}}e.default=o},"../xgplayer-utils/index.js":function(t,e,i){t.exports={Context:i("../xgplayer-utils/src/context.js").default,EVENTS:i("../xgplayer-utils/src/constants/events.js").default,WORKER_COMMANDS:i("../xgplayer-utils/src/constants/worker-commands.js").default,sniffer:i("../xgplayer-utils/src/env/sniffer.js").default,isLe:i("../xgplayer-utils/src/env/isle.js").default,UTF8:i("../xgplayer-utils/src/env/utf8.js").default,MediaInfo:i("../xgplayer-utils/src/models/media-info.js").default,MediaSample:i("../xgplayer-utils/src/models/media-sample.js").default,MediaSegment:i("../xgplayer-utils/src/models/media-segment.js").default,MediaSegmentList:i("../xgplayer-utils/src/models/media-segment-list.js").default,AudioTrackMeta:i("../xgplayer-utils/src/models/track-meta.js").AudioTrackMeta,VideoTrackMeta:i("../xgplayer-utils/src/models/track-meta.js").VideoTrackMeta,AudioTrackSample:i("../xgplayer-utils/src/models/track-sample.js").AudioTrackSample,VideoTrackSample:i("../xgplayer-utils/src/models/track-sample.js").VideoTrackSample,Mse:i("../xgplayer-utils/src/mse/index.js").default,Stream:i("../xgplayer-utils/src/write/stream.js").default,Buffer:i("../xgplayer-utils/src/write/buffer.js").default}},"../xgplayer-utils/node_modules/concat-typed-array/lib/concat.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){for(var e=0,i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var r=!0,a=!1,o=void 0;try{for(var u,d=n[Symbol.iterator]();!(r=(u=d.next()).done);r=!0)e+=u.value.length}catch(t){a=!0,o=t}finally{try{!r&&d.return&&d.return()}finally{if(a)throw o}}var f=new t(e),h=0,c=!0,l=!1,p=void 0;try{for(var m,g=n[Symbol.iterator]();!(c=(m=g.next()).done);c=!0){var _=m.value;f.set(_,h),h+=_.length}}catch(t){l=!0,p=t}finally{try{!c&&g.return&&g.return()}finally{if(l)throw p}}return f}},"../xgplayer-utils/node_modules/concat-typed-array/lib/index.js":function(t,e,i){var n,s=(n=i("../xgplayer-utils/node_modules/concat-typed-array/lib/concat.js"))&&n.__esModule?n:{default:n};t.exports=s.default},"../xgplayer-utils/src/constants/events.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_ERROR:"LOADER_ERROR"},s={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO"},r={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT"},a={SOURCE_UPDATE_END:"SOURCE_UPDATE_END"},o={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},u=Object.assign({},n,s,r,a,o),d=[],f=[];for(let t in u)u.hasOwnProperty(t)&&d.push(u[t]);for(let t in u)u.hasOwnProperty(t)&&f.push(u[t]);e.default={ALLEVENTS:u,HLS_EVENTS:o,REMUX_EVENTS:r,DEMUX_EVENTS:s,MSE_EVENTS:a,LOADER_EVENTS:n,FlvAllowedEvents:d,HlsAllowedEvents:f}},"../xgplayer-utils/src/constants/worker-commands.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.CONTEXT_COMOMANDS={ON:"on",ONCE:"once",OFF:"off",EMIT:"emit",DESTROY:"destroy"}},"../xgplayer-utils/src/context.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=(n=i("../xgplayer-utils/src/models/media-info.js"))&&n.__esModule?n:{default:n},r=i("../../node_modules/events/events.js");const a="__TO__";e.default=class{constructor(t=[]){this._emitter=new r.EventEmitter,this._instanceMap={},this._clsMap={},this._inited=!1,this.mediaInfo=new s.default,this.allowedEvents=t,this._hooks={}}getInstance(t){return this._instanceMap[t]||null}initInstance(t,...e){if(this._clsMap[t]){const i=new this._clsMap[t](...e);return this._instanceMap[t]=i,i.init&&i.init(),i}throw new Error(`${t}未在context中注册`)}init(t){if(!this._inited){for(let e in this._clsMap)this._clsMap.hasOwnProperty(e)&&!this._instanceMap[e]&&this.initInstance(e,t);this._inited=!0}}registry(t,e){const i=this._emitter,n=this._isMessageNameValid.bind(this),s=this;return this._clsMap[t]=class extends e{constructor(...e){super(...e),this.listeners={},this.onceListeners={},this.TAG=t,this._context=s}on(e,s){return n(e),this.listeners[e]?this.listeners[e].push(s):this.listeners[e]=[s],i.on(`${e}${a}${t}`,s),i.on(e,s)}before(t,e){n(t),s._hooks[t]?s._hooks[t].push(e):s._hooks[t]=[e]}once(e,s){return n(e),this.onceListeners[e]?this.onceListeners[e].push(s):this.onceListeners[e]=[s],i.once(`${e}${a}${t}`,s),i.once(e,s)}emit(t,...e){n(t);const r=s._hooks?s._hooks[t]:null;if(r)for(let t=0,e=r.length;t<e;t++)(0,r[t])();return i.emit(t,...e)}emitTo(t,e,...s){return n(e),i.emit(`${e}${a}${t}`,...s)}off(t,e){return n(t),i.off(t,e)}removeListeners(){const e=Object.prototype.hasOwnProperty.bind(this.listeners);for(let n in this.listeners)if(e(n)){const e=this.listeners[n]||[];for(let s=0;s<e.length;s++){const r=e[s];i.off(n,r),i.off(`${n}${a}${t}`,r)}}for(let n in this.onceListeners)if(e(n)){const e=this.onceListeners[n]||[];for(let s=0;s<e.length;s++){const r=e[s];i.off(n,r),i.off(`${n}${a}${t}`,r)}}}destroy(){if(this.removeListeners(),this.listeners={},delete s._instanceMap[t],super.destroy)return super.destroy()}},(...e)=>this.initInstance(t,...e)}destroyInstances(){Object.keys(this._instanceMap).forEach(t=>{this._instanceMap[t].destroy&&this._instanceMap[t].destroy()})}destroy(){this._emitter=null,this.allowedEvents=[],this._clsMap=null,this._context=null,this._hooks=null,this.destroyInstances()}_isMessageNameValid(t){if(!this.allowedEvents.indexOf(t)<0)throw new Error(`unregistered message name: ${t}`)}}},"../xgplayer-utils/src/env/isle.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}();e.default=n},"../xgplayer-utils/src/env/sniffer.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=function(){const t=new ArrayBuffer(2);return new DataView(t).setInt16(0,256,!0),256===new Int16Array(t)[0]}(),s={get device(){let t=s.os;return t.isPc?"pc":t.isTablet?"tablet":"mobile"},get browser(){let t=navigator.userAgent.toLowerCase(),e={ie:/rv:([\d.]+)\) like gecko/,firfox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(e).filter(i=>e[i].test(t)))[0]},get os(){let t=navigator.userAgent,e=/(?:Windows Phone)/.test(t),i=/(?:SymbianOS)/.test(t)||e,n=/(?:Android)/.test(t),s=/(?:Firefox)/.test(t),r=/(?:iPad|PlayBook)/.test(t)||n&&!/(?:Mobile)/.test(t)||s&&/(?:Tablet)/.test(t),a=/(?:iPhone)/.test(t)&&!r;return{isTablet:r,isPhone:a,isAndroid:n,isPc:!a&&!n&&!i,isSymbian:i,isWindowsPhone:e,isFireFox:s}},get isLe(){return n}};e.default=s},"../xgplayer-utils/src/env/utf8.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{static decode(t){const e=[],i=t;let s=0;const r=t.length;for(;s<r;)if(i[s]<128)e.push(String.fromCharCode(i[s])),++s;else{if(i[s]<192);else if(i[s]<224){if(n._checkContinuation(i,s,1)){const t=(31&i[s])<<6|63&i[s+1];if(t>=128){e.push(String.fromCharCode(65535&t)),s+=2;continue}}}else if(i[s]<240){if(n._checkContinuation(i,s,2)){const t=(15&i[s])<<12|(63&i[s+1])<<6|63&i[s+2];if(t>=2048&&55296!=(63488&t)){e.push(String.fromCharCode(65535&t)),s+=3;continue}}}else if(i[s]<248&&n._checkContinuation(i,s,3)){let t=(7&i[s])<<18|(63&i[s+1])<<12|(63&i[s+2])<<6|63&i[s+3];if(t>65536&&t<1114112){t-=65536,e.push(String.fromCharCode(t>>>10|55296)),e.push(String.fromCharCode(1023&t|56320)),s+=4;continue}}e.push(String.fromCharCode(65533)),++s}return e.join("")}static _checkContinuation(t,e,i){let n=t;if(e+i<n.length){for(;i--;)if(128!=(192&n[++e]))return!1;return!0}return!1}}e.default=n},"../xgplayer-utils/src/models/media-info.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});const n=t=>{for(let e in t)if(t.hasOwnProperty(e)&&null===t[e])return!1;return!0};class s{constructor(){this.mimeType=null,this.duration=null,this.hasVideo=null,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=null,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}isComplete(){return s.isBaseInfoReady(this)&&s.isVideoReady(this)&&s.isAudioReady(this)}static isBaseInfoReady(t){return n(t)}static isVideoReady(t){return!t.hasVideo||n(t.video)}static isAudioReady(t){return!t.hasAudio||n(t.video)}}e.default=s},"../xgplayer-utils/src/models/media-sample.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){let e=n.getDefaultInf();if(!t||"[object Object]"!==Object.prototype.toString.call(t))return e;let i=Object.assign({},e,t);Object.entries(i).forEach(([t,e])=>{this[t]=e})}static getDefaultInf(){return{dts:null,pts:null,duration:null,position:null,isRAP:!1,originDts:null}}}e.default=n},"../xgplayer-utils/src/models/media-segment-list.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this._type=t,this._list=[],this._lastAppendLocation=-1}get type(){return this._type}get length(){return this._list.length}isEmpty(){return 0===this._list.length}clear(){this._list=[],this._lastAppendLocation=-1}_searchNearestSegmentBefore(t){let e=this._list;if(0===e.length)return-2;let i=e.length-1,n=0,s=0,r=i,a=0;if(t<e[0].originDts)return a=-1;for(;s<=r;){if((n=s+Math.floor((r-s)/2))===i||t>e[n].lastSample.originDts&&t<e[n+1].originDts){a=n;break}e[n].originDts<t?s=n+1:r=n-1}return a}_searchNearestSegmentAfter(t){return this._searchNearestSegmentBefore(t)+1}append(t){let e=this._list,i=this._lastAppendLocation,n=0;-1!==i&&i<e.length&&t.originStartDts>=e[i].lastSample.originDts&&(i===e.length-1||i<e.length-1&&t.originStartDts<e[i+1].originStartDts)?n=i+1:e.length>0&&(n=this._searchNearestSegmentBefore(t.originStartDts)+1),this._lastAppendLocation=n,this._list.splice(n,0,t)}getLastSegmentBefore(t){let e=this._searchNearestSegmentBefore(t);return e>=0?this._list[e]:null}getLastSampleBefore(t){let e=this.getLastSegmentBefore(t);return null!==e?e.lastSample:null}getLastRAPBefore(t){let e=this._searchNearestSegmentBefore(t),i=this._list[e].randomAccessPoints;for(;0===i.length&&e>0;)e--,i=this._list[e].randomAccessPoints;return i.length>0?i[i.length-1]:null}}},"../xgplayer-utils/src/models/media-segment.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.startDts=-1,this.endDts=-1,this.startPts=-1,this.endPts=-1,this.originStartDts=-1,this.originEndDts=-1,this.randomAccessPoints=[],this.firstSample=null,this.lastSample=null}addRAP(t){t.isRAP=!0,this.randomAccessPoints.push(t)}}},"../xgplayer-utils/src/models/track-meta.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0}),e.AudioTrackMeta=class{constructor(t){const e={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},e,t):e}destroy(){this.init=null}},e.VideoTrackMeta=class{constructor(t){const e={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},e,t):e}destroy(){this.init=null,this.sps=null,this.pps=null}}},"../xgplayer-utils/src/models/track-sample.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){let e=n.getDefault();return t?Object.assign({},e,t):e}static getDefault(){return{dts:null,pts:null,data:new Uint8Array}}}e.AudioTrackSample=n;class s{constructor(t){let e=s.getDefault();return t?Object.assign({},e,t):e}static getDefault(){return{dts:null,pts:null,isKeyframe:!1,originDts:null,data:new Uint8Array}}}e.VideoTrackSample=s},"../xgplayer-utils/src/mse/index.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){this.configs=Object.assign({},t),this.container=this.configs.container,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this)}init(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this.container.src=URL.createObjectURL(this.mediaSource),this.url=this.container.src,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}onTimeUpdate(){this.emit("TIME_UPDATE",this.container)}onWaiting(){this.emit("WAITING",this.container)}onSourceOpen(){this.addSourceBuffers()}onUpdateEnd(){this.emit("SOURCE_UPDATE_END"),this.doAppend()}addSourceBuffers(){if("open"===this.mediaSource.readyState){let t,e=this._context.getInstance("PRE_SOURCE_BUFFER"),i=this._context.getInstance("TRACKS");e=e.sources;let n=!1;for(let s=0,r=Object.keys(e).length;s<r;s++){let r=Object.keys(e)[s];if("audio"===r?t=i.audioTrack:"video"===r&&(t=i.videoTrack),t){let i="audio"===r?21:40;t.meta&&t.meta.refSampleDuration&&(i=t.meta.refSampleDuration),e[r].data.length>=this.preloadTime/i&&(n=!0)}}if(n){if(Object.keys(this.sourceBuffers).length>0)return;for(let t=0,i=Object.keys(e).length;t<i;t++){let i=Object.keys(e)[t],n=e[i],s="video"===i?"video/mp4;codecs="+n.mimetype:"audio/mp4;codecs="+n.mimetype,r=this.mediaSource.addSourceBuffer(s);this.sourceBuffers[i]=r,r.addEventListener("updateend",this.onUpdateEnd),this.doAppend()}}}}doAppend(){let t=this._context.getInstance("PRE_SOURCE_BUFFER");if(t)for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let i=Object.keys(this.sourceBuffers)[e],n=this.sourceBuffers[i];if(!n.updating){let e=t.sources[i];if(e&&!e.inited)n.appendBuffer(e.init.buffer.buffer),e.inited=!0;else if(e){let t=e.data.shift();t&&n.appendBuffer(t.buffer.buffer)}}}}endOfStream(){const{readyState:e,activeSourceBuffers:t}=this.mediaSource;if("open"===e&&0===t.length)try{this.mediaSource.endOfStream()}catch(e){}}remove(t,e=0){for(let i=0;i<Object.keys(this.sourceBuffers).length;i++){let n=this.sourceBuffers[Object.keys(this.sourceBuffers)[i]];n.updating||n.remove(e,t)}}removeBuffers(){const t=[];for(let e=0;e<Object.keys(this.sourceBuffers).length;e++){let i,s=this.sourceBuffers[Object.keys(this.sourceBuffers)[e]];s.removeEventListener("updateend",this.onUpdateEnd),s.updating?i=new Promise(t=>{const e=function(){let i=3;const r=()=>{s.updating?i>0?(setTimeout(r,200),i--):t():(n.clearBuffer(s),t())};setTimeout(r,200),s.removeEventListener("updateend",e)};s.addEventListener("updateend",e)}):(n.clearBuffer(s),i=Promise.resolve()),t.push(i)}return Promise.all(t)}destroy(){return this.removeBuffers().then(()=>{for(let t=0;t<Object.keys(this.sourceBuffers).length;t++){let e=this.sourceBuffers[Object.keys(this.sourceBuffers)[t]];this.mediaSource.removeSourceBuffer(e),delete this.sourceBuffers[Object.keys(this.sourceBuffers)[t]]}this.container.removeEventListener("timeupdate",this.onTimeUpdate),this.container.removeEventListener("waiting",this.onWaiting),this.mediaSource.removeEventListener("sourceopen",this.onSourceOpen),this.endOfStream(),window.URL.revokeObjectURL(this.url),this.url=null,this.configs={},this.container=null,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=1})}static clearBuffer(t){const e=t.buffered;let i=.1;for(let t=0,n=e.length;t<n;t++)i=e.end(t);try{t.remove(0,i)}catch(t){}}}e.default=n},"../xgplayer-utils/src/write/buffer.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});var n,s=(n=i("../xgplayer-utils/node_modules/concat-typed-array/lib/index.js"))&&n.__esModule?n:{default:n};e.default=class{constructor(t){this.buffer=t||new Uint8Array(0)}write(...t){t.forEach(t=>{this.buffer=(0,s.default)(Uint8Array,this.buffer,t)})}static writeUint32(t){return new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t])}static readAsInt(t){let e="";return t.forEach(t=>{e+=function(t){return t.toString(16).padStart(2,"0")}(t)}),parseInt(e,16)}}},"../xgplayer-utils/src/write/stream.js":function(t,e,i){Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){if(!(t instanceof ArrayBuffer))throw new Error("data is invalid");this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}get length(){return this.buffer.byteLength}set position(t){this.dataview.position=t}get position(){return this.dataview.position}back(t){this.position-=t}skip(t){let e=Math.floor(t/4),i=t%4;for(let t=0;t<e;t++)n.readByte(this.dataview,4);i>0&&n.readByte(this.dataview,i)}static readByte(t,e,i){let n;switch(e){case 1:n=i?t.getInt8(t.position):t.getUint8(t.position);break;case 2:n=i?t.getInt16(t.position):t.getUint16(t.position);break;case 3:if(i)throw new Error("not supported for readByte 3");n=t.getUint8(t.position)<<16,n|=t.getUint8(t.position+1)<<8,n|=t.getUint8(t.position+2);break;case 4:n=i?t.getInt32(t.position):t.getUint32(t.position);break;case 8:if(i)throw new Error("not supported for readBody 8");n=t.getUint32(t.position)<<32,n|=t.getUint32(t.position+4);break;default:n=""}return t.position+=e,n}readUint8(){return n.readByte(this.dataview,1)}readUint16(){return n.readByte(this.dataview,2)}readUint24(){return n.readByte(this.dataview,3)}readUint32(){return n.readByte(this.dataview,4)}readUint64(){return n.readByte(this.dataview,8)}readInt8(){return n.readByte(this.dataview,1,!0)}readInt16(){return n.readByte(this.dataview,2,!0)}readInt32(){return n.readByte(this.dataview,4,!0)}writeUint32(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}}e.default=n},"./src/flv-vod.js":function(t,e,i){function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(i("../xgplayer-demux/src/flv/index.js")),r=n(i("../xgplayer-remux/index.js")),a=i("../xgplayer-loader/index.js"),o=i("../xgplayer-buffer/index.js"),u=i("../xgplayer-utils/index.js"),d=i("../xgplayer-codec/index.js"),f=n(i("xgplayer"));const h=u.EVENTS.REMUX_EVENTS,c=u.EVENTS.DEMUX_EVENTS,l=u.EVENTS.LOADER_EVENTS;class p{warn(){}}class m{constructor(t){this.TAG="FLVController",this._player=t,this.state={initSegmentArrived:!1,range:{start:0,end:""},rangeSupport:!0}}static findFilePosition(t,e){for(let i=0,n=e.times.length;i<n;i++){const s=e.times[i],r=i+1<n?e.times[i+1]:Number.MAX_SAFE_INTEGER;if(s<=t&&t<=r)return e.filepositions[i]}return""}init(){this._context.registry("FETCH_LOADER",a.FetchLoader),this._context.registry("LOADER_BUFFER",o.XgBuffer),this._context.registry("FLV_DEMUXER",s.default),this._context.registry("TRACKS",o.Tracks),this._context.registry("MP4_REMUXER",r.default.Mp4Remuxer),this._context.registry("PRE_SOURCE_BUFFER",o.PreSource),this._context.registry("COMPATIBILITY",d.Compatibility),this._context.registry("LOGGER",p),this.mse=this._context.registry("MSE",u.Mse)({container:this._player.video}),this.initListeners(),setTimeout(()=>{this.loadMeta()},0)}initListeners(){this.on(l.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(c.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(c.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(c.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(c.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(h.INIT_SEGMENT,this._handleAppendInitSegment.bind(this)),this.on(h.MEDIA_SEGMENT,this._handleMediaSegment.bind(this))}_handleMediaInfo(){this._context.onMetaData||this.emit(c.DEMUX_ERROR,new Error("failed to get mediainfo"));const t=this._context.getInstance("LOADER_BUFFER"),e=this._context.getInstance("FETCH_LOADER");this.isSeekable&&(e.cancel(),this.state.range={start:0,end:t.historyLen-1},setTimeout(()=>{this.loadNext(0)}))}_handleLoaderDataLoaded(){this.emitTo("FLV_DEMUXER",c.DEMUX_START)}_handleMetadataParsed(t){this.emit(h.REMUX_METADATA,t)}_handleDemuxComplete(){this.emit(h.REMUX_MEDIA)}_handleAppendInitSegment(){this.state.initSegmentArrived=!0,this.mse.addSourceBuffers()}_handleMediaSegment(){this.mse.addSourceBuffers(),this.mse.doAppend()}_handleDemuxError(){this._player.emit("error",new f.default.Errors("parse",this._player.config.url))}seek(t){if(!this._context.onMetaData)return void this.loadMeta();if(this.isSeekable){this._context.getInstance("LOADER_BUFFER").clear();const{preloadTime:t=15}=this._player.config,e=this.getSeekRange(t,t);this.state.range=e,this.loadData()}}loadNext(t){this._context.onMetaData&&(this.loader.loading||this.getNextRange(t)&&this.loadData())}loadData(){const{start:e,end:t}=this.state.range;this.emit(l.LADER_START,this._player.config.url,{headers:{method:"get",Range:`bytes=${e}-${t}`}})}loadMeta(){this.loader.load(this._player.config.url,{headers:{Range:"bytes=0-"}}).catch(()=>{this.state.rangeSupport=!1,this.loadFallback()})}loadFallback(){this.loader.load(this._player.config.url).catch(()=>{this._player.emit("error",new f.default.Errors("network",this._player.config.url))})}getSeekRange(t,e){const{keyframes:s}=this._context.onMetaData,i=this._context.mediaInfo.duration,n=t,s=t+e,r=m.findFilePosition(n,s);return s>=i||n>=i?{start:r,end:""}:{start:r,end:m.findFilePosition(s,s)}}getNextRange(t){if(""!==this.state.range.end){const{end:t}=this.getSeekRange(t,this.config.preloadTime||15);return t<=this.state.range.end&&""!==t?void 0:(this.state.range={start:this.state.range.end+1,end:t},!0)}}destroy(){this._player=null,this.mse=null,this.state={initSegmentArrived:!1,range:{start:0,end:""},rangeSupport:!0}}get isSeekable(){return!!this.state.rangeSupport&&(!this._context||!this._context.mediaInfo.isComplete()||null!==this._context.mediaInfo.keyframes&&void 0!==this._context.mediaInfo.keyframes)}get config(){return this._player.config}get loader(){return this._context.getInstance("FETCH_LOADER")}}e.default=m},"./src/index.js":function(t,e,i){function n(t){return t&&t.__esModule?t:{default:t}}var s=n(i("xgplayer")),r=i("../xgplayer-utils/index.js"),a=n(i("./src/flv-vod.js"));const o=r.EVENTS.FlvAllowedEvents,u=(t,e)=>{if(!t.config.isLive&&t.duration-t.currentTime<2){const i=t.getBufferedRange();t.currentTime-i[1]<.1&&(t.emit("ended"),e.mse.endOfStream())}};t.exports=class extends s.default{constructor(t){super(t),this.context=new r.Context(o),this.initEvents()}start(){const t=this.context.registry("FLV_CONTROLLER",a.default)(this);this.flv=t,this.context.init(),super.start(t.mse.url)}initEvents(){this.on("timeupdate",this.handleTimeUpdate.bind(this)),this.on("seeking",this.handleSeek.bind(this)),this.once("destroy",this._destroy.bind(this))}handleTimeUpdate(){this.loadData(),u(this,this.flv)}handleSeek(){const t=this.currentTime,e=this.getBufferedRange();(t>e[1]||t<e[0])&&this.flv.seek(this.currentTime)}_destroy(){this.context.destroy(),this.context=null,this.flv=null}loadData(t=this.currentTime){const e=this.getBufferedRange();e[1]-t<(this.config.preloadTime||15)-5&&this.flv.loadNext(e[1]+1)}get src(){return this.currentSrc}set src(t){this.player.config.url=t,this.paused?this.start(t):(this.pause(),this.once("pause",()=>{this.start(t)}),this.once("canplay",()=>{this.play()})),this.once("canplay",()=>{this.currentTime=0})}}},0:function(t,e,i){t.exports=i("./src/index.js")},xgplayer:function(e,i){e.exports=t}})}(xgplayer)}(window)}),FlvVodPlayer=unwrapExports(dist$1),classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),FlvPlayer=function(){function t(e){return classCallCheck(this,t),e.isLive?new FlvLivePlayer(e):new FlvVodPlayer(e)}return createClass(t,null,[{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}}]),t}();export default FlvPlayer;
//# sourceMappingURL=index.min.js.map
