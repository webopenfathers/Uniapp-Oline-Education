{"version":3,"file":"index.min.js","sources":["../../../node_modules/eventemitter3/index.js","../src/parser.js","../src/error.js","../src/xhr.js","../src/proxyPromise.js","../src/utils.js","../src/observer.js","../src/constants.js","../src/index.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","const VTT_CHECK = /^WEBVTT/\nconst VTT_STYLE = /^STYLE+$/\n// eslint-disable-next-line no-useless-escape\nconst VTT_CUE = /^\\:\\:cue/\nconst VTT_CUEND = /^}+$/\nconst ASS_CHECK = /^\\[Script Info\\].*/\n\n// const HTML_REGEX = /<[a-zA-Z]+.*?>([\\s\\S]*?)<\\/[a-zA-Z]*?>/  匹配html标签\n\n// String a1 = \"[0-9]{4}[0-9]{2}[0-9]{2}[0-9]{2}[0-9]{2}[0-9]{2}\";//yyyyMMddHHmmss\n// String a2 = \"[0-9]{4}[0-9]{2}[0-9]{2}\";//yyyyMMdd\n// String a3 = \"[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2}\";//yyyy-MM-dd HH:mm:ss\n// String a4 = \"[0-9]{4}-[0-9]{2}-[0-9]{2}\";//yyyy-MM-dd\n// String a5= \"[0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}\";\n// const TIME_REGEX = /[0-9]{2}:[0-9]{2}:[0-9]{2}\\.[0-9]{3}-->[0-9]{2}:[0-9]{2}:[0-9]{2}\\.[0-9]{3}/\n\nconst TIME_REGEX_LIST = [\n  /[0-9]{1,3}:[0-9]{2}:[0-9]{2}\\.[0-9]{1,3}-->[0-9]{1,3}:[0-9]{2}:[0-9]{2}\\.[0-9]{1,3}/,\n  /[0-9]{1,2}:[0-9]{2}\\.[0-9]{1,3}-->[0-9]{1,2}:[0-9]{2}\\.[0-9]{1,3}/,\n  /[0-9]{1,2}\\.[0-9]{1,3}-->[0-9]{1,2}\\.[0-9]{1,3}/\n]\n// const LANG_REGEX = /^(<?.+?>(([\\s\\S])*?)<\\/?.+?>)$/\n\nconst MAX_COUNT = 50\n\nconst ASS_FORMAT = /^Format:\\s/\nconst ASS_STYLE = /^Style:\\s/\nconst ASS_DIALOGUE = /^Dialogue:\\s/\n// const ASS_EVENTS = /^\\[Events\\]:\\s/\n\nfunction getSecond (arr) {\n  const len = arr.length\n  if (len === 3) {\n    return ((Number(arr[0]) * 60 + Number(arr[1])) * 60 * 1000 + Number(arr[2]) * 1000) / 1000\n  } else if (len === 2) {\n    return (Number(arr[0]) * 60 * 1000 + Number(arr[1]) * 1000) / 1000\n  } else {\n    return Number(arr[0])\n  }\n}\n\n/**\n * 校验是否是数字\n * @param {String} str\n */\nfunction isNumber (str) {\n  // eslint-disable-next-line no-useless-escape\n  return /^(\\-|\\+)?\\d+(\\.\\d+)?$/.test(str)\n}\n\n/**\n * 对html内容进行转义，避免使用innerHTML的时候出现DOM XSS漏洞\n * @param  {[type]} e [description]\n * @return {[type]}   [description]\n */\nfunction htmlEncodeAll (e) {\n  return e\n  // return null === e ? '' : e.replace(/\\&/g, '&amp;').replace(/\\</g, '&lt;').replace(/\\>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&apos;');\n}\n\nfunction getByIndex (i, arr) {\n  if (i >= 0 && i < arr.length) {\n    return arr[i]\n  }\n  return ''\n}\nexport default class SubTitleParser {\n  /**\n   * 解析json数据进行分组\n   * @param {Array<{\n   *    start: number,\n   *    end: number,\n   *    text: Array<string>\n   * }>} list\n   * @returns\n   */\n  static parseJson (list) {\n    const ret = []\n    let count = 0\n    for (let i = 0; i < list.length; i++) {\n      if (count >= MAX_COUNT) {\n        count = 0\n      }\n      if (count === 0) {\n        const item = {\n          start: list[i].start,\n          list: [list[i]],\n          end: list[i].end\n        }\n        ret.push(item)\n      } else {\n        ret[ret.length - 1].list.push(list[i])\n        ret[ret.length - 1].end = list[i].end\n      }\n      count++\n    }\n    return ret\n  }\n\n  static parse (str, fun) {\n    const format = SubTitleParser.checkFormat(str)\n    if (!format) {\n      fun({ format })\n    }\n    try {\n      let ret = []\n      if (format === 'ass') {\n        ret = SubTitleParser.parseASS(str)\n      } else if (format === 'vtt') {\n        ret = SubTitleParser.parseVTT(str)\n      }\n      fun({ format, list: ret.list, styles: ret.styles })\n    } catch (error) {\n      console.error(error)\n      fun({ format }, error)\n    }\n  }\n\n  static parseASSItem (str = '', mode = []) {\n    const values = str.split(',')\n    const item = {}\n    let text = ''\n    try {\n      const len = values.length - mode.length\n      if (len > 0) {\n        text = values.splice(mode.length - 1, len + 1).join(',') + ''\n      } else {\n        text = values[values.length - 1] + ''\n      }\n      text = text.replace(/\\\\n+/g, '')\n      text = htmlEncodeAll(text)\n      values[mode.length - 1] = text\n      mode.map((key, index) => {\n        if (key === 'end' || key === 'start') {\n          item[key] = getSecond(values[index].split(':'))\n        } else if (key === 'text') {\n          item[key] = [values[index]]\n        } else if (key === 'layer') {\n          item[key] = [values[index]]\n          item.textTag = [values[index]]\n        } else if (key === 'style') {\n          item[key] = [values[index]]\n        } else {\n          item[key] = Number(values[index]) ? Number(values[index]) : values[index]\n        }\n      })\n      return item\n    } catch (error) {\n      console.error(error)\n      return {}\n    }\n  }\n\n  static parseASS (str) {\n    const arr = str.split('\\n')\n    const retData = []\n    let i = 0; let groupCount = 0\n    const styles = []\n    let mode = []\n    let lastSubTitle = null\n    while (i < arr.length) {\n      if (ASS_FORMAT.test(arr[i])) {\n        mode = arr[i].replace(ASS_FORMAT, '').replace(/\\s+/g, '').split(',')\n        mode = mode.map(item => {\n          return item.toLocaleLowerCase()\n        })\n      } else if (ASS_STYLE.test(arr[i])) {\n        styles.push(arr[i].replace(ASS_STYLE, '').replace(/\\s+/g, ''))\n      } else if (ASS_DIALOGUE.test(arr[i])) {\n        const subTitle = SubTitleParser.parseASSItem(arr[i].replace(ASS_DIALOGUE, ''), mode)\n        if (!lastSubTitle || !(subTitle.start === lastSubTitle.start && subTitle.end === lastSubTitle.end)) {\n          lastSubTitle = subTitle\n          let group = null\n          if (groupCount % MAX_COUNT === 0) {\n            group = {\n              start: lastSubTitle.start,\n              end: lastSubTitle.end,\n              list: []\n            }\n            group.list.push(lastSubTitle)\n            retData.push(group)\n          } else {\n            group = retData[retData.length - 1]\n            group.end = lastSubTitle.end\n            group.list.push(lastSubTitle)\n          }\n          groupCount++\n        } else {\n          try {\n            const { text, textTag, style } = lastSubTitle\n            text.push(subTitle.text[0])\n            textTag.push(subTitle.textTag[0])\n            style.push(subTitle.style[0])\n          } catch (error) {\n            console.error(error)\n          }\n        }\n      }\n      i++\n    }\n    return {\n      list: retData,\n      style: {}\n    }\n  }\n\n  static parseVTTStyle (str, style) {\n    const arr = str.split(':')\n    if (arr.length > 1) {\n      const keyArr = arr[0].trim().split('-')\n      let key = ''\n      if (keyArr.length > 1) {\n        keyArr.map((item, index) => {\n          key += index === 0 ? item : item.charAt(0).toUpperCase() + item.slice(1)\n        })\n      } else {\n        key = keyArr[0]\n      }\n      style[key] = arr[1].trim().replace(/;$/, '')\n    }\n    return style\n  }\n\n  static parseVTT (str) {\n    str = str.replace(VTT_CHECK, '')\n    const arr = str.split('\\n')\n    const retData = []\n    let i = 0\n    let groupCount = 0\n    let lastSubTitle = null\n    // let lastTime = null\n    let isLastSpace = false\n    let isCueStart = false\n    let styleInfo = null\n    let styleHeader = null\n    const styles = []\n    while (i < arr.length) {\n      const str = getByIndex(i, arr).trim()\n      if (!str || (isLastSpace && isNumber(str))) {\n        isLastSpace = !str\n      } else if (VTT_CUE.test(str) && VTT_STYLE.test(getByIndex(i - 1, arr).trim())) {\n        isCueStart = true\n        const cueMatch = /\\((.+?)\\)/g.exec(str)\n        if (!cueMatch) {\n          styleHeader = ''\n        } else {\n          styleHeader = cueMatch[1]\n        }\n        styleInfo = ''\n      } else if (isCueStart) {\n        if (VTT_CUEND.test(str)) {\n          styles.push({\n            key: styleHeader,\n            style: styleInfo\n          })\n          styleInfo = null\n          styleHeader = null\n          isCueStart = false\n        } else {\n          // console.log('parseVTTStyle', str)\n          // this.parseVTTStyle(str, styles)\n          styleInfo += str\n        }\n      } else if (str) {\n        isLastSpace = false\n        const time = this.checkIsTime(arr[i])\n        if (time) {\n          const subTitle = this.parseVttTime(time)\n          if (!lastSubTitle || !(subTitle.start === lastSubTitle.start && subTitle.end === lastSubTitle.end)) {\n            lastSubTitle = subTitle\n            lastSubTitle.text = []\n            lastSubTitle.textTag = []\n            let group = null\n            if (groupCount % MAX_COUNT === 0) {\n              group = {\n                start: lastSubTitle.start,\n                end: lastSubTitle.end,\n                list: []\n              }\n              group.list.push(lastSubTitle)\n              retData.push(group)\n            } else {\n              group = retData[retData.length - 1]\n              group.end = lastSubTitle.end\n              group.list.push(lastSubTitle)\n            }\n            groupCount++\n          }\n        } else {\n          if (lastSubTitle) {\n            const { text, textTag } = lastSubTitle\n            const ret = this.parseVttText(arr[i])\n            /**\n                         * 兼容多种方式的多语言字幕\n                         * demo1 每个语言独立时间标记\n                         * =============================\n                         * 00:00:06.470 --> 00:00:06.890\n                         * Hello,\n                         * 00:00:06.470 --> 00:00:06.890\n                         * 你好，\n                         * =============================\n                         *\n                         * demo2 多个语言公用一个时间标记，由尖括号组成的tag包裹\n                         * =============================\n                         * <cmn-Hans-CN>你好，</cmn-Hans-CN>\n                         * <eng-US>hello,</eng-US>\n                         * =============================\n                         */\n            // if (textTag.length === 0 || lastTime || (ret.tag && ret.tag !== textTag[textTag.length - 1])) {\n            //   text.push(ret.text)\n            //   textTag.push(ret.tag)\n            // } else {\n            //   text[textTag.length - 1] += ret.text\n            // }\n            text.push(ret.text)\n            textTag.push(ret.tag)\n          }\n        }\n        // lastTime = time\n        isLastSpace = false\n      }\n      i++\n      continue\n    }\n    return {\n      list: retData,\n      styles: styles\n    }\n  }\n\n  static checkIsTime (str) {\n    str = str.replace(/\\s+/g, '')\n    let i = 0\n    let match = null\n    while (i < TIME_REGEX_LIST.length) {\n      match = TIME_REGEX_LIST[i].exec(str)\n      if (match) {\n        break\n      }\n      i++\n    }\n    return match ? match[0] : null\n  }\n\n  static parseVttText (text) {\n    // 检测是否有语言标记包裹\n    const langMatch = /^(<?.+?>)/g.exec(text)\n    let retText = ''; let tag = 'default'\n    if (langMatch) {\n      // eslint-disable-next-line no-useless-escape\n      tag = langMatch[0].replace(/\\<|\\>|\\&/g, '')\n      // 动态构造语言匹配规则\n      // eslint-disable-next-line no-useless-escape\n      const newReg = RegExp(`^<${tag}>(([\\\\s\\\\S])*?)<\\/${tag}>$`)\n      const textMatch = newReg.exec(text)\n      if (textMatch) {\n        retText = textMatch[1]\n      } else {\n        retText = text\n        tag = ''\n      }\n    } else {\n      retText = text\n    }\n    const tagsReg = /<(\\w+).(\\w+)>/g\n    let re = tagsReg.exec(retText)\n    // console.log(' re[0]', re)\n    while (re && re.length > 2) {\n      // const tags = re[0].split('.')\n      retText = retText.replace(re[0], `<${re[1]} class=\"${re[2]}\">`)\n      re = tagsReg.exec(retText)\n    }\n    return {\n      tag: tag,\n      text: htmlEncodeAll(retText.replace(/\\\\n+/g, '<br/>'))\n    }\n  }\n\n  static parseVttTime (str) {\n    const arr = str.split('-->')\n    let start; let end = 0\n    if (arr.length === 2) {\n      const aArr = arr[0].split(':')\n      const bArr = arr[1].split(':')\n      start = getSecond(aArr)\n      end = getSecond(bArr)\n    }\n    return {\n      start,\n      end,\n      time: str\n    }\n  }\n\n  static isVTT (str) {\n    return VTT_CHECK.test(str)\n  }\n\n  static isASS (str) {\n    return ASS_CHECK.test(str)\n  }\n\n  static checkFormat (str) {\n    if (!str) {\n      return null\n    }\n    if (VTT_CHECK.test(str)) {\n      return 'vtt'\n    } else if (ASS_CHECK.test(str)) {\n      return 'ass'\n    }\n    return null\n  }\n}\n","const ERROR = [{\n  code: 0, // 切换成功\n  msg: 'SUCCESS'\n}, {\n  code: 1, // 下载错误\n  msg: 'LOAD_ERROR'\n}, {\n  code: 2, // 解析错误\n  msg: 'PARSER_ERROR'\n}, {\n  code: 3, // 格式不支持\n  msg: 'FORMAT_NOT_SUPPORTED'\n},\n{\n  code: 4, // id或者语言不存在\n  msg: 'ID_OR_LANGUAGE_NOT_EXIST'\n}, {\n  code: 5, // 参数错误\n  msg: 'PARAMETERS_ERROR'\n}, {\n  code: 6, // 操作中断\n  msg: 'ABORT'\n}, {\n  code: 7, // 未知错误\n  msg: 'UNKNOWN'\n}, {\n  code: 8, // url不存在\n  msg: 'DATA_ERROR:subtitle.url is null'\n}, {\n  code: 9, // url不存在\n  msg: 'DATA_ERROR:subtitle.url length is 0'\n}]\n\n\nexport function _ERROR (code, error = {}) {\n  const ret = {\n    code: ERROR[code].code,\n    msg: ERROR[code].msg\n  }\n  Object.keys(error).map(key => {\n    ret[key] = error[key]\n  })\n  return ret\n}","class XHR {\n  constructor ({ url, method = 'GET', type = 'arraybuffer', timeout = 10000, data = {} } = {}, context = {}) {\n    return new Promise((resolve, reject) => {\n      const R = new window.XMLHttpRequest()\n      const _method = method.toUpperCase()\n      const _data = []\n      if (type) {\n        R.responseType = type\n      }\n      if (timeout) {\n        R.timeout = timeout\n      }\n      Object.keys(data).forEach(k => {\n        _data.push(`k=${data[k]}`)\n      })\n      R.onload = () => {\n        if (R.status === 200 || R.status === 206) {\n          resolve({ context, res: R })\n        } else {\n          reject(new Error({ context, res: R, type: 'error' }))\n        }\n      }\n      R.onerror = e => {\n        reject(new Error({ context, res: R, type: 'error' }))\n      }\n      R.ontimeout = e => {\n        reject(new Error({ context, res: R, type: 'error' }))\n      }\n      R.onabort = () => {\n        reject(new Error({ context, res: R, type: 'error' }))\n      }\n\n      if (_method === 'GET') {\n        // R.withCredentials = true;\n        R.open(_method, `${url}`)\n        R.send()\n      } else if (_method === 'post') {\n        R.open(_method, url)\n        R.setRequestHeader('Content-type', 'application/x-www-form-urlencoded')\n        R.send(_data.join('&'))\n      } else {\n        throw new Error(`xhr ${_method} is not supported`)\n      }\n    })\n  }\n}\n\nexport default XHR\n","\nexport default class ProxyPromise {\n  constructor () {\n    let resolvePromise\n    let rejectPromise\n\n    const promise = new Promise((resolve, reject) => {\n      resolvePromise = resolve\n      rejectPromise = reject\n    })\n\n    const publicPromise = promise\n    publicPromise.resolve = function (data) {\n      resolvePromise(data)\n      publicPromise.state = 'fulfilled'\n    }\n    publicPromise.reject = function (error) {\n      rejectPromise(error)\n      publicPromise.state = 'rejected'\n      publicPromise.isBreak = error === 'DESTROYED'\n    }\n    publicPromise.state = 'pending'\n\n    return publicPromise\n  }\n\n  /** @param {T=} value */\n  resolve (value) {}\n\n  /** @param {*=} reason */\n  reject (reason) {}\n}\n","import SubTitleParser from './parser'\nimport { _ERROR } from './error'\nimport XHR from './xhr'\nimport ProxyPromise from './proxyPromise'\n\nexport function hasClass (el, className) {\n  if (!el) {\n    return false\n  }\n  if (el.classList) {\n    return Array.prototype.some.call(el.classList, item => item === className)\n  } else {\n    const orgClassName = el.className && typeof el.className === 'object' ? el.getAttribute('class') : el.className\n    return orgClassName && !!orgClassName.match(new RegExp('(\\\\s|^)' + className + '(\\\\s|$)'))\n  }\n}\n\nexport function addClass (el, className) {\n  if (!el) {\n    return\n  }\n\n  if (el.classList) {\n    className.replace(/(^\\s+|\\s+$)/g, '').split(/\\s+/g).forEach(item => {\n      item && el.classList.add(item)\n    })\n  } else if (!hasClass(el, className)) {\n    if (el.className && typeof el.className === 'object') {\n      el.setAttribute('class', el.getAttribute('class') + ' ' + className)\n    } else {\n      el.className += ' ' + className\n    }\n  }\n}\n\nexport function removeClass (el, className) {\n  if (!el) {\n    return\n  }\n  if (el.classList) {\n    className.split(/\\s+/g).forEach(item => {\n      el.classList.remove(item)\n    })\n  } else if (hasClass(el, className)) {\n    className.split(/\\s+/g).forEach(item => {\n      const reg = new RegExp('(\\\\s|^)' + item + '(\\\\s|$)')\n      if (el.className && typeof el.className === 'object') {\n        el.setAttribute('class', el.getAttribute('class').replace(reg, ' '))\n      } else {\n        el.className = el.className.replace(reg, ' ')\n      }\n    })\n  }\n}\n\nexport function findIndexByTime (currentTime, list, index) {\n  const len = list.length\n  if (len < 1) {\n    return -1\n  }\n  index = index < 0 ? 0 : (index >= len ? len - 1 : index)\n  if (list[index].start <= currentTime && currentTime < list[index].end) {\n    return index\n  } else {\n    let i = list[index].end <= currentTime ? index + 1 : 0\n    for (; i < len; i++) {\n      if (list[i].start <= currentTime && currentTime < list[i].end) {\n        return i\n      } else if (currentTime > list[i].end && i + 1 < len && currentTime < list[i + 1].start) {\n        return -1\n      } else if (currentTime > list[i].end && i + 1 >= len) {\n        return -1\n      }\n    }\n    return -1\n  }\n}\n\nexport function findCIndexByTime (currentTime, list, index) {\n  const len = list.length\n  if (len < 1) {\n    return []\n  }\n  index = index < 0 ? 0 : (index >= len ? len - 1 : index)\n  const ids = []\n  if (index < len) {\n    let i = list[index].end <= currentTime ? index : 0\n    for (; i < len; i++) {\n      if (list[i].start <= currentTime && currentTime < list[i].end) {\n        ids.push(i)\n      }\n      if (currentTime < list[i].start) {\n        break\n      }\n    }\n  }\n  // console.log('findCIndexByTime', ids)\n  return ids\n}\n\n/**\n * @description 根据索引从列表中删除某个选项\n * @param {Array<any>} list\n * @param {number} gid 一级存储索引\n * @param {number} cid 二级存储索引\n */\nexport function removeItemByIndex (list, gid, cid) {\n  if (list.length === 0 || gid < 0 || gid > list.length - 1) {\n    return\n  }\n  const gList = list[gid].list\n  if (gList.length === 0) {\n    list.splice(gid, 1)\n    return\n  }\n  if (cid < 0 || cid > gList.length - 1) {\n    return\n  }\n  gList.splice(cid, 1)\n}\n\nexport function getItemsByIndex (list, gid, cids) {\n  if (list.length === 0 || gid < 0 || gid > list.length - 1) {\n    return []\n  }\n  const gList = list[gid].list\n\n  if (cids.length === 0) {\n    return []\n  }\n\n  const ret = gList.splice(cids[0], cids.length)\n\n  // 删除当前获取项之前的数据\n  if (gid > 0) {\n    list.splice(0, gid)\n  }\n  if (gList.length === 0) {\n    list.splice(0, 1)\n  }\n\n  return ret\n}\n\nexport function typeOf (obj) {\n  // eslint-disable-next-line no-lookahead-lookbehind-regexp/no-lookahead-lookbehind-regexp\n  return Object.prototype.toString.call(obj).match(/([^\\s.*]+)(?=]$)/g)[0]\n}\n\n/**\n *\n * @param { string } el\n * @param { string } [tpl=]\n * @param { {[propName: string]: any }} [attrs={}]\n * @param { string } [cname='']\n * @returns { HTMLElement | null }\n */\nexport function createDom (el = 'div', tpl = '', attrs = {}, cname = '') {\n  const dom = document.createElement(el)\n  dom.className = cname\n  dom.innerHTML = tpl\n  Object.keys(attrs).forEach(item => {\n    const key = item\n    const value = attrs[item]\n    if (el === 'video' || el === 'audio' || el === 'live-video') {\n      if (value) {\n        dom.setAttribute(key, value)\n      }\n    } else {\n      dom.setAttribute(key, value)\n    }\n  })\n  return dom\n}\n\nexport function isMobile () {\n  const ua = navigator.userAgent\n  const isWindowsPhone = /(?:Windows Phone)/.test(ua)\n  const isSymbian = /(?:SymbianOS)/.test(ua) || isWindowsPhone\n  const isAndroid = /(?:Android)/.test(ua)\n  const isFireFox = /(?:Firefox)/.test(ua)\n  const isTablet = /(?:iPad|PlayBook)/.test(ua) || (isAndroid && !/(?:Mobile)/.test(ua)) || (isFireFox && /(?:Tablet)/.test(ua))\n  const isPhone = /(?:iPhone)/.test(ua) && !isTablet\n  return isPhone || isAndroid || isSymbian || isTablet\n}\n\nexport function addCSS (styles, preTag = '') {\n  let cssText = ''\n  styles.map(item => {\n    cssText += ` ${preTag} ${item.key} {${item.style}}`\n  })\n  const styleTag = document.createElement('style') // 创建一个style元素\n  const head = document.head || document.getElementsByTagName('head')[0] // 获取head元素\n  styleTag.type = 'text/css' // 这里必须显示设置style元素的type属性为text/css，否则在ie中不起作用\n  styleTag.id = 'ssss'\n  if (styleTag.styleSheet) { // IE\n    const func = function () {\n      try { // 防止IE中stylesheet数量超过限制而发生错误\n        styleTag.styleSheet.cssText = cssText\n      } catch (e) {\n\n      }\n    }\n    // 如果当前styleSheet还不能用，则放到异步中则行\n    if (styleTag.styleSheet.disabled) {\n      setTimeout(func, 10)\n    } else {\n      func()\n    }\n  } else { // w3c\n    // w3c浏览器中只要创建文本节点插入到style元素中就行了\n    const textNode = document.createTextNode(cssText)\n    styleTag.appendChild(textNode)\n  }\n  head.appendChild(styleTag) // 把创建的style元素插入到head中\n}\n\nexport function parseResult (textTrack, resolve, reject, data, error) {\n  if (error) {\n    const err = _ERROR(2, error)\n    reject(err, { format: data.format })\n  } else if (!data.format) {\n    const err = _ERROR(3)\n    reject(err)\n  } else {\n    textTrack.list = data.list\n    textTrack.format = data.format\n    textTrack.styles = data.styles\n    resolve(textTrack)\n  }\n}\n\nexport function parse (content, format, promise) {\n  if (!promise) {\n    promise = new ProxyPromise()\n  }\n\n  // json类型，直接格式化json并解析数据\n  if (format === 'json') {\n    const list = SubTitleParser.parseJson(content)\n    promise.resolve({\n      list,\n      format: 'json'\n    })\n  } else if (format === 'string') {\n    SubTitleParser.parse(content, (data, error) => {\n      if (error) {\n        const err = _ERROR(2, error)\n        promise.reject(err, { format: data.format})\n      } else if (!data.format) {\n        const err = _ERROR(3)\n        promise.reject(err)\n      } else {\n        promise.resolve({\n          styles: data.styles,\n          list: data.list,\n          format: data.format\n        })\n      }\n    })\n  }\n  return promise\n}\n\nexport function loadSubTitle (object, promise) {\n  if (!promise) {\n    promise = new ProxyPromise()\n  }\n  new XHR({ url: object.url, type: 'text' }).then(data => {\n    parse(data.res.response, 'string').then((data) => {\n      promise.resolve({\n        ...data,\n        ...object\n      })\n    }).catch(e => {\n      promise.reject(e)\n    })\n  }).catch(err => {\n    const _err = _ERROR(1, { statusText: err.statusText, status: err.status, type: err.type, message: 'http load error', url: object.src, ...object })\n    promise.reject(_err)\n  })\n  return promise\n}\n\n/**\n * 加载字幕\n * @param {*} textTrack\n * @param {string} 类型\n */\nexport function __loadText (textTrack, type) {\n  return new Promise((resolve, reject) => {\n    if (textTrack.list) {\n      resolve(textTrack)\n      return\n    }\n    // json类型，直接格式化json并解析数据\n    if (textTrack.json) {\n      const list = SubTitleParser.parseJson(textTrack.json)\n      textTrack.list = list\n      textTrack.format = 'json'\n      resolve(textTrack)\n      return\n    }\n\n    // text string类型，直接解析文本信息\n    if (textTrack.stringContent && !textTrack.url) {\n      SubTitleParser.parse(textTrack.stringContent, (data, error) => {\n        parseResult(textTrack, resolve, reject, data, error)\n      })\n    } else if (!textTrack.url) {\n      const _err = _ERROR(8)\n      reject(_err)\n    } else {\n      new XHR({ url: textTrack.url, type: 'text' })\n        .then(data => {\n          SubTitleParser.parse(data.res.response, (data, error) => {\n            console.log('SubTitleParser.parse data', data)\n            parseResult(textTrack, resolve, reject, data, error)\n          })\n        }).catch(err => {\n          const _err = _ERROR(1, { statusText: err.statusText, status: err.status, type: err.type, message: 'http load error', url: textTrack.url })\n          reject(_err)\n        })\n    }\n  })\n}\n\n/**\n * 切换的语言和当前的是否一致\n * @param {*} src\n * @param {*} dist\n * @returns\n */\nexport function checkSubtitle (src, dist) {\n  if ((src.id && dist.id && src.id === dist.id) || (src.language && dist.language && src.language === dist.language)) {\n    return true\n  }\n  return false\n}","class ResizeObserver {\n  constructor () {\n    this.__handlers = []\n    if (!window.ResizeObserver) {\n      return\n    }\n    this.observer = new window.ResizeObserver((entries) => {\n      // const t = new Date().getTime()\n      this.__trigger(entries)\n    })\n  }\n\n  addObserver (target, handler) {\n    if (!this.observer) {\n      return\n    }\n    this.observer && this.observer.observe(target)\n    const { __handlers } = this\n    let index = -1\n    for (let i = 0; i < __handlers.length; i++) {\n      if (__handlers[i] && target === __handlers[i].target) {\n        index = i\n      }\n    }\n    if (index > -1) {\n      this.__handlers[index].handler.push(handler)\n    } else {\n      this.__handlers.push({\n        target,\n        handler: [handler]\n      })\n    }\n  }\n\n  unObserver (target) {\n    let i = -1\n    this.__handlers.map((item, index) => {\n      if (target === item.target) {\n        i = index\n      }\n    })\n    this.observer && this.observer.unobserve(target)\n    i > -1 && this.__handlers.splice(i, 1)\n  }\n\n  destroyObserver () {\n    this.observer && this.observer.disconnect()\n    this.observer = null\n    this.__handlers = null\n  }\n\n  __runHandler (target, cr) {\n    const { __handlers } = this\n    for (let i = 0; i < __handlers.length; i++) {\n      if (__handlers[i] && target === __handlers[i].target) {\n        __handlers[i].handler && __handlers[i].handler.forEach(handler => {\n          try {\n            handler(target, cr)\n          } catch (error) {\n            console.error(error)\n          }\n        })\n        break\n      }\n    }\n  }\n\n  __trigger (entries) {\n    entries.map(item => {\n      const cr = item.contentRect\n      this.__runHandler(item.target, cr)\n    })\n  }\n}\n\nlet resizeObserver = null\n\nfunction addObserver (target, handler) {\n  if (!resizeObserver) {\n    resizeObserver = new ResizeObserver()\n  }\n  resizeObserver.addObserver(target, handler)\n}\n\nfunction unObserver (target, handler) {\n  if (!resizeObserver) {\n    return\n  }\n  resizeObserver.unObserver(target, handler)\n}\n\nfunction destroyObserver (target, handler) {\n  if (!resizeObserver) {\n    return\n  }\n  resizeObserver.destroyObserver(target, handler)\n  resizeObserver = null\n}\n\nexport {\n  addObserver,\n  unObserver,\n  destroyObserver\n}\n","\nexport const EVENTS = {\n  RESIZE: 'resize',\n  CHANGE: 'change',\n  OFF: 'off',\n  UPDATE: 'update'\n}","import EventEmitter from 'eventemitter3'\n// import XHR from './xhr'\n// import SubTitleParser from './parser'\n// import { addClass, removeClass, typeOf, findIndexByTime, findCIndexByTime, isMobile, addCSS, createDom, __loadText, checkSubtitle } from './utils'\nimport * as Util from './utils'\nimport { addObserver, unObserver } from './observer'\nimport { EVENTS } from './constants'\nimport { _ERROR } from './error'\nimport ProxyPromise from './proxyPromise'\n\nimport './style/index.scss'\n\n\n/**\n * @typedef { {\n *   label?: string, // 字幕标记\n *   language?: string, // 字幕语言\n *   id?: string | number, // 字幕id\n *   isDefault?: boolean, // 当前字幕是不是默认字幕\n *   url?: string,\n *   stringContent?: string,\n *   list: any[]\n * } } SubtitleItem\n */\n\n// eslint-disable-next-line no-unused-vars\nconst SubtitleItem = {\n  label: '', // 字幕标记\n  language: '', // 字幕语言\n  id: '', // 字幕id\n  isDefault: false, // 当前字幕是不是默认字幕\n  json: {},\n  url: '', // 字幕的url地址\n  stringContent: '', // 响应格式的字符串，可以是vtt格式或者ass格式\n  list: [] // json格式\n}\n\nfunction formatUrl (url) {\n  const ret = []\n  if (url && Util.typeOf(url) === 'String') {\n    ret.push({ url: url, index: 0, start: -1, end: -1})\n  } else if (Util.typeOf(url) === 'Array') {\n    url.forEach((item, i) => {\n      ret.push({\n        url: item.url || item.src,\n        index: i,\n        start: item.start || -1,\n        end: item.end || -1\n      })\n    })\n  }\n  return ret\n}\n\nlet IS_MOBILE = false\nexport default class Subtitle extends EventEmitter {\n  /**\n   * @type {string}\n   * @description the version of sdk\n   */\n  get version () {\n    return __VERSION__\n  }\n\n  constructor (options) {\n    super()\n    IS_MOBILE = Util.isMobile()\n    this.currentText = null // 当前字幕信息\n    this.currentExtText = null\n    this.textTrack = [] // 字幕列表\n    this._cid = -1 //  当前字幕索引\n    this._gid = -1 // 当前字幕组索引\n    this._cids = []\n    this._iId = null\n    this._iC = 0\n    this.player = null\n    this.root = null\n    this.config = {\n      line: 'double', // 行数\n      bottom: 0, // 底部高度\n      mode: 'stroke',\n      defaultOpen: false, // 是否默认开启\n      baseSizeX: 49, // 横向基准字号\n      baseSizeY: 28, // 竖向基准字号, 宽高比例大于1.2视作竖向视频\n      minSize: 16, // 最小字号\n      minMobileSize: 13, // 移动端兜底字号\n      fitVideo: true, // 是否适配视频画面\n      offsetBottom: 2, // 底部边距百分比\n      fontColor: '#fff', // 字体颜色\n      domRender: true,\n      updateMode: 'vod', // 消费模式，vod 点播 live 直播\n      debugger: false\n    }\n\n    this._ctime = 0\n    this._loadingTrack = {}\n    Object.keys(this.config).map(key => {\n      if (options[key] !== undefined && options[key] !== null) {\n        this.config[key] = options[key]\n      }\n    })\n\n    this._isOpen = this.config.defaultOpen || false\n\n    this._videoMeta = {\n      scale: 0,\n      videoHeight: 0,\n      videoWidth: 0,\n      lwidth: 0, // 当前容器宽度\n      lheight: 0, // 当前容器高度\n      vWidth: 0, // 视频画面实际宽度\n      vHeight: 0, // 视频画面实际高度\n      vBottom: 0, // 视频画面底部距离\n      vLeft: 0, // 视频画面左边距离\n      marginBottom: 0 // 字幕底部边距\n    }\n    if (!options.subTitles || Util.typeOf(options.subTitles) !== 'Array') {\n      return\n    }\n    if (options.player) {\n      this.attachPlayer(options.player)\n    }\n    this.seiTime = 0\n    this.lastSeiTime = 0\n    this._curTexts = []\n    this.setSubTitles(options.subTitles, this.config.defaultOpen)\n  }\n\n\n  /**\n   * @description 更新字幕列表\n   * @param {*} subTitles // 更新的字幕列表\n   * @param {*} isOpen  // 是否默认开启\n   * @param {*} ieRemoveFirst // 是否移除之前的数据\n   */\n  setSubTitles (subTitles = [], isOpen = false, ieRemoveFirst = true) {\n    const _isOpen = this._isOpen || isOpen\n    ieRemoveFirst && this.innerRoot && this.switchOff()\n    this.currentText = null\n    this.textTrack = []\n    subTitles.forEach(item => {\n      const text = {}\n      Object.keys(item).map(key => {\n        text[key] = item[key]\n      })\n      text.url = formatUrl(text.url)\n      if (text.isDefault) {\n        this.currentText = text\n      }\n      this.textTrack.push(text)\n    })\n    this._log('setSubTitles', _isOpen)\n    if (_isOpen) {\n      this.switch().catch(e => {\n        this._log('[switch]', e)\n      })\n    }\n    this.currentText && this._loadTrack(this.currentText).then((textTrack) => {\n      this.addStyles(textTrack)\n      // if (_isOpen) {\n      //   this.switch()\n      // }\n    })\n    this.emit('reset', {list: this.textTrack, isOpen: _isOpen})\n  }\n\n  /**\n   * @description 更新更新单个语言数据\n   * @param {*} subTitle\n   */\n  updateSubTitle (subTitle) {\n    let index = -1\n    for (let i = 0; i < this.textTrack.length; i++) {\n      if (Util.checkSubtitle(subTitle, this.textTrack[i])) {\n        index = i\n        break\n      }\n    }\n    this._log('updateSubTitle', index, subTitle)\n    if (index > -1) {\n      const _isCurrent = Util.checkSubtitle(this.currentText, this.textTrack[index])\n      this._log('updateSubTitle', '_isCurrent', _isCurrent, 'this.isOpen', this.isOpen, this.currentText)\n      if (!_isCurrent) {\n        return\n      }\n      const url = formatUrl(subTitle.url)\n      if (!this.isOpen) {\n        this.textTrack[index].url = url\n      } else {\n        url.forEach(item => {\n          this.textTrack[index].url.push(item)\n        })\n        this._log('updateSubTitle _loadTrackUrls', this.textTrack[index])\n        this._loadTrackUrls(this.currentText, 2)\n      }\n    }\n  }\n\n  addStyles (textTrack) {\n    const { styles, format } = textTrack\n    if (styles && format === 'vtt') {\n      styles.map(item => {\n        if (!item.key) {\n          item.key = 'xg-text-track-span'\n        }\n      })\n      Util.addCSS(styles, 'xg-text-track')\n    }\n  }\n\n  attachPlayer (player) {\n    this._log('attachPlayer')\n    if (!player) {\n      return\n    }\n    if (this.player) {\n      this.detachPlayer()\n    }\n    const { fontColor, mode, fitVideo, domRender } = this.config\n    this.player = player\n    if (domRender) {\n      this.root = document.createElement('xg-text-track')\n      this.root.className = 'xg-text-track'\n      !this._isOpen && Util.addClass(this.root, 'text-track-hide')\n      !fitVideo && Util.addClass(this.root, 'text-track-no-fitvideo')\n      mode && Util.addClass(this.root, `text-track-${mode}`)\n      this.innerRoot = document.createElement('xg-text-track-inner')\n      this.root.appendChild(this.innerRoot)\n      if (fontColor) {\n        this.root.style.color = fontColor\n      }\n      if (this.currentText) {\n        ['language', 'id', 'label'].map(key => {\n          this.root.setAttribute(`data-${key}`, this.currentText[key] || '')\n        })\n      }\n      this.player.root.appendChild(this.root)\n      addObserver(player.root, this._onResize)\n    }\n    this.player.on('destroy', this.destroy)\n    this.player.on('timeupdate', this._onTimeupdate)\n    this.player.on('core_event', this._onCoreEvents)\n    if (this._isOpen) {\n      this.switch().catch(e => {\n        this._log('[switch]', e)\n      })\n    }\n  }\n\n  detachPlayer () {\n    const { player, config } = this\n    if (!player) {\n      return\n    }\n    player.off('destroy', this.destroy)\n    player.off('timeupdate', this._onTimeupdate)\n    player.on('core_event', this._onCoreEvents)\n    if (config.domRender) {\n      if (player.root) {\n        unObserver(player.root, this._onResize)\n        player.root.removeChild(this.root)\n      }\n      this.innerRoot = null\n      this.root = null\n    }\n    this.player = null\n  }\n\n  switch (subtitle = { id: '', language: '' }) {\n    this._log('switch', subtitle)\n    this._loadingTrack = subtitle\n    return new Promise((resolve, reject) => {\n      // 无参数的情况下直接开启字幕\n      if (!subtitle.id && !subtitle.language) {\n        if (this.currentText) {\n          this._loadingTrack = {}\n          this._updateCurrent(this.currentText)\n          this.switchOn()\n          const err = _ERROR(0, { message: 'switch default subtitle success' })\n          resolve(err)\n          return\n        } else {\n          const err = _ERROR(5, { message: 'no default subtitle' })\n          reject(err)\n          return\n        }\n      }\n      // console.log('isCurrent', this.currentText && Util.checkSubtitle(subtitle, this.currentText))\n      if (this.currentText && Util.checkSubtitle(subtitle, this.currentText)) {\n        this._loadingTrack = {}\n        this._updateCurrent(this.currentText)\n        this.switchOn()\n        resolve(_ERROR(0))\n      } else {\n        let nextSubtitle = null\n        // 语言不同移除当前字幕\n        this.__removeByTime(this._curTexts, 0)\n        for (let i = 0; i < this.textTrack.length; i++) {\n          if (Util.checkSubtitle(subtitle, this.textTrack[i])) {\n            nextSubtitle = this.textTrack[i]\n            break\n          }\n        }\n        this._log('nextSubtitle', nextSubtitle)\n        if (nextSubtitle) {\n          this._emitPlayerSwitch(this.currentText, nextSubtitle)\n          if (nextSubtitle.list) {\n            this._loadingTrack = {}\n            this._updateCurrent(nextSubtitle)\n            this.switchOn()\n            resolve(_ERROR(0))\n          } else {\n            this._log('this._loadTrack', nextSubtitle)\n            this._updateCurrent(nextSubtitle)\n            this._loadTrack(nextSubtitle)\n              .then((textTrack) => {\n                this.addStyles(textTrack)\n                // 比对最近一次的信息\n                if (this._loadingTrack.id === nextSubtitle.id || this._loadingTrack.language === textTrack.language) {\n                  this._loadingTrack = {}\n                  this._updateCurrent(textTrack)\n                  this.switchOn()\n                  resolve(_ERROR(0))\n                } else {\n                  const err = _ERROR(6, { message: `check _loadingTrack fail id: ${this._loadingTrack.id}  nextSubtitle:${textTrack.id}` })\n                  // console.trace(err)\n                  reject(err)\n                }\n              }).catch(err => {\n                reject(err)\n              })\n          }\n        } else {\n          const err = _ERROR(4, new Error(`The is no subtitle with id:[{${subtitle.id}}] or language:[${subtitle.language}]`))\n          // console.trace(err)\n          reject(err)\n        }\n      }\n    })\n  }\n\n  /**\n   * 开启扩展字幕\n   * @param {{\n   *   id?: any,\n   *   language?: any\n   * }} subtitle\n   * @returns\n   */\n  switchExt (subtitle = { id: '', language: '' }) {\n    return new Promise((resolve, reject) => {\n      if (!subtitle.id && !subtitle.language) {\n        this.currentExtText = null\n        resolve(_ERROR(0))\n      } else {\n        let nextSubtitle = null\n        for (let i = 0; i < this.textTrack.length; i++) {\n          if (Util.checkSubtitle(subtitle, this.textTrack[i])) {\n            nextSubtitle = this.textTrack[i]\n            break\n          }\n        }\n        if (nextSubtitle && !Util.checkSubtitle(nextSubtitle, this.currentText)) {\n          this._loadTrack(nextSubtitle).then((textTrack) => {\n            this.currentExtText = textTrack\n            resolve(_ERROR(0))\n          })\n        }\n      }\n    })\n  }\n\n  switchOn () {\n    this._log('switchOn')\n    this._isOpen = true\n    this.show()\n    this.emit(EVENTS.CHANGE, this.currentText)\n  }\n\n  /**\n   * 关闭字幕\n   */\n  switchOff () {\n    this._isOpen = false\n    this.hide()\n    this.emit(EVENTS.OFF)\n  }\n\n  get isOpen () {\n    return this._isOpen\n  }\n\n  _log (...msg) {\n    if (this.config.debugger) {\n      console.log('[xgSubtitle]', ...msg)\n    }\n  }\n\n  _loadTrack (textTrack) {\n    this._log('_loadTrack', textTrack.language, textTrack)\n    const promise = new ProxyPromise()\n    let contentType = ''\n    let content = ''\n    if (textTrack.json) {\n      contentType = 'json'\n      content = textTrack.json\n    } else if (textTrack.stringContent && !textTrack.url) {\n      contentType = 'string'\n      content = textTrack.stringContent\n    }\n    if (content) {\n      Util.parse(content, contentType).then(data => {\n        textTrack.format = data.format\n        textTrack.styles = data.styles\n        textTrack.list = data.list\n        promise.resolve(textTrack)\n      }).catch(e=>{\n        promise.reject(e)\n      })\n      return promise\n    }\n\n    const urls = textTrack.url\n    if (urls.length === 0){\n      promise.resolve(textTrack)\n      return promise\n    }\n    const url = urls.splice(0,1)\n    Util.loadSubTitle(url[0]).then((data) => {\n      textTrack.format = data.format\n      textTrack.styles = data.styles\n      if (!textTrack.list) {\n        textTrack.list = []\n      }\n      this._pushList(textTrack.list, data.list)\n      urls.length > 1 && this._loadTrackUrls(textTrack, 2)\n      promise.resolve(textTrack)\n    }).catch(e => {\n      promise.reject(e)\n    })\n    return promise\n  }\n\n  _emitPlayerSwitch (curSubtitle, nextSubTitle) {\n    // 清空当前字幕的列表\n    if (curSubtitle && this.config.updateMode === 'live') {\n      curSubtitle.list = []\n      curSubtitle.url = []\n    }\n    const data = { lang: nextSubTitle.language, ...nextSubTitle}\n    this._log('emit subtile_switch ', nextSubTitle, data)\n    this.player && this.player.emit('switch_subtitle', data)\n  }\n\n  /**\n   * @desc 多文件场景下下载多个vtt文件\n   * @param {*} textTrack\n   * @param {*} maxCount\n   */\n  _loadTrackUrls (textTrack, maxCount, promise) {\n    const len = textTrack.url.length\n    const urls = len > maxCount ? textTrack.url.splice(0, maxCount) : textTrack.url.splice(0, len)\n    let loadingCount = urls.length\n    this._log('_loadTrackUrls', textTrack.language, len, urls.length, loadingCount)\n    urls.forEach((item, i) => {\n      const obj = {\n        ...item,\n        index: i\n      }\n      Util.loadSubTitle(obj).then((data) => {\n        textTrack.format = data.format\n        textTrack.styles = data.format\n        if (!textTrack.list) {\n          textTrack.list = []\n        }\n        this._pushList(textTrack.list, data.list)\n        loadingCount--\n      }).catch((e) => {\n        loadingCount--\n      }).finally(e => {\n        if (loadingCount === 0) {\n          promise && promise.resolve(textTrack)\n          this._loadTrackUrls(textTrack, 2)\n        }\n      })\n    })\n  }\n  /**\n   * @description 移除已经加载过的字幕url信息\n   * @param {*} textTrack\n   * @param {*} data\n   */\n  _freshUrl (textTrack, data = {url: ''}) {\n    let i = -1\n    textTrack.url.forEach((item, index) => {\n      if (item.url === data.url) {\n        i = index\n      }\n    })\n    if (i > -1) {\n      textTrack.url.splice(i, 1)\n    }\n  }\n\n  /**\n   * @desc 在当前的字幕list中插入后续加载到的字幕数据，按照时间分布插入\n   * @param {Array} dist\n   * @param {Array} src\n   * @returns\n   */\n  _pushList (dist, src) {\n    const _start = src[0].start\n    const _end = src[src.length - 1].end\n    if (dist.length === 0 || _start >= dist[dist.length - 1].end) {\n      src.forEach(item => {\n        dist.push(item)\n      })\n    } else {\n      let _index = -1\n      for (let i = 0; i < dist.length; i++) {\n        if (dist[i].start > _end) {\n          _index = i\n          break\n        }\n      }\n      if (_index > -1) {\n        src.forEach((item, i) => {\n          dist.splice(_index + i, 0, item)\n        })\n      }\n    }\n    return dist\n  }\n\n  /**\n   * @private\n   * @description 更新当前生效字幕, 移除原有的渲染\n   * @param {} subtitle\n   * @returns\n   */\n  _updateCurrent (subtitle) {\n    // console.trace('_updateCurrent')\n    this.currentText = subtitle\n    if (this.config.domRender && this.root) {\n      ['language', 'id', 'label'].map(key => {\n        this.root.setAttribute(`data-${key}`, this.currentText[key] || '')\n      })\n      this.__remove(this._cids)\n    }\n    this._cids = []\n    this._gid = -1\n    this._cid = -1\n    this._curTexts = []\n    const curTime = this._getPlayerCurrentTime()\n    curTime && (this.config.updateMode === 'live' ? this._liveUpdate(curTime) : this._update(curTime))\n  }\n\n  __loadAll () {\n    this.textTrack.forEach(item => {\n      this._loadTrack(item)\n    })\n  }\n\n  getDelCid (oldArr, newArr) {\n    const ret = []\n    for (let i = 0; i < oldArr.length; i++) {\n      if (!newArr.includes(oldArr[i])) {\n        ret.push(oldArr[i])\n      }\n    }\n    return ret\n  }\n\n  getNewCid (oldArr, newArr) {\n    const ret = []\n    for (let i = 0; i < newArr.length; i++) {\n      if (!oldArr.includes(newArr[i])) {\n        ret.push(newArr[i])\n      }\n    }\n    return ret\n  }\n\n  /**\n   * @description 实时丢弃型更新, 字幕消费之后自动删除\n   * @param {number} currentTime 当前时间\n   * @returns\n   */\n  _liveUpdate (currentTime) {\n    if (!this.currentText || !this.currentText.list || !this.currentText.list.length) {\n      return\n    }\n    let _cids = []\n    const _gid = Util.findIndexByTime(currentTime, this.currentText.list, this._gid)\n    if (_gid > -1) {\n      _cids = Util.findCIndexByTime(currentTime, this.currentText.list[_gid].list, this._cid)\n    }\n    this.__removeByTime(this._curTexts, currentTime)\n    this._log('_liveUpdate',currentTime, _gid, _cids, this.currentText.list[0].list[0].start, this.currentText.list[0].list[0].end)\n    if (_cids.length > 0) {\n      const ret = Util.getItemsByIndex(this.currentText.list, _gid, _cids)\n      const _len = this._curTexts.length\n      const _si = _len > 0 ? this._curTexts[_len - 1].index : 0\n      ret.forEach((item, i) => {\n        item.index = i + _si\n        this._curTexts.push(item)\n      })\n      this.__render(ret)\n    }\n    this.emit('update', this._curTexts)\n  }\n\n  _update (currentTime) {\n    if (!this.currentText || !this.currentText.list || !this.currentText.list.length) {\n      return\n    }\n    const _gid = Util.findIndexByTime(currentTime, this.currentText.list, this._gid)\n    let _cids = []\n    if (_gid > -1) {\n      _cids = Util.findCIndexByTime(currentTime, this.currentText.list[_gid].list, this._cid)\n    }\n\n    // 当前没有数据，清空\n    if (_cids.length < 1) {\n      this._cids.length > 0 && this.config.domRender && this.__remove(this._cids)\n      this._cids = []\n      return\n    }\n    // 数据没有更新\n    if (this._cids === _cids && _gid === this._gid) {\n      return\n    }\n    this._gid = _gid\n    this._cid = _cids[0]\n\n    // 需要删除的数据\n    const delCids = this.getDelCid(this._cids, _cids)\n\n    // 需要新增的数据\n    const newCids = this.getNewCid(this._cids, _cids)\n\n    this._cids = _cids\n    this.config.domRender && this.__remove(delCids)\n    const texts = []\n    newCids.map(item => {\n      const text = this.currentText.list[_gid].list[item]\n      text.index = item\n      texts.push(text)\n    })\n\n    if (this.currentExtText) {\n      newCids.map(item => {\n        const textExt = this.currentText.list[_gid].list[item]\n        textExt.index = item\n        texts.push(textExt)\n      })\n    }\n\n    this.emit('update', texts)\n    this.__render(texts, currentTime)\n  }\n\n  _getPlayerCurrentTime () {\n    if (!this.player) {\n      return 0\n    }\n    const { currentTime } = this.player\n    // 如果是直播，有sei事件触发，需要对时间做校准\n    const curTime = parseInt(currentTime * 1000 + this.seiTime * 1000 - this.lastSeiTime * 1000, 10) / 1000\n    return curTime\n  }\n\n  _onTimeupdate = () => {\n    if (!this._isOpen) {\n      return\n    }\n    const { videoWidth, videoHeight } = this.player.video\n    if (!this._videoMeta.scale && videoWidth && videoHeight) {\n      this._onResize(this.player.root)\n    }\n    const curTime = this._getPlayerCurrentTime()\n    if (Math.round(Math.abs(curTime * 1000 - this._ctime)) < 200) {\n      return\n    }\n    this._ctime = curTime * 1000\n    if (this.currentText && this.currentText.list) {\n      this.config.updateMode === 'live' ? this._liveUpdate(curTime) : this._update(curTime)\n    }\n  }\n  getItemsByIndex\n  _onResize = (target) => {\n    const { _videoMeta, config } = this\n    if (!config.domRender) {\n      return\n    }\n    if (!target || !(target instanceof window.Element)) {\n      target = this.player.root\n    }\n    if (this._iId) {\n      clearTimeout(this._iId)\n      this._iId = null\n    }\n    if (!_videoMeta.scale) {\n      if (!this.player.video) {\n        return\n      }\n      const { videoWidth, videoHeight } = this.player.video\n      if (videoWidth && videoHeight) {\n        _videoMeta.videoWidth = videoWidth\n        _videoMeta.videoHeight = videoHeight\n        _videoMeta.scale = parseInt(videoHeight / videoWidth * 100, 10)\n      } else {\n        return\n      }\n    }\n    this.__startResize(target)\n  }\n\n  _onCoreEvents = (e) => {\n    try {\n      switch (e.eventName) {\n        // 字幕更新\n        case 'core.subtitlesegments':\n          this._onSubtitleSegment(e.list || [])\n          break\n        // 字幕列表更新\n        case 'core.subtitleplaylist':\n          this._onSubtitlePlaylist(e.list || [])\n          break\n        // sei 时间更新\n        case 'core.seipayloadtime':\n          this._onCoreSeiintime(e)\n          break\n        default:\n          //\n      }\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  _onSubtitlePlaylist (subtitleList) {\n    this._log('_onSubtitlePlaylist', subtitleList)\n    const list = subtitleList.map(item => {\n      return {\n        label: item.name,\n        language: item.lang, // 字幕语言f\n        id: item.id, // 字幕id\n        isDefault: item.default, // 当前字幕是不是默认字幕\n        url: [], // 字幕的url地址\n        mUrl: item.url\n      }\n    })\n    this.setSubTitles(list)\n  }\n\n  _onSubtitleSegment (urlList) {\n    this._log('_onSubtitleSegment', urlList.length, urlList[0].lang, urlList[0].sn, urlList[urlList.length - 1].sn, urlList[0].start, urlList[urlList.length - 1].end)\n    if (!urlList || urlList.length === 0) {\n      return\n    }\n\n    // 获取语言\n    const lang = urlList[0].lang\n    // 重构数据结构\n    const urls = urlList.map(item => {\n      return {\n        id: item.sn,\n        url: item.url,\n        duration: item.duration,\n        start: item.start,\n        end: item.end\n      }\n    })\n    const _sub = {\n      language: lang,\n      url: urls\n    }\n    // 更新的不是当前语言，不做处理\n    if (!Util.checkSubtitle(_sub, this.currentText)) {\n      return\n    }\n    this.updateSubTitle(_sub)\n  }\n\n  _onCoreSeiintime (e) {\n    try {\n      const sei = e.time / 1000\n      this._log('_onCoreSeiintime sei', sei, this.seiTime, this.lastSeiTime)\n      this.seiTime = sei\n      this.lastSeiTime = this.player ? this.player.currentTime : 0\n    } catch (e) {}\n  }\n\n\n  resize (width, height) {\n    const { baseSizeX, baseSizeY, minMobileSize, minSize, fitVideo, offsetBottom } = this.config\n    const { scale } = this._videoMeta\n    this._videoMeta.lwidth = width\n    this._videoMeta.lheight = height\n    let vWidth; let vHeight = 0\n    if (height / width * 100 >= scale) {\n      vHeight = parseInt(scale * width, 10) / 100\n      vWidth = width\n    } else {\n      vHeight = height\n      vWidth = parseInt(height / scale * 100, 10)\n    }\n    // this._log(`height:${height} width:${width} vWidth:${vWidth} vHeight:${vHeight} this._videoMeta.vWidth:${this._videoMeta.vWidth} this._videoMeta.vHeight:${this._videoMeta.vHeight}`)\n    this._videoMeta.vWidth = vWidth\n    this._videoMeta.vHeight = vHeight\n    let _size = 0\n    let fontSize = 0\n    if (scale > 120) {\n      _size = baseSizeY\n      fontSize = parseInt(_size * vHeight / 1080, 10)\n    } else {\n      _size = baseSizeX\n      fontSize = parseInt(_size * vWidth / 1920, 10)\n    }\n    const mini = IS_MOBILE ? minMobileSize : minSize\n    fontSize = fontSize < mini ? mini : (fontSize > _size ? _size : fontSize)\n    const style = {\n      fontSize\n    }\n    const vBottom = parseInt((height - vHeight) / 2, 10)\n    const vLeft = parseInt((width - vWidth) / 2, 10)\n    const marginBottom = parseInt(vHeight * offsetBottom, 10) / 100\n    this._videoMeta.vBottom = vBottom\n    this._videoMeta.vLeft = vLeft\n    this._videoMeta.marginBottom = marginBottom\n    if (fitVideo) {\n      style.bottom = vBottom + marginBottom\n      style.left = style.right = vLeft\n    }\n    // this._log(`fitVideo vLeft:${vLeft} vBottom:${vBottom} marginBottom:${marginBottom} vWidth:${vWidth} vHeight:${vHeight} fontSize:${fontSize}`)\n    Object.keys(style).map(item => {\n      this.root.style[item] = `${style[item]}px`\n    })\n    this.emit(EVENTS.RESIZE, {\n      vLeft,\n      vBottom,\n      marginBottom,\n      vWidth,\n      vHeight,\n      fontSize,\n      scale\n    })\n  }\n\n  __startResize (target) {\n    const rect = target.getBoundingClientRect()\n    const { _videoMeta } = this\n    const { width, height } = rect\n    if (this._iId) {\n      clearTimeout(this._iId)\n      this._iId = null\n    }\n    // this._log(`__startResize width:${width} height:${height} lwidth:${this._videoMeta.lwidth} lheight:${this._videoMeta.lheight}`)\n    if (width > 0 && height > 0 && (width !== _videoMeta.lwidth || height !== _videoMeta.lheight)) {\n      this._iC = 0\n      this.resize(width, height)\n    } else {\n      if (this._iC >= 5) {\n        this._iC = 0\n        return\n      }\n      this._iC++\n      this._iId = setTimeout(() => {\n        this.__startResize(target)\n      }, 50)\n    }\n  }\n\n  /**\n   * @description 过期字幕移除\n   * @param {Array} list 当前的列表\n   * @param {number} time 需要移除的时间点\n   * @returns\n   */\n  __removeByTime (list, time) {\n    const ids = []\n    for (let i = 0; i < list.length; i++) {\n      if (!time || list[i].end < time) {\n        ids.push(i)\n      }\n    }\n    if (ids.length === 0) {\n      return\n    }\n    list.splice(ids[0], ids.length)\n    this.config.domRender && this.__remove (ids)\n  }\n\n  /**\n   * @description 移除过期dom\n   * @param {Array<number>} ids\n   * @returns\n   */\n  __remove (ids) {\n    if (!ids || ids.length < 1) {\n      return\n    }\n    const children = this.innerRoot.children\n    const removeIndex = []\n    for (let i = 0; i < children.length; i++) {\n      const index = Number(children[i].getAttribute('data-index'))\n      if (ids.includes(index)) {\n        removeIndex.push(children[i])\n      }\n    }\n    removeIndex.map(item => {\n      this.innerRoot.removeChild(item)\n    })\n  }\n\n  /**\n   * @description 渲染新增dom\n   * @param {Array<any>} jsonItems\n   */\n  __render (jsonItems = []) {\n    this._log('__render', jsonItems.length, this.config.domRender)\n    if (jsonItems.length > 0 && this.config.domRender) {\n      jsonItems.map(jsonItem => {\n        let className = `text-track-${this.config.line}`\n        jsonItem.text.map((item, index) => {\n          if (index > 0) {\n            className += ' text-track-deputy'\n          }\n          const attr = {\n            // 'data-tag': jsonItem.textTag[index],\n            'data-start': jsonItem.start,\n            'data-end': jsonItem.end,\n            'data-index': jsonItem.index\n          }\n          this.innerRoot.appendChild(Util.createDom('xg-text-track-span', item, attr, className))\n        })\n      })\n    }\n  }\n\n  show () {\n    if (!this.config.domRender) {\n      return\n    }\n    Util.removeClass(this.root, 'text-track-hide')\n  }\n\n  hide () {\n    if (!this.config.domRender) {\n      return\n    }\n    Util.addClass(this.root, 'text-track-hide')\n    this.innerRoot.innerHTML = ''\n  }\n\n  destroy = () => {\n    this.detachPlayer()\n    this.removeAllListeners()\n    this.player = null\n    this.textTrack = null\n  }\n\n  /**\n   *\n   * @param { string } event\n   * @param { any } [data]\n   * @returns\n   */\n  emit (event, data, ...args) {\n    super.emit(event, data, ...args)\n  }\n\n  /**\n   *\n   * @param { string } event\n   * @param { (data?: any) => any } callback\n   * @returns\n   */\n  on (event, callback, ...args) {\n    super.on(event, callback, ...args)\n  }\n\n  /**\n   *\n   * @param { string } event\n   * @param { (data?: any) => any } callback\n   * @returns\n   */\n  once (event, callback, ...args) {\n    super.once(event, callback, ...args)\n  }\n\n  /**\n   *\n   * @param { string } event\n   * @param { (data?: any) => any } callback\n   * @returns\n   */\n  off (event, callback, ...args) {\n    super.off(event, callback, ...args)\n  }\n\n  offAll () {\n    super.removeAllListeners()\n  }\n\n  /**\n   * @description 获取底部边距\n   */\n  get marginBottom () {\n    const { bottom, marginBottom } = this._videoMeta\n    return this.config.fitVideo ? bottom + marginBottom : marginBottom\n  }\n}\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","names","events","name","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","exports","VTT_CHECK","VTT_STYLE","VTT_CUE","VTT_CUEND","ASS_CHECK","TIME_REGEX_LIST","ASS_FORMAT","ASS_STYLE","ASS_DIALOGUE","getSecond","arr","Number","isNumber","str","test","getByIndex","SubTitleParser","_classCallCheck","key","value","list","ret","count","item","start","end","fun","format","checkFormat","parseASS","parseVTT","styles","error","console","mode","values","split","text","splice","join","replace","map","index","textTag","retData","groupCount","lastSubTitle","toLocaleLowerCase","subTitle","parseASSItem","_lastSubTitle","style","group","keyArr","trim","charAt","toUpperCase","isLastSpace","isCueStart","styleInfo","styleHeader","cueMatch","exec","time","checkIsTime","parseVttTime","_lastSubTitle2","parseVttText","tag","match","langMatch","retText","newReg","textMatch","RegExp","re","tagsReg","aArr","bArr","ERROR","code","msg","_ERROR","keys","XHR","_createClass","_ref","url","_ref$method","method","_ref$type","type","_ref$timeout","timeout","_ref$data","data","Promise","resolve","reject","R","window","XMLHttpRequest","_method","_data","responseType","forEach","k","onload","status","res","Error","onerror","e","ontimeout","onabort","open","send","setRequestHeader","ProxyPromise","resolvePromise","rejectPromise","publicPromise","state","isBreak","reason","hasClass","el","className","classList","some","orgClassName","_typeof","getAttribute","addClass","add","setAttribute","findIndexByTime","currentTime","findCIndexByTime","ids","typeOf","obj","toString","createDom","tpl","attrs","cname","dom","document","createElement","innerHTML","parse","content","promise","parseJson","err","loadSubTitle","object","then","response","_objectSpread","catch","_err","statusText","message","src","checkSubtitle","dist","id","language","ResizeObserver","_this","__handlers","observer","entries","__trigger","target","handler","observe","unobserve","disconnect","cr","_this2","contentRect","__runHandler","resizeObserver","EVENTS","formatUrl","Util","IS_MOBILE","Subtitle","_EventEmitter","_inherits","_super","_createSuper","options","ua","isWindowsPhone","isSymbian","isAndroid","isFireFox","isTablet","_defineProperty","_assertThisInitialized","_isOpen","_this$player$video","player","video","videoWidth","videoHeight","_videoMeta","scale","_onResize","root","curTime","_getPlayerCurrentTime","Math","round","abs","_ctime","currentText","config","updateMode","_liveUpdate","_update","_assertThisInitialize","domRender","Element","_iId","clearTimeout","_this$player$video2","parseInt","__startResize","eventName","_onSubtitleSegment","_onSubtitlePlaylist","_onCoreSeiintime","detachPlayer","textTrack","navigator","userAgent","currentExtText","_cid","_gid","_cids","_iC","line","bottom","defaultOpen","baseSizeX","baseSizeY","minSize","minMobileSize","fitVideo","offsetBottom","fontColor","debugger","_loadingTrack","lwidth","lheight","vWidth","vHeight","vBottom","vLeft","marginBottom","subTitles","attachPlayer","seiTime","lastSeiTime","_curTexts","setSubTitles","_possibleConstructorReturn","get","isOpen","ieRemoveFirst","innerRoot","switchOff","isDefault","_log","switch","_loadTrack","addStyles","_this3","_isCurrent","_loadTrackUrls","preTag","cssText","styleTag","head","getElementsByTagName","styleSheet","func","disabled","setTimeout","textNode","createTextNode","appendChild","_this4","_this$config","color","addObserver","destroy","_onTimeupdate","_onCoreEvents","unObserver","removeChild","_this5","subtitle","_updateCurrent","switchOn","nextSubtitle","__removeByTime","_emitPlayerSwitch","_this6","show","hide","_console","_len2","_key","log","_this7","contentType","json","stringContent","urls","_pushList","curSubtitle","nextSubTitle","lang","maxCount","_this8","loadingCount","finally","_start","_end","_index","_this9","__remove","_this10","oldArr","newArr","includes","_this11","getItemsByIndex","gid","cids","gList","_len","_si","__render","_this12","delCids","getDelCid","newCids","getNewCid","texts","textExt","subtitleList","label","default","mUrl","urlList","sn","_sub","duration","updateSubTitle","sei","width","height","_this13","_this$config2","_size","fontSize","mini","left","right","_this14","rect","getBoundingClientRect","resize","_this15","children","removeIndex","_this16","jsonItems","jsonItem","attr","removeClass","remove","reg","_get2","_len3","_key2","_get","_getPrototypeOf","callback","_get3","_len4","_key3","_get4","_len5","_key4","_get5","_len6","_key5","_this$_videoMeta"],"mappings":"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"}